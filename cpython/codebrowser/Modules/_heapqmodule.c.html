<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>_heapqmodule.c source code [codebrowser/Modules/_heapqmodule.c] - Woboq Code Browser</title>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'codebrowser/Modules/_heapqmodule.c'; var root_path = '../..'; var data_path = '../../../data';</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>codebrowser</a>/<a href='./'>Modules</a>/<a href='_heapqmodule.c.html'>_heapqmodule.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/* Drop in replacement for heapq.py</i></td></tr>
<tr><th id="2">2</th><td><i></i></td></tr>
<tr><th id="3">3</th><td><i>C implementation derived directly from heapq.py in Py2.3</i></td></tr>
<tr><th id="4">4</th><td><i>which was written by Kevin O'Connor, augmented by Tim Peters,</i></td></tr>
<tr><th id="5">5</th><td><i>annotated by Fran√ßois Pinard, and converted to C by Raymond Hettinger.</i></td></tr>
<tr><th id="6">6</th><td><i></i></td></tr>
<tr><th id="7">7</th><td><i>*/</i></td></tr>
<tr><th id="8">8</th><td></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="../Include/Python.h.html">"Python.h"</a></u></td></tr>
<tr><th id="10">10</th><td></td></tr>
<tr><th id="11">11</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="12">12</th><td><dfn class="tu decl def" id="siftdown" title='siftdown' data-type='int siftdown(PyListObject * heap, Py_ssize_t startpos, Py_ssize_t pos)' data-ref="siftdown">siftdown</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *<dfn class="local col1 decl" id="1heap" title='heap' data-type='PyListObject *' data-ref="1heap">heap</dfn>, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col2 decl" id="2startpos" title='startpos' data-type='Py_ssize_t' data-ref="2startpos">startpos</dfn>, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col3 decl" id="3pos" title='pos' data-type='Py_ssize_t' data-ref="3pos">pos</dfn>)</td></tr>
<tr><th id="13">13</th><td>{</td></tr>
<tr><th id="14">14</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col4 decl" id="4newitem" title='newitem' data-type='PyObject *' data-ref="4newitem">newitem</dfn>, *<dfn class="local col5 decl" id="5parent" title='parent' data-type='PyObject *' data-ref="5parent">parent</dfn>, **<dfn class="local col6 decl" id="6arr" title='arr' data-type='PyObject **' data-ref="6arr">arr</dfn>;</td></tr>
<tr><th id="15">15</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col7 decl" id="7parentpos" title='parentpos' data-type='Py_ssize_t' data-ref="7parentpos">parentpos</dfn>, <dfn class="local col8 decl" id="8size" title='size' data-type='Py_ssize_t' data-ref="8size">size</dfn>;</td></tr>
<tr><th id="16">16</th><td>    <em>int</em> <dfn class="local col9 decl" id="9cmp" title='cmp' data-type='int' data-ref="9cmp">cmp</dfn>;</td></tr>
<tr><th id="17">17</th><td></td></tr>
<tr><th id="18">18</th><td>    <a class="macro" href="../../include/assert.h.html#88" title="((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 18, __PRETTY_FUNCTION__))" data-ref="_M/assert">assert</a>(<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col1 ref" href="#1heap" title='heap' data-ref="1heap">heap</a>));</td></tr>
<tr><th id="19">19</th><td>    <a class="local col8 ref" href="#8size" title='size' data-ref="8size">size</a> = <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 19, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col1 ref" href="#1heap" title='heap' data-ref="1heap">heap</a>);</td></tr>
<tr><th id="20">20</th><td>    <b>if</b> (<a class="local col3 ref" href="#3pos" title='pos' data-ref="3pos">pos</a> &gt;= <a class="local col8 ref" href="#8size" title='size' data-ref="8size">size</a>) {</td></tr>
<tr><th id="21">21</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_IndexError" title='PyExc_IndexError' data-ref="PyExc_IndexError">PyExc_IndexError</a>, <q>"index out of range"</q>);</td></tr>
<tr><th id="22">22</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="23">23</th><td>    }</td></tr>
<tr><th id="24">24</th><td></td></tr>
<tr><th id="25">25</th><td>    <i>/* Follow the path to the root, moving parents down until finding</i></td></tr>
<tr><th id="26">26</th><td><i>       a place newitem fits. */</i></td></tr>
<tr><th id="27">27</th><td>    <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col1 ref" href="#1heap" title='heap' data-ref="1heap">heap</a>);</td></tr>
<tr><th id="28">28</th><td>    <a class="local col4 ref" href="#4newitem" title='newitem' data-ref="4newitem">newitem</a> = <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a>[<a class="local col3 ref" href="#3pos" title='pos' data-ref="3pos">pos</a>];</td></tr>
<tr><th id="29">29</th><td>    <b>while</b> (<a class="local col3 ref" href="#3pos" title='pos' data-ref="3pos">pos</a> &gt; <a class="local col2 ref" href="#2startpos" title='startpos' data-ref="2startpos">startpos</a>) {</td></tr>
<tr><th id="30">30</th><td>        <a class="local col7 ref" href="#7parentpos" title='parentpos' data-ref="7parentpos">parentpos</a> = (<a class="local col3 ref" href="#3pos" title='pos' data-ref="3pos">pos</a> - <var>1</var>) &gt;&gt; <var>1</var>;</td></tr>
<tr><th id="31">31</th><td>        <a class="local col5 ref" href="#5parent" title='parent' data-ref="5parent">parent</a> = <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a>[<a class="local col7 ref" href="#7parentpos" title='parentpos' data-ref="7parentpos">parentpos</a>];</td></tr>
<tr><th id="32">32</th><td>        <a class="local col9 ref" href="#9cmp" title='cmp' data-ref="9cmp">cmp</a> = <a class="ref" href="../Include/object.h.html#PyObject_RichCompareBool" title='PyObject_RichCompareBool' data-ref="PyObject_RichCompareBool">PyObject_RichCompareBool</a>(<a class="local col4 ref" href="#4newitem" title='newitem' data-ref="4newitem">newitem</a>, <a class="local col5 ref" href="#5parent" title='parent' data-ref="5parent">parent</a>, <a class="macro" href="../Include/object.h.html#927" title="0" data-ref="_M/Py_LT">Py_LT</a>);</td></tr>
<tr><th id="33">33</th><td>        <b>if</b> (<a class="local col9 ref" href="#9cmp" title='cmp' data-ref="9cmp">cmp</a> &lt; <var>0</var>)</td></tr>
<tr><th id="34">34</th><td>            <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="35">35</th><td>        <b>if</b> (<a class="local col8 ref" href="#8size" title='size' data-ref="8size">size</a> != <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 35, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col1 ref" href="#1heap" title='heap' data-ref="1heap">heap</a>)) {</td></tr>
<tr><th id="36">36</th><td>            <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_RuntimeError" title='PyExc_RuntimeError' data-ref="PyExc_RuntimeError">PyExc_RuntimeError</a>,</td></tr>
<tr><th id="37">37</th><td>                            <q>"list changed size during iteration"</q>);</td></tr>
<tr><th id="38">38</th><td>            <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="39">39</th><td>        }</td></tr>
<tr><th id="40">40</th><td>        <b>if</b> (<a class="local col9 ref" href="#9cmp" title='cmp' data-ref="9cmp">cmp</a> == <var>0</var>)</td></tr>
<tr><th id="41">41</th><td>            <b>break</b>;</td></tr>
<tr><th id="42">42</th><td>        <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col1 ref" href="#1heap" title='heap' data-ref="1heap">heap</a>);</td></tr>
<tr><th id="43">43</th><td>        <a class="local col5 ref" href="#5parent" title='parent' data-ref="5parent">parent</a> = <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a>[<a class="local col7 ref" href="#7parentpos" title='parentpos' data-ref="7parentpos">parentpos</a>];</td></tr>
<tr><th id="44">44</th><td>        <a class="local col4 ref" href="#4newitem" title='newitem' data-ref="4newitem">newitem</a> = <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a>[<a class="local col3 ref" href="#3pos" title='pos' data-ref="3pos">pos</a>];</td></tr>
<tr><th id="45">45</th><td>        <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a>[<a class="local col7 ref" href="#7parentpos" title='parentpos' data-ref="7parentpos">parentpos</a>] = <a class="local col4 ref" href="#4newitem" title='newitem' data-ref="4newitem">newitem</a>;</td></tr>
<tr><th id="46">46</th><td>        <a class="local col6 ref" href="#6arr" title='arr' data-ref="6arr">arr</a>[<a class="local col3 ref" href="#3pos" title='pos' data-ref="3pos">pos</a>] = <a class="local col5 ref" href="#5parent" title='parent' data-ref="5parent">parent</a>;</td></tr>
<tr><th id="47">47</th><td>        <a class="local col3 ref" href="#3pos" title='pos' data-ref="3pos">pos</a> = <a class="local col7 ref" href="#7parentpos" title='parentpos' data-ref="7parentpos">parentpos</a>;</td></tr>
<tr><th id="48">48</th><td>    }</td></tr>
<tr><th id="49">49</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="50">50</th><td>}</td></tr>
<tr><th id="51">51</th><td></td></tr>
<tr><th id="52">52</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="53">53</th><td><dfn class="tu decl def" id="siftup" title='siftup' data-type='int siftup(PyListObject * heap, Py_ssize_t pos)' data-ref="siftup">siftup</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *<dfn class="local col0 decl" id="10heap" title='heap' data-type='PyListObject *' data-ref="10heap">heap</dfn>, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col1 decl" id="11pos" title='pos' data-type='Py_ssize_t' data-ref="11pos">pos</dfn>)</td></tr>
<tr><th id="54">54</th><td>{</td></tr>
<tr><th id="55">55</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col2 decl" id="12startpos" title='startpos' data-type='Py_ssize_t' data-ref="12startpos">startpos</dfn>, <dfn class="local col3 decl" id="13endpos" title='endpos' data-type='Py_ssize_t' data-ref="13endpos">endpos</dfn>, <dfn class="local col4 decl" id="14childpos" title='childpos' data-type='Py_ssize_t' data-ref="14childpos">childpos</dfn>, <dfn class="local col5 decl" id="15limit" title='limit' data-type='Py_ssize_t' data-ref="15limit">limit</dfn>;</td></tr>
<tr><th id="56">56</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col6 decl" id="16tmp1" title='tmp1' data-type='PyObject *' data-ref="16tmp1">tmp1</dfn>, *<dfn class="local col7 decl" id="17tmp2" title='tmp2' data-type='PyObject *' data-ref="17tmp2">tmp2</dfn>, **<dfn class="local col8 decl" id="18arr" title='arr' data-type='PyObject **' data-ref="18arr">arr</dfn>;</td></tr>
<tr><th id="57">57</th><td>    <em>int</em> <dfn class="local col9 decl" id="19cmp" title='cmp' data-type='int' data-ref="19cmp">cmp</dfn>;</td></tr>
<tr><th id="58">58</th><td></td></tr>
<tr><th id="59">59</th><td>    <a class="macro" href="../../include/assert.h.html#88" title="((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 59, __PRETTY_FUNCTION__))" data-ref="_M/assert">assert</a>(<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col0 ref" href="#10heap" title='heap' data-ref="10heap">heap</a>));</td></tr>
<tr><th id="60">60</th><td>    <a class="local col3 ref" href="#13endpos" title='endpos' data-ref="13endpos">endpos</a> = <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 60, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col0 ref" href="#10heap" title='heap' data-ref="10heap">heap</a>);</td></tr>
<tr><th id="61">61</th><td>    <a class="local col2 ref" href="#12startpos" title='startpos' data-ref="12startpos">startpos</a> = <a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a>;</td></tr>
<tr><th id="62">62</th><td>    <b>if</b> (<a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a> &gt;= <a class="local col3 ref" href="#13endpos" title='endpos' data-ref="13endpos">endpos</a>) {</td></tr>
<tr><th id="63">63</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_IndexError" title='PyExc_IndexError' data-ref="PyExc_IndexError">PyExc_IndexError</a>, <q>"index out of range"</q>);</td></tr>
<tr><th id="64">64</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="65">65</th><td>    }</td></tr>
<tr><th id="66">66</th><td></td></tr>
<tr><th id="67">67</th><td>    <i>/* Bubble up the smaller child until hitting a leaf. */</i></td></tr>
<tr><th id="68">68</th><td>    <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col0 ref" href="#10heap" title='heap' data-ref="10heap">heap</a>);</td></tr>
<tr><th id="69">69</th><td>    <a class="local col5 ref" href="#15limit" title='limit' data-ref="15limit">limit</a> = <a class="local col3 ref" href="#13endpos" title='endpos' data-ref="13endpos">endpos</a> &gt;&gt; <var>1</var>;         <i>/* smallest pos that has no child */</i></td></tr>
<tr><th id="70">70</th><td>    <b>while</b> (<a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a> &lt; <a class="local col5 ref" href="#15limit" title='limit' data-ref="15limit">limit</a>) {</td></tr>
<tr><th id="71">71</th><td>        <i>/* Set childpos to index of smaller child.   */</i></td></tr>
<tr><th id="72">72</th><td>        <a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a> = <var>2</var>*<a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a> + <var>1</var>;    <i>/* leftmost child position  */</i></td></tr>
<tr><th id="73">73</th><td>        <b>if</b> (<a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a> + <var>1</var> &lt; <a class="local col3 ref" href="#13endpos" title='endpos' data-ref="13endpos">endpos</a>) {</td></tr>
<tr><th id="74">74</th><td>            <a class="local col9 ref" href="#19cmp" title='cmp' data-ref="19cmp">cmp</a> = <a class="ref" href="../Include/object.h.html#PyObject_RichCompareBool" title='PyObject_RichCompareBool' data-ref="PyObject_RichCompareBool">PyObject_RichCompareBool</a>(</td></tr>
<tr><th id="75">75</th><td>                <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a>[<a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a>],</td></tr>
<tr><th id="76">76</th><td>                <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a>[<a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a> + <var>1</var>],</td></tr>
<tr><th id="77">77</th><td>                <a class="macro" href="../Include/object.h.html#927" title="0" data-ref="_M/Py_LT">Py_LT</a>);</td></tr>
<tr><th id="78">78</th><td>            <b>if</b> (<a class="local col9 ref" href="#19cmp" title='cmp' data-ref="19cmp">cmp</a> &lt; <var>0</var>)</td></tr>
<tr><th id="79">79</th><td>                <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="80">80</th><td>            <a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a> += ((<em>unsigned</em>)<a class="local col9 ref" href="#19cmp" title='cmp' data-ref="19cmp">cmp</a> ^ <var>1</var>);   <i>/* increment when cmp==0 */</i></td></tr>
<tr><th id="81">81</th><td>            <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col0 ref" href="#10heap" title='heap' data-ref="10heap">heap</a>);         <i>/* arr may have changed */</i></td></tr>
<tr><th id="82">82</th><td>            <b>if</b> (<a class="local col3 ref" href="#13endpos" title='endpos' data-ref="13endpos">endpos</a> != <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 82, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col0 ref" href="#10heap" title='heap' data-ref="10heap">heap</a>)) {</td></tr>
<tr><th id="83">83</th><td>                <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_RuntimeError" title='PyExc_RuntimeError' data-ref="PyExc_RuntimeError">PyExc_RuntimeError</a>,</td></tr>
<tr><th id="84">84</th><td>                                <q>"list changed size during iteration"</q>);</td></tr>
<tr><th id="85">85</th><td>                <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="86">86</th><td>            }</td></tr>
<tr><th id="87">87</th><td>        }</td></tr>
<tr><th id="88">88</th><td>        <i>/* Move the smaller child up. */</i></td></tr>
<tr><th id="89">89</th><td>        <a class="local col6 ref" href="#16tmp1" title='tmp1' data-ref="16tmp1">tmp1</a> = <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a>[<a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a>];</td></tr>
<tr><th id="90">90</th><td>        <a class="local col7 ref" href="#17tmp2" title='tmp2' data-ref="17tmp2">tmp2</a> = <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a>[<a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a>];</td></tr>
<tr><th id="91">91</th><td>        <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a>[<a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a>] = <a class="local col7 ref" href="#17tmp2" title='tmp2' data-ref="17tmp2">tmp2</a>;</td></tr>
<tr><th id="92">92</th><td>        <a class="local col8 ref" href="#18arr" title='arr' data-ref="18arr">arr</a>[<a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a>] = <a class="local col6 ref" href="#16tmp1" title='tmp1' data-ref="16tmp1">tmp1</a>;</td></tr>
<tr><th id="93">93</th><td>        <a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a> = <a class="local col4 ref" href="#14childpos" title='childpos' data-ref="14childpos">childpos</a>;</td></tr>
<tr><th id="94">94</th><td>    }</td></tr>
<tr><th id="95">95</th><td>    <i>/* Bubble it up to its final resting place (by sifting its parents down). */</i></td></tr>
<tr><th id="96">96</th><td>    <b>return</b> <a class="tu ref" href="#siftdown" title='siftdown' data-use='c' data-ref="siftdown">siftdown</a>(<a class="local col0 ref" href="#10heap" title='heap' data-ref="10heap">heap</a>, <a class="local col2 ref" href="#12startpos" title='startpos' data-ref="12startpos">startpos</a>, <a class="local col1 ref" href="#11pos" title='pos' data-ref="11pos">pos</a>);</td></tr>
<tr><th id="97">97</th><td>}</td></tr>
<tr><th id="98">98</th><td></td></tr>
<tr><th id="99">99</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="100">100</th><td><dfn class="tu decl def" id="heappush" title='heappush' data-type='PyObject * heappush(PyObject * self, PyObject * args)' data-ref="heappush">heappush</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col0 decl" id="20self" title='self' data-type='PyObject *' data-ref="20self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col1 decl" id="21args" title='args' data-type='PyObject *' data-ref="21args">args</dfn>)</td></tr>
<tr><th id="101">101</th><td>{</td></tr>
<tr><th id="102">102</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col2 decl" id="22heap" title='heap' data-type='PyObject *' data-ref="22heap">heap</dfn>, *<dfn class="local col3 decl" id="23item" title='item' data-type='PyObject *' data-ref="23item">item</dfn>;</td></tr>
<tr><th id="103">103</th><td></td></tr>
<tr><th id="104">104</th><td>    <b>if</b> (!<a class="ref" href="../Include/modsupport.h.html#PyArg_UnpackTuple" title='PyArg_UnpackTuple' data-ref="PyArg_UnpackTuple">PyArg_UnpackTuple</a>(<a class="local col1 ref" href="#21args" title='args' data-ref="21args">args</a>, <q>"heappush"</q>, <var>2</var>, <var>2</var>, &amp;<a class="local col2 ref" href="#22heap" title='heap' data-ref="22heap">heap</a>, &amp;<a class="local col3 ref" href="#23item" title='item' data-ref="23item">item</a>))</td></tr>
<tr><th id="105">105</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="106">106</th><td></td></tr>
<tr><th id="107">107</th><td>    <b>if</b> (!<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col2 ref" href="#22heap" title='heap' data-ref="22heap">heap</a>)) {</td></tr>
<tr><th id="108">108</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_TypeError" title='PyExc_TypeError' data-ref="PyExc_TypeError">PyExc_TypeError</a>, <q>"heap argument must be a list"</q>);</td></tr>
<tr><th id="109">109</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="110">110</th><td>    }</td></tr>
<tr><th id="111">111</th><td></td></tr>
<tr><th id="112">112</th><td>    <b>if</b> (<a class="ref" href="../Include/listobject.h.html#PyList_Append" title='PyList_Append' data-ref="PyList_Append">PyList_Append</a>(<a class="local col2 ref" href="#22heap" title='heap' data-ref="22heap">heap</a>, <a class="local col3 ref" href="#23item" title='item' data-ref="23item">item</a>))</td></tr>
<tr><th id="113">113</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="114">114</th><td></td></tr>
<tr><th id="115">115</th><td>    <b>if</b> (<a class="tu ref" href="#siftdown" title='siftdown' data-use='c' data-ref="siftdown">siftdown</a>((<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *)<a class="local col2 ref" href="#22heap" title='heap' data-ref="22heap">heap</a>, <var>0</var>, <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 115, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col2 ref" href="#22heap" title='heap' data-ref="22heap">heap</a>)-<var>1</var>))</td></tr>
<tr><th id="116">116</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="117">117</th><td>    <a class="macro" href="../Include/object.h.html#913" title="return ( _Py_RefTotal++ , ((PyObject *)((&amp;_Py_NoneStruct)))-&gt;ob_refcnt++), (&amp;_Py_NoneStruct)" data-ref="_M/Py_RETURN_NONE">Py_RETURN_NONE</a>;</td></tr>
<tr><th id="118">118</th><td>}</td></tr>
<tr><th id="119">119</th><td></td></tr>
<tr><th id="120">120</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heappush_doc[] = &quot;heappush(heap, item) -&gt; None. Push item onto heap, maintaining the heap invariant.&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heappush_doc" title='heappush_doc' data-ref="heappush_doc">heappush_doc</dfn>,</td></tr>
<tr><th id="121">121</th><td><q>"heappush(heap, item) -&gt; None. Push item onto heap, maintaining the heap invariant."</q>);</td></tr>
<tr><th id="122">122</th><td></td></tr>
<tr><th id="123">123</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="124">124</th><td><dfn class="tu decl def" id="heappop_internal" title='heappop_internal' data-type='PyObject * heappop_internal(PyObject * heap, int (*)(PyListObject *, Py_ssize_t) siftup_func)' data-ref="heappop_internal">heappop_internal</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col4 decl" id="24heap" title='heap' data-type='PyObject *' data-ref="24heap">heap</dfn>, <em>int</em> <dfn class="local col5 decl" id="25siftup_func" title='siftup_func' data-type='int (*)(PyListObject *, Py_ssize_t)' data-ref="25siftup_func">siftup_func</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a>))</td></tr>
<tr><th id="125">125</th><td>{</td></tr>
<tr><th id="126">126</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col6 decl" id="26lastelt" title='lastelt' data-type='PyObject *' data-ref="26lastelt">lastelt</dfn>, *<dfn class="local col7 decl" id="27returnitem" title='returnitem' data-type='PyObject *' data-ref="27returnitem">returnitem</dfn>;</td></tr>
<tr><th id="127">127</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col8 decl" id="28n" title='n' data-type='Py_ssize_t' data-ref="28n">n</dfn>;</td></tr>
<tr><th id="128">128</th><td></td></tr>
<tr><th id="129">129</th><td>    <b>if</b> (!<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>)) {</td></tr>
<tr><th id="130">130</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_TypeError" title='PyExc_TypeError' data-ref="PyExc_TypeError">PyExc_TypeError</a>, <q>"heap argument must be a list"</q>);</td></tr>
<tr><th id="131">131</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="132">132</th><td>    }</td></tr>
<tr><th id="133">133</th><td></td></tr>
<tr><th id="134">134</th><td>    <i>/* raises IndexError if the heap is empty */</i></td></tr>
<tr><th id="135">135</th><td>    <a class="local col8 ref" href="#28n" title='n' data-ref="28n">n</a> = <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 135, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>);</td></tr>
<tr><th id="136">136</th><td>    <b>if</b> (<a class="local col8 ref" href="#28n" title='n' data-ref="28n">n</a> == <var>0</var>) {</td></tr>
<tr><th id="137">137</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_IndexError" title='PyExc_IndexError' data-ref="PyExc_IndexError">PyExc_IndexError</a>, <q>"index out of range"</q>);</td></tr>
<tr><th id="138">138</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="139">139</th><td>    }</td></tr>
<tr><th id="140">140</th><td></td></tr>
<tr><th id="141">141</th><td>    <a class="local col6 ref" href="#26lastelt" title='lastelt' data-ref="26lastelt">lastelt</a> = <a class="macro" href="../Include/listobject.h.html#72" title="(((PyListObject *)(heap))-&gt;ob_item[n-1])" data-ref="_M/PyList_GET_ITEM">PyList_GET_ITEM</a>(<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>, <a class="local col8 ref" href="#28n" title='n' data-ref="28n">n</a>-<var>1</var>) ;</td></tr>
<tr><th id="142">142</th><td>    <a class="macro" href="../Include/object.h.html#783" title="( _Py_RefTotal++ , ((PyObject *)(lastelt))-&gt;ob_refcnt++)" data-ref="_M/Py_INCREF">Py_INCREF</a>(<a class="local col6 ref" href="#26lastelt" title='lastelt' data-ref="26lastelt">lastelt</a>);</td></tr>
<tr><th id="143">143</th><td>    <b>if</b> (<a class="ref" href="../Include/listobject.h.html#PyList_SetSlice" title='PyList_SetSlice' data-ref="PyList_SetSlice">PyList_SetSlice</a>(<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>, <a class="local col8 ref" href="#28n" title='n' data-ref="28n">n</a>-<var>1</var>, <a class="local col8 ref" href="#28n" title='n' data-ref="28n">n</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)) {</td></tr>
<tr><th id="144">144</th><td>        <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(lastelt); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 144, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col6 ref" href="#26lastelt" title='lastelt' data-ref="26lastelt">lastelt</a>);</td></tr>
<tr><th id="145">145</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="146">146</th><td>    }</td></tr>
<tr><th id="147">147</th><td>    <a class="local col8 ref" href="#28n" title='n' data-ref="28n">n</a>--;</td></tr>
<tr><th id="148">148</th><td></td></tr>
<tr><th id="149">149</th><td>    <b>if</b> (!<a class="local col8 ref" href="#28n" title='n' data-ref="28n">n</a>)</td></tr>
<tr><th id="150">150</th><td>        <b>return</b> <a class="local col6 ref" href="#26lastelt" title='lastelt' data-ref="26lastelt">lastelt</a>;</td></tr>
<tr><th id="151">151</th><td>    <a class="local col7 ref" href="#27returnitem" title='returnitem' data-ref="27returnitem">returnitem</a> = <a class="macro" href="../Include/listobject.h.html#72" title="(((PyListObject *)(heap))-&gt;ob_item[0])" data-ref="_M/PyList_GET_ITEM">PyList_GET_ITEM</a>(<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>, <var>0</var>);</td></tr>
<tr><th id="152">152</th><td>    <a class="macro" href="../Include/listobject.h.html#73" title="(((PyListObject *)(heap))-&gt;ob_item[0] = (lastelt))" data-ref="_M/PyList_SET_ITEM">PyList_SET_ITEM</a>(<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>, <var>0</var>, <a class="local col6 ref" href="#26lastelt" title='lastelt' data-ref="26lastelt">lastelt</a>);</td></tr>
<tr><th id="153">153</th><td>    <b>if</b> (<a class="local col5 ref" href="#25siftup_func" title='siftup_func' data-ref="25siftup_func">siftup_func</a>((<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *)<a class="local col4 ref" href="#24heap" title='heap' data-ref="24heap">heap</a>, <var>0</var>)) {</td></tr>
<tr><th id="154">154</th><td>        <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(returnitem); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 154, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col7 ref" href="#27returnitem" title='returnitem' data-ref="27returnitem">returnitem</a>);</td></tr>
<tr><th id="155">155</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="156">156</th><td>    }</td></tr>
<tr><th id="157">157</th><td>    <b>return</b> <a class="local col7 ref" href="#27returnitem" title='returnitem' data-ref="27returnitem">returnitem</a>;</td></tr>
<tr><th id="158">158</th><td>}</td></tr>
<tr><th id="159">159</th><td></td></tr>
<tr><th id="160">160</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="161">161</th><td><dfn class="tu decl def" id="heappop" title='heappop' data-type='PyObject * heappop(PyObject * self, PyObject * heap)' data-ref="heappop">heappop</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col9 decl" id="29self" title='self' data-type='PyObject *' data-ref="29self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col0 decl" id="30heap" title='heap' data-type='PyObject *' data-ref="30heap">heap</dfn>)</td></tr>
<tr><th id="162">162</th><td>{</td></tr>
<tr><th id="163">163</th><td>    <b>return</b> <a class="tu ref" href="#heappop_internal" title='heappop_internal' data-use='c' data-ref="heappop_internal">heappop_internal</a>(<a class="local col0 ref" href="#30heap" title='heap' data-ref="30heap">heap</a>, <a class="tu ref" href="#siftup" title='siftup' data-use='r' data-ref="siftup">siftup</a>);</td></tr>
<tr><th id="164">164</th><td>}</td></tr>
<tr><th id="165">165</th><td></td></tr>
<tr><th id="166">166</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heappop_doc[] = &quot;Pop the smallest item off the heap, maintaining the heap invariant.&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heappop_doc" title='heappop_doc' data-ref="heappop_doc">heappop_doc</dfn>,</td></tr>
<tr><th id="167">167</th><td><q>"Pop the smallest item off the heap, maintaining the heap invariant."</q>);</td></tr>
<tr><th id="168">168</th><td></td></tr>
<tr><th id="169">169</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="170">170</th><td><dfn class="tu decl def" id="heapreplace_internal" title='heapreplace_internal' data-type='PyObject * heapreplace_internal(PyObject * args, int (*)(PyListObject *, Py_ssize_t) siftup_func)' data-ref="heapreplace_internal">heapreplace_internal</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col1 decl" id="31args" title='args' data-type='PyObject *' data-ref="31args">args</dfn>, <em>int</em> <dfn class="local col2 decl" id="32siftup_func" title='siftup_func' data-type='int (*)(PyListObject *, Py_ssize_t)' data-ref="32siftup_func">siftup_func</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a>))</td></tr>
<tr><th id="171">171</th><td>{</td></tr>
<tr><th id="172">172</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col3 decl" id="33heap" title='heap' data-type='PyObject *' data-ref="33heap">heap</dfn>, *<dfn class="local col4 decl" id="34item" title='item' data-type='PyObject *' data-ref="34item">item</dfn>, *<dfn class="local col5 decl" id="35returnitem" title='returnitem' data-type='PyObject *' data-ref="35returnitem">returnitem</dfn>;</td></tr>
<tr><th id="173">173</th><td></td></tr>
<tr><th id="174">174</th><td>    <b>if</b> (!<a class="ref" href="../Include/modsupport.h.html#PyArg_UnpackTuple" title='PyArg_UnpackTuple' data-ref="PyArg_UnpackTuple">PyArg_UnpackTuple</a>(<a class="local col1 ref" href="#31args" title='args' data-ref="31args">args</a>, <q>"heapreplace"</q>, <var>2</var>, <var>2</var>, &amp;<a class="local col3 ref" href="#33heap" title='heap' data-ref="33heap">heap</a>, &amp;<a class="local col4 ref" href="#34item" title='item' data-ref="34item">item</a>))</td></tr>
<tr><th id="175">175</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="176">176</th><td></td></tr>
<tr><th id="177">177</th><td>    <b>if</b> (!<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col3 ref" href="#33heap" title='heap' data-ref="33heap">heap</a>)) {</td></tr>
<tr><th id="178">178</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_TypeError" title='PyExc_TypeError' data-ref="PyExc_TypeError">PyExc_TypeError</a>, <q>"heap argument must be a list"</q>);</td></tr>
<tr><th id="179">179</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="180">180</th><td>    }</td></tr>
<tr><th id="181">181</th><td></td></tr>
<tr><th id="182">182</th><td>    <b>if</b> (<a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 182, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col3 ref" href="#33heap" title='heap' data-ref="33heap">heap</a>) == <var>0</var>) {</td></tr>
<tr><th id="183">183</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_IndexError" title='PyExc_IndexError' data-ref="PyExc_IndexError">PyExc_IndexError</a>, <q>"index out of range"</q>);</td></tr>
<tr><th id="184">184</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="185">185</th><td>    }</td></tr>
<tr><th id="186">186</th><td></td></tr>
<tr><th id="187">187</th><td>    <a class="local col5 ref" href="#35returnitem" title='returnitem' data-ref="35returnitem">returnitem</a> = <a class="macro" href="../Include/listobject.h.html#72" title="(((PyListObject *)(heap))-&gt;ob_item[0])" data-ref="_M/PyList_GET_ITEM">PyList_GET_ITEM</a>(<a class="local col3 ref" href="#33heap" title='heap' data-ref="33heap">heap</a>, <var>0</var>);</td></tr>
<tr><th id="188">188</th><td>    <a class="macro" href="../Include/object.h.html#783" title="( _Py_RefTotal++ , ((PyObject *)(item))-&gt;ob_refcnt++)" data-ref="_M/Py_INCREF">Py_INCREF</a>(<a class="local col4 ref" href="#34item" title='item' data-ref="34item">item</a>);</td></tr>
<tr><th id="189">189</th><td>    <a class="macro" href="../Include/listobject.h.html#73" title="(((PyListObject *)(heap))-&gt;ob_item[0] = (item))" data-ref="_M/PyList_SET_ITEM">PyList_SET_ITEM</a>(<a class="local col3 ref" href="#33heap" title='heap' data-ref="33heap">heap</a>, <var>0</var>, <a class="local col4 ref" href="#34item" title='item' data-ref="34item">item</a>);</td></tr>
<tr><th id="190">190</th><td>    <b>if</b> (<a class="local col2 ref" href="#32siftup_func" title='siftup_func' data-ref="32siftup_func">siftup_func</a>((<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *)<a class="local col3 ref" href="#33heap" title='heap' data-ref="33heap">heap</a>, <var>0</var>)) {</td></tr>
<tr><th id="191">191</th><td>        <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(returnitem); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 191, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col5 ref" href="#35returnitem" title='returnitem' data-ref="35returnitem">returnitem</a>);</td></tr>
<tr><th id="192">192</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="193">193</th><td>    }</td></tr>
<tr><th id="194">194</th><td>    <b>return</b> <a class="local col5 ref" href="#35returnitem" title='returnitem' data-ref="35returnitem">returnitem</a>;</td></tr>
<tr><th id="195">195</th><td>}</td></tr>
<tr><th id="196">196</th><td></td></tr>
<tr><th id="197">197</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="198">198</th><td><dfn class="tu decl def" id="heapreplace" title='heapreplace' data-type='PyObject * heapreplace(PyObject * self, PyObject * args)' data-ref="heapreplace">heapreplace</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col6 decl" id="36self" title='self' data-type='PyObject *' data-ref="36self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col7 decl" id="37args" title='args' data-type='PyObject *' data-ref="37args">args</dfn>)</td></tr>
<tr><th id="199">199</th><td>{</td></tr>
<tr><th id="200">200</th><td>    <b>return</b> <a class="tu ref" href="#heapreplace_internal" title='heapreplace_internal' data-use='c' data-ref="heapreplace_internal">heapreplace_internal</a>(<a class="local col7 ref" href="#37args" title='args' data-ref="37args">args</a>, <a class="tu ref" href="#siftup" title='siftup' data-use='r' data-ref="siftup">siftup</a>);</td></tr>
<tr><th id="201">201</th><td>}</td></tr>
<tr><th id="202">202</th><td></td></tr>
<tr><th id="203">203</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heapreplace_doc[] = &quot;heapreplace(heap, item) -&gt; value. Pop and return the current smallest value, and add the new item.\n\nThis is more efficient than heappop() followed by heappush(), and can be\nmore appropriate when using a fixed-size heap.  Note that the value\nreturned may be larger than item!  That constrains reasonable uses of\nthis routine unless written as part of a conditional replacement:\n\n    if item &gt; heap[0]:\n        item = heapreplace(heap, item)\n&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heapreplace_doc" title='heapreplace_doc' data-ref="heapreplace_doc">heapreplace_doc</dfn>,</td></tr>
<tr><th id="204">204</th><td><q>"heapreplace(heap, item) -&gt; value. Pop and return the current smallest value, and add the new item.\n\</q></td></tr>
<tr><th id="205">205</th><td><q>\n\</q></td></tr>
<tr><th id="206">206</th><td><q>This is more efficient than heappop() followed by heappush(), and can be\n\</q></td></tr>
<tr><th id="207">207</th><td><q>more appropriate when using a fixed-size heap.  Note that the value\n\</q></td></tr>
<tr><th id="208">208</th><td><q>returned may be larger than item!  That constrains reasonable uses of\n\</q></td></tr>
<tr><th id="209">209</th><td><q>this routine unless written as part of a conditional replacement:\n\n\</q></td></tr>
<tr><th id="210">210</th><td><q>    if item &gt; heap[0]:\n\</q></td></tr>
<tr><th id="211">211</th><td><q>        item = heapreplace(heap, item)\n"</q>);</td></tr>
<tr><th id="212">212</th><td></td></tr>
<tr><th id="213">213</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="214">214</th><td><dfn class="tu decl def" id="heappushpop" title='heappushpop' data-type='PyObject * heappushpop(PyObject * self, PyObject * args)' data-ref="heappushpop">heappushpop</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col8 decl" id="38self" title='self' data-type='PyObject *' data-ref="38self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col9 decl" id="39args" title='args' data-type='PyObject *' data-ref="39args">args</dfn>)</td></tr>
<tr><th id="215">215</th><td>{</td></tr>
<tr><th id="216">216</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col0 decl" id="40heap" title='heap' data-type='PyObject *' data-ref="40heap">heap</dfn>, *<dfn class="local col1 decl" id="41item" title='item' data-type='PyObject *' data-ref="41item">item</dfn>, *<dfn class="local col2 decl" id="42returnitem" title='returnitem' data-type='PyObject *' data-ref="42returnitem">returnitem</dfn>;</td></tr>
<tr><th id="217">217</th><td>    <em>int</em> <dfn class="local col3 decl" id="43cmp" title='cmp' data-type='int' data-ref="43cmp">cmp</dfn>;</td></tr>
<tr><th id="218">218</th><td></td></tr>
<tr><th id="219">219</th><td>    <b>if</b> (!<a class="ref" href="../Include/modsupport.h.html#PyArg_UnpackTuple" title='PyArg_UnpackTuple' data-ref="PyArg_UnpackTuple">PyArg_UnpackTuple</a>(<a class="local col9 ref" href="#39args" title='args' data-ref="39args">args</a>, <q>"heappushpop"</q>, <var>2</var>, <var>2</var>, &amp;<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>, &amp;<a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>))</td></tr>
<tr><th id="220">220</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="221">221</th><td></td></tr>
<tr><th id="222">222</th><td>    <b>if</b> (!<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>)) {</td></tr>
<tr><th id="223">223</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_TypeError" title='PyExc_TypeError' data-ref="PyExc_TypeError">PyExc_TypeError</a>, <q>"heap argument must be a list"</q>);</td></tr>
<tr><th id="224">224</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="225">225</th><td>    }</td></tr>
<tr><th id="226">226</th><td></td></tr>
<tr><th id="227">227</th><td>    <b>if</b> (<a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 227, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>) == <var>0</var>) {</td></tr>
<tr><th id="228">228</th><td>        <a class="macro" href="../Include/object.h.html#783" title="( _Py_RefTotal++ , ((PyObject *)(item))-&gt;ob_refcnt++)" data-ref="_M/Py_INCREF">Py_INCREF</a>(<a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>);</td></tr>
<tr><th id="229">229</th><td>        <b>return</b> <a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>;</td></tr>
<tr><th id="230">230</th><td>    }</td></tr>
<tr><th id="231">231</th><td></td></tr>
<tr><th id="232">232</th><td>    <a class="local col3 ref" href="#43cmp" title='cmp' data-ref="43cmp">cmp</a> = <a class="ref" href="../Include/object.h.html#PyObject_RichCompareBool" title='PyObject_RichCompareBool' data-ref="PyObject_RichCompareBool">PyObject_RichCompareBool</a>(<a class="macro" href="../Include/listobject.h.html#72" title="(((PyListObject *)(heap))-&gt;ob_item[0])" data-ref="_M/PyList_GET_ITEM">PyList_GET_ITEM</a>(<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>, <var>0</var>), <a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>, <a class="macro" href="../Include/object.h.html#927" title="0" data-ref="_M/Py_LT">Py_LT</a>);</td></tr>
<tr><th id="233">233</th><td>    <b>if</b> (<a class="local col3 ref" href="#43cmp" title='cmp' data-ref="43cmp">cmp</a> &lt; <var>0</var>)</td></tr>
<tr><th id="234">234</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="235">235</th><td>    <b>if</b> (<a class="local col3 ref" href="#43cmp" title='cmp' data-ref="43cmp">cmp</a> == <var>0</var>) {</td></tr>
<tr><th id="236">236</th><td>        <a class="macro" href="../Include/object.h.html#783" title="( _Py_RefTotal++ , ((PyObject *)(item))-&gt;ob_refcnt++)" data-ref="_M/Py_INCREF">Py_INCREF</a>(<a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>);</td></tr>
<tr><th id="237">237</th><td>        <b>return</b> <a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>;</td></tr>
<tr><th id="238">238</th><td>    }</td></tr>
<tr><th id="239">239</th><td></td></tr>
<tr><th id="240">240</th><td>    <b>if</b> (<a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 240, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>) == <var>0</var>) {</td></tr>
<tr><th id="241">241</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_IndexError" title='PyExc_IndexError' data-ref="PyExc_IndexError">PyExc_IndexError</a>, <q>"index out of range"</q>);</td></tr>
<tr><th id="242">242</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="243">243</th><td>    }</td></tr>
<tr><th id="244">244</th><td></td></tr>
<tr><th id="245">245</th><td>    <a class="local col2 ref" href="#42returnitem" title='returnitem' data-ref="42returnitem">returnitem</a> = <a class="macro" href="../Include/listobject.h.html#72" title="(((PyListObject *)(heap))-&gt;ob_item[0])" data-ref="_M/PyList_GET_ITEM">PyList_GET_ITEM</a>(<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>, <var>0</var>);</td></tr>
<tr><th id="246">246</th><td>    <a class="macro" href="../Include/object.h.html#783" title="( _Py_RefTotal++ , ((PyObject *)(item))-&gt;ob_refcnt++)" data-ref="_M/Py_INCREF">Py_INCREF</a>(<a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>);</td></tr>
<tr><th id="247">247</th><td>    <a class="macro" href="../Include/listobject.h.html#73" title="(((PyListObject *)(heap))-&gt;ob_item[0] = (item))" data-ref="_M/PyList_SET_ITEM">PyList_SET_ITEM</a>(<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>, <var>0</var>, <a class="local col1 ref" href="#41item" title='item' data-ref="41item">item</a>);</td></tr>
<tr><th id="248">248</th><td>    <b>if</b> (<a class="tu ref" href="#siftup" title='siftup' data-use='c' data-ref="siftup">siftup</a>((<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *)<a class="local col0 ref" href="#40heap" title='heap' data-ref="40heap">heap</a>, <var>0</var>)) {</td></tr>
<tr><th id="249">249</th><td>        <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(returnitem); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 249, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col2 ref" href="#42returnitem" title='returnitem' data-ref="42returnitem">returnitem</a>);</td></tr>
<tr><th id="250">250</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="251">251</th><td>    }</td></tr>
<tr><th id="252">252</th><td>    <b>return</b> <a class="local col2 ref" href="#42returnitem" title='returnitem' data-ref="42returnitem">returnitem</a>;</td></tr>
<tr><th id="253">253</th><td>}</td></tr>
<tr><th id="254">254</th><td></td></tr>
<tr><th id="255">255</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heappushpop_doc[] = &quot;heappushpop(heap, item) -&gt; value. Push item on the heap, then pop and return the smallest item\nfrom the heap. The combined action runs more efficiently than\nheappush() followed by a separate call to heappop().&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heappushpop_doc" title='heappushpop_doc' data-ref="heappushpop_doc">heappushpop_doc</dfn>,</td></tr>
<tr><th id="256">256</th><td><q>"heappushpop(heap, item) -&gt; value. Push item on the heap, then pop and return the smallest item\n\</q></td></tr>
<tr><th id="257">257</th><td><q>from the heap. The combined action runs more efficiently than\n\</q></td></tr>
<tr><th id="258">258</th><td><q>heappush() followed by a separate call to heappop()."</q>);</td></tr>
<tr><th id="259">259</th><td></td></tr>
<tr><th id="260">260</th><td><em>static</em> <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a></td></tr>
<tr><th id="261">261</th><td><dfn class="tu decl def" id="keep_top_bit" title='keep_top_bit' data-type='Py_ssize_t keep_top_bit(Py_ssize_t n)' data-ref="keep_top_bit">keep_top_bit</dfn>(<a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col4 decl" id="44n" title='n' data-type='Py_ssize_t' data-ref="44n">n</dfn>)</td></tr>
<tr><th id="262">262</th><td>{</td></tr>
<tr><th id="263">263</th><td>    <em>int</em> <dfn class="local col5 decl" id="45i" title='i' data-type='int' data-ref="45i">i</dfn> = <var>0</var>;</td></tr>
<tr><th id="264">264</th><td></td></tr>
<tr><th id="265">265</th><td>    <b>while</b> (<a class="local col4 ref" href="#44n" title='n' data-ref="44n">n</a> &gt; <var>1</var>) {</td></tr>
<tr><th id="266">266</th><td>        <a class="local col4 ref" href="#44n" title='n' data-ref="44n">n</a> &gt;&gt;= <var>1</var>;</td></tr>
<tr><th id="267">267</th><td>        <a class="local col5 ref" href="#45i" title='i' data-ref="45i">i</a>++;</td></tr>
<tr><th id="268">268</th><td>    }</td></tr>
<tr><th id="269">269</th><td>    <b>return</b> <a class="local col4 ref" href="#44n" title='n' data-ref="44n">n</a> &lt;&lt; <a class="local col5 ref" href="#45i" title='i' data-ref="45i">i</a>;</td></tr>
<tr><th id="270">270</th><td>}</td></tr>
<tr><th id="271">271</th><td></td></tr>
<tr><th id="272">272</th><td><i  data-doc="cache_friendly_heapify">/* Cache friendly version of heapify()</i></td></tr>
<tr><th id="273">273</th><td><i  data-doc="cache_friendly_heapify">   -----------------------------------</i></td></tr>
<tr><th id="274">274</th><td><i  data-doc="cache_friendly_heapify"></i></td></tr>
<tr><th id="275">275</th><td><i  data-doc="cache_friendly_heapify">   Build-up a heap in O(n) time by performing siftup() operations</i></td></tr>
<tr><th id="276">276</th><td><i  data-doc="cache_friendly_heapify">   on nodes whose children are already heaps.</i></td></tr>
<tr><th id="277">277</th><td><i  data-doc="cache_friendly_heapify"></i></td></tr>
<tr><th id="278">278</th><td><i  data-doc="cache_friendly_heapify">   The simplest way is to sift the nodes in reverse order from</i></td></tr>
<tr><th id="279">279</th><td><i  data-doc="cache_friendly_heapify">   n//2-1 to 0 inclusive.  The downside is that children may be</i></td></tr>
<tr><th id="280">280</th><td><i  data-doc="cache_friendly_heapify">   out of cache by the time their parent is reached.</i></td></tr>
<tr><th id="281">281</th><td><i  data-doc="cache_friendly_heapify"></i></td></tr>
<tr><th id="282">282</th><td><i  data-doc="cache_friendly_heapify">   A better way is to not wait for the children to go out of cache.</i></td></tr>
<tr><th id="283">283</th><td><i  data-doc="cache_friendly_heapify">   Once a sibling pair of child nodes have been sifted, immediately</i></td></tr>
<tr><th id="284">284</th><td><i  data-doc="cache_friendly_heapify">   sift their parent node (while the children are still in cache).</i></td></tr>
<tr><th id="285">285</th><td><i  data-doc="cache_friendly_heapify"></i></td></tr>
<tr><th id="286">286</th><td><i  data-doc="cache_friendly_heapify">   Both ways build child heaps before their parents, so both ways</i></td></tr>
<tr><th id="287">287</th><td><i  data-doc="cache_friendly_heapify">   do the exact same number of comparisons and produce exactly</i></td></tr>
<tr><th id="288">288</th><td><i  data-doc="cache_friendly_heapify">   the same heap.  The only difference is that the traversal</i></td></tr>
<tr><th id="289">289</th><td><i  data-doc="cache_friendly_heapify">   order is optimized for cache efficiency.</i></td></tr>
<tr><th id="290">290</th><td><i  data-doc="cache_friendly_heapify">*/</i></td></tr>
<tr><th id="291">291</th><td></td></tr>
<tr><th id="292">292</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="293">293</th><td><dfn class="tu decl def" id="cache_friendly_heapify" title='cache_friendly_heapify' data-type='PyObject * cache_friendly_heapify(PyObject * heap, int (*)(PyListObject *, Py_ssize_t) siftup_func)' data-ref="cache_friendly_heapify">cache_friendly_heapify</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col6 decl" id="46heap" title='heap' data-type='PyObject *' data-ref="46heap">heap</dfn>, <em>int</em> <dfn class="local col7 decl" id="47siftup_func" title='siftup_func' data-type='int (*)(PyListObject *, Py_ssize_t)' data-ref="47siftup_func">siftup_func</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a>))</td></tr>
<tr><th id="294">294</th><td>{</td></tr>
<tr><th id="295">295</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col8 decl" id="48i" title='i' data-type='Py_ssize_t' data-ref="48i">i</dfn>, <dfn class="local col9 decl" id="49j" title='j' data-type='Py_ssize_t' data-ref="49j">j</dfn>, <dfn class="local col0 decl" id="50m" title='m' data-type='Py_ssize_t' data-ref="50m">m</dfn>, <dfn class="local col1 decl" id="51mhalf" title='mhalf' data-type='Py_ssize_t' data-ref="51mhalf">mhalf</dfn>, <dfn class="local col2 decl" id="52leftmost" title='leftmost' data-type='Py_ssize_t' data-ref="52leftmost">leftmost</dfn>;</td></tr>
<tr><th id="296">296</th><td></td></tr>
<tr><th id="297">297</th><td>    <a class="local col0 ref" href="#50m" title='m' data-ref="50m">m</a> = <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 297, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col6 ref" href="#46heap" title='heap' data-ref="46heap">heap</a>) &gt;&gt; <var>1</var>;         <i>/* index of first childless node */</i></td></tr>
<tr><th id="298">298</th><td>    <a class="local col2 ref" href="#52leftmost" title='leftmost' data-ref="52leftmost">leftmost</a> = <a class="tu ref" href="#keep_top_bit" title='keep_top_bit' data-use='c' data-ref="keep_top_bit">keep_top_bit</a>(<a class="local col0 ref" href="#50m" title='m' data-ref="50m">m</a> + <var>1</var>) - <var>1</var>;     <i>/* leftmost node in row of m */</i></td></tr>
<tr><th id="299">299</th><td>    <a class="local col1 ref" href="#51mhalf" title='mhalf' data-ref="51mhalf">mhalf</a> = <a class="local col0 ref" href="#50m" title='m' data-ref="50m">m</a> &gt;&gt; <var>1</var>;                         <i>/* parent of first childless node */</i></td></tr>
<tr><th id="300">300</th><td></td></tr>
<tr><th id="301">301</th><td>    <b>for</b> (<a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a> = <a class="local col2 ref" href="#52leftmost" title='leftmost' data-ref="52leftmost">leftmost</a> - <var>1</var> ; <a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a> &gt;= <a class="local col1 ref" href="#51mhalf" title='mhalf' data-ref="51mhalf">mhalf</a> ; <a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a>--) {</td></tr>
<tr><th id="302">302</th><td>        <a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a> = <a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a>;</td></tr>
<tr><th id="303">303</th><td>        <b>while</b> (<var>1</var>) {</td></tr>
<tr><th id="304">304</th><td>            <b>if</b> (<a class="local col7 ref" href="#47siftup_func" title='siftup_func' data-ref="47siftup_func">siftup_func</a>((<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *)<a class="local col6 ref" href="#46heap" title='heap' data-ref="46heap">heap</a>, <a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a>))</td></tr>
<tr><th id="305">305</th><td>                <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="306">306</th><td>            <b>if</b> (!(<a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a> &amp; <var>1</var>))</td></tr>
<tr><th id="307">307</th><td>                <b>break</b>;</td></tr>
<tr><th id="308">308</th><td>            <a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a> &gt;&gt;= <var>1</var>;</td></tr>
<tr><th id="309">309</th><td>        }</td></tr>
<tr><th id="310">310</th><td>    }</td></tr>
<tr><th id="311">311</th><td></td></tr>
<tr><th id="312">312</th><td>    <b>for</b> (<a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a> = <a class="local col0 ref" href="#50m" title='m' data-ref="50m">m</a> - <var>1</var> ; <a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a> &gt;= <a class="local col2 ref" href="#52leftmost" title='leftmost' data-ref="52leftmost">leftmost</a> ; <a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a>--) {</td></tr>
<tr><th id="313">313</th><td>        <a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a> = <a class="local col8 ref" href="#48i" title='i' data-ref="48i">i</a>;</td></tr>
<tr><th id="314">314</th><td>        <b>while</b> (<var>1</var>) {</td></tr>
<tr><th id="315">315</th><td>            <b>if</b> (<a class="local col7 ref" href="#47siftup_func" title='siftup_func' data-ref="47siftup_func">siftup_func</a>((<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *)<a class="local col6 ref" href="#46heap" title='heap' data-ref="46heap">heap</a>, <a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a>))</td></tr>
<tr><th id="316">316</th><td>                <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="317">317</th><td>            <b>if</b> (!(<a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a> &amp; <var>1</var>))</td></tr>
<tr><th id="318">318</th><td>                <b>break</b>;</td></tr>
<tr><th id="319">319</th><td>            <a class="local col9 ref" href="#49j" title='j' data-ref="49j">j</a> &gt;&gt;= <var>1</var>;</td></tr>
<tr><th id="320">320</th><td>        }</td></tr>
<tr><th id="321">321</th><td>    }</td></tr>
<tr><th id="322">322</th><td>    <a class="macro" href="../Include/object.h.html#913" title="return ( _Py_RefTotal++ , ((PyObject *)((&amp;_Py_NoneStruct)))-&gt;ob_refcnt++), (&amp;_Py_NoneStruct)" data-ref="_M/Py_RETURN_NONE">Py_RETURN_NONE</a>;</td></tr>
<tr><th id="323">323</th><td>}</td></tr>
<tr><th id="324">324</th><td></td></tr>
<tr><th id="325">325</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="326">326</th><td><dfn class="tu decl def" id="heapify_internal" title='heapify_internal' data-type='PyObject * heapify_internal(PyObject * heap, int (*)(PyListObject *, Py_ssize_t) siftup_func)' data-ref="heapify_internal">heapify_internal</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col3 decl" id="53heap" title='heap' data-type='PyObject *' data-ref="53heap">heap</dfn>, <em>int</em> <dfn class="local col4 decl" id="54siftup_func" title='siftup_func' data-type='int (*)(PyListObject *, Py_ssize_t)' data-ref="54siftup_func">siftup_func</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a>))</td></tr>
<tr><th id="327">327</th><td>{</td></tr>
<tr><th id="328">328</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col5 decl" id="55i" title='i' data-type='Py_ssize_t' data-ref="55i">i</dfn>, <dfn class="local col6 decl" id="56n" title='n' data-type='Py_ssize_t' data-ref="56n">n</dfn>;</td></tr>
<tr><th id="329">329</th><td></td></tr>
<tr><th id="330">330</th><td>    <b>if</b> (!<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col3 ref" href="#53heap" title='heap' data-ref="53heap">heap</a>)) {</td></tr>
<tr><th id="331">331</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_TypeError" title='PyExc_TypeError' data-ref="PyExc_TypeError">PyExc_TypeError</a>, <q>"heap argument must be a list"</q>);</td></tr>
<tr><th id="332">332</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="333">333</th><td>    }</td></tr>
<tr><th id="334">334</th><td></td></tr>
<tr><th id="335">335</th><td>    <i>/* For heaps likely to be bigger than L1 cache, we use the cache</i></td></tr>
<tr><th id="336">336</th><td><i>       friendly heapify function.  For smaller heaps that fit entirely</i></td></tr>
<tr><th id="337">337</th><td><i>       in cache, we prefer the simpler algorithm with less branching.</i></td></tr>
<tr><th id="338">338</th><td><i>    */</i></td></tr>
<tr><th id="339">339</th><td>    <a class="local col6 ref" href="#56n" title='n' data-ref="56n">n</a> = <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 339, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col3 ref" href="#53heap" title='heap' data-ref="53heap">heap</a>);</td></tr>
<tr><th id="340">340</th><td>    <b>if</b> (<a class="local col6 ref" href="#56n" title='n' data-ref="56n">n</a> &gt; <var>2500</var>)</td></tr>
<tr><th id="341">341</th><td>        <b>return</b> <a class="tu ref" href="#cache_friendly_heapify" title='cache_friendly_heapify' data-use='c' data-ref="cache_friendly_heapify">cache_friendly_heapify</a>(<a class="local col3 ref" href="#53heap" title='heap' data-ref="53heap">heap</a>, <a class="local col4 ref" href="#54siftup_func" title='siftup_func' data-ref="54siftup_func">siftup_func</a>);</td></tr>
<tr><th id="342">342</th><td></td></tr>
<tr><th id="343">343</th><td>    <i>/* Transform bottom-up.  The largest index there's any point to</i></td></tr>
<tr><th id="344">344</th><td><i>       looking at is the largest with a child index in-range, so must</i></td></tr>
<tr><th id="345">345</th><td><i>       have 2*i + 1 &lt; n, or i &lt; (n-1)/2.  If n is even = 2*j, this is</i></td></tr>
<tr><th id="346">346</th><td><i>       (2*j-1)/2 = j-1/2 so j-1 is the largest, which is n//2 - 1.  If</i></td></tr>
<tr><th id="347">347</th><td><i>       n is odd = 2*j+1, this is (2*j+1-1)/2 = j so j-1 is the largest,</i></td></tr>
<tr><th id="348">348</th><td><i>       and that's again n//2-1.</i></td></tr>
<tr><th id="349">349</th><td><i>    */</i></td></tr>
<tr><th id="350">350</th><td>    <b>for</b> (<a class="local col5 ref" href="#55i" title='i' data-ref="55i">i</a> = (<a class="local col6 ref" href="#56n" title='n' data-ref="56n">n</a> &gt;&gt; <var>1</var>) - <var>1</var> ; <a class="local col5 ref" href="#55i" title='i' data-ref="55i">i</a> &gt;= <var>0</var> ; <a class="local col5 ref" href="#55i" title='i' data-ref="55i">i</a>--)</td></tr>
<tr><th id="351">351</th><td>        <b>if</b> (<a class="local col4 ref" href="#54siftup_func" title='siftup_func' data-ref="54siftup_func">siftup_func</a>((<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *)<a class="local col3 ref" href="#53heap" title='heap' data-ref="53heap">heap</a>, <a class="local col5 ref" href="#55i" title='i' data-ref="55i">i</a>))</td></tr>
<tr><th id="352">352</th><td>            <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="353">353</th><td>    <a class="macro" href="../Include/object.h.html#913" title="return ( _Py_RefTotal++ , ((PyObject *)((&amp;_Py_NoneStruct)))-&gt;ob_refcnt++), (&amp;_Py_NoneStruct)" data-ref="_M/Py_RETURN_NONE">Py_RETURN_NONE</a>;</td></tr>
<tr><th id="354">354</th><td>}</td></tr>
<tr><th id="355">355</th><td></td></tr>
<tr><th id="356">356</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="357">357</th><td><dfn class="tu decl def" id="heapify" title='heapify' data-type='PyObject * heapify(PyObject * self, PyObject * heap)' data-ref="heapify">heapify</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col7 decl" id="57self" title='self' data-type='PyObject *' data-ref="57self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col8 decl" id="58heap" title='heap' data-type='PyObject *' data-ref="58heap">heap</dfn>)</td></tr>
<tr><th id="358">358</th><td>{</td></tr>
<tr><th id="359">359</th><td>    <b>return</b> <a class="tu ref" href="#heapify_internal" title='heapify_internal' data-use='c' data-ref="heapify_internal">heapify_internal</a>(<a class="local col8 ref" href="#58heap" title='heap' data-ref="58heap">heap</a>, <a class="tu ref" href="#siftup" title='siftup' data-use='r' data-ref="siftup">siftup</a>);</td></tr>
<tr><th id="360">360</th><td>}</td></tr>
<tr><th id="361">361</th><td></td></tr>
<tr><th id="362">362</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heapify_doc[] = &quot;Transform list into a heap, in-place, in O(len(heap)) time.&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heapify_doc" title='heapify_doc' data-ref="heapify_doc">heapify_doc</dfn>,</td></tr>
<tr><th id="363">363</th><td><q>"Transform list into a heap, in-place, in O(len(heap)) time."</q>);</td></tr>
<tr><th id="364">364</th><td></td></tr>
<tr><th id="365">365</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="366">366</th><td><dfn class="tu decl def" id="siftdown_max" title='siftdown_max' data-type='int siftdown_max(PyListObject * heap, Py_ssize_t startpos, Py_ssize_t pos)' data-ref="siftdown_max">siftdown_max</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *<dfn class="local col9 decl" id="59heap" title='heap' data-type='PyListObject *' data-ref="59heap">heap</dfn>, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col0 decl" id="60startpos" title='startpos' data-type='Py_ssize_t' data-ref="60startpos">startpos</dfn>, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col1 decl" id="61pos" title='pos' data-type='Py_ssize_t' data-ref="61pos">pos</dfn>)</td></tr>
<tr><th id="367">367</th><td>{</td></tr>
<tr><th id="368">368</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col2 decl" id="62newitem" title='newitem' data-type='PyObject *' data-ref="62newitem">newitem</dfn>, *<dfn class="local col3 decl" id="63parent" title='parent' data-type='PyObject *' data-ref="63parent">parent</dfn>, **<dfn class="local col4 decl" id="64arr" title='arr' data-type='PyObject **' data-ref="64arr">arr</dfn>;</td></tr>
<tr><th id="369">369</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col5 decl" id="65parentpos" title='parentpos' data-type='Py_ssize_t' data-ref="65parentpos">parentpos</dfn>, <dfn class="local col6 decl" id="66size" title='size' data-type='Py_ssize_t' data-ref="66size">size</dfn>;</td></tr>
<tr><th id="370">370</th><td>    <em>int</em> <dfn class="local col7 decl" id="67cmp" title='cmp' data-type='int' data-ref="67cmp">cmp</dfn>;</td></tr>
<tr><th id="371">371</th><td></td></tr>
<tr><th id="372">372</th><td>    <a class="macro" href="../../include/assert.h.html#88" title="((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 372, __PRETTY_FUNCTION__))" data-ref="_M/assert">assert</a>(<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col9 ref" href="#59heap" title='heap' data-ref="59heap">heap</a>));</td></tr>
<tr><th id="373">373</th><td>    <a class="local col6 ref" href="#66size" title='size' data-ref="66size">size</a> = <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 373, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col9 ref" href="#59heap" title='heap' data-ref="59heap">heap</a>);</td></tr>
<tr><th id="374">374</th><td>    <b>if</b> (<a class="local col1 ref" href="#61pos" title='pos' data-ref="61pos">pos</a> &gt;= <a class="local col6 ref" href="#66size" title='size' data-ref="66size">size</a>) {</td></tr>
<tr><th id="375">375</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_IndexError" title='PyExc_IndexError' data-ref="PyExc_IndexError">PyExc_IndexError</a>, <q>"index out of range"</q>);</td></tr>
<tr><th id="376">376</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="377">377</th><td>    }</td></tr>
<tr><th id="378">378</th><td></td></tr>
<tr><th id="379">379</th><td>    <i>/* Follow the path to the root, moving parents down until finding</i></td></tr>
<tr><th id="380">380</th><td><i>       a place newitem fits. */</i></td></tr>
<tr><th id="381">381</th><td>    <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col9 ref" href="#59heap" title='heap' data-ref="59heap">heap</a>);</td></tr>
<tr><th id="382">382</th><td>    <a class="local col2 ref" href="#62newitem" title='newitem' data-ref="62newitem">newitem</a> = <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a>[<a class="local col1 ref" href="#61pos" title='pos' data-ref="61pos">pos</a>];</td></tr>
<tr><th id="383">383</th><td>    <b>while</b> (<a class="local col1 ref" href="#61pos" title='pos' data-ref="61pos">pos</a> &gt; <a class="local col0 ref" href="#60startpos" title='startpos' data-ref="60startpos">startpos</a>) {</td></tr>
<tr><th id="384">384</th><td>        <a class="local col5 ref" href="#65parentpos" title='parentpos' data-ref="65parentpos">parentpos</a> = (<a class="local col1 ref" href="#61pos" title='pos' data-ref="61pos">pos</a> - <var>1</var>) &gt;&gt; <var>1</var>;</td></tr>
<tr><th id="385">385</th><td>        <a class="local col3 ref" href="#63parent" title='parent' data-ref="63parent">parent</a> = <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a>[<a class="local col5 ref" href="#65parentpos" title='parentpos' data-ref="65parentpos">parentpos</a>];</td></tr>
<tr><th id="386">386</th><td>        <a class="local col7 ref" href="#67cmp" title='cmp' data-ref="67cmp">cmp</a> = <a class="ref" href="../Include/object.h.html#PyObject_RichCompareBool" title='PyObject_RichCompareBool' data-ref="PyObject_RichCompareBool">PyObject_RichCompareBool</a>(<a class="local col3 ref" href="#63parent" title='parent' data-ref="63parent">parent</a>, <a class="local col2 ref" href="#62newitem" title='newitem' data-ref="62newitem">newitem</a>, <a class="macro" href="../Include/object.h.html#927" title="0" data-ref="_M/Py_LT">Py_LT</a>);</td></tr>
<tr><th id="387">387</th><td>        <b>if</b> (<a class="local col7 ref" href="#67cmp" title='cmp' data-ref="67cmp">cmp</a> &lt; <var>0</var>)</td></tr>
<tr><th id="388">388</th><td>            <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="389">389</th><td>        <b>if</b> (<a class="local col6 ref" href="#66size" title='size' data-ref="66size">size</a> != <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 389, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col9 ref" href="#59heap" title='heap' data-ref="59heap">heap</a>)) {</td></tr>
<tr><th id="390">390</th><td>            <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_RuntimeError" title='PyExc_RuntimeError' data-ref="PyExc_RuntimeError">PyExc_RuntimeError</a>,</td></tr>
<tr><th id="391">391</th><td>                            <q>"list changed size during iteration"</q>);</td></tr>
<tr><th id="392">392</th><td>            <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="393">393</th><td>        }</td></tr>
<tr><th id="394">394</th><td>        <b>if</b> (<a class="local col7 ref" href="#67cmp" title='cmp' data-ref="67cmp">cmp</a> == <var>0</var>)</td></tr>
<tr><th id="395">395</th><td>            <b>break</b>;</td></tr>
<tr><th id="396">396</th><td>        <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col9 ref" href="#59heap" title='heap' data-ref="59heap">heap</a>);</td></tr>
<tr><th id="397">397</th><td>        <a class="local col3 ref" href="#63parent" title='parent' data-ref="63parent">parent</a> = <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a>[<a class="local col5 ref" href="#65parentpos" title='parentpos' data-ref="65parentpos">parentpos</a>];</td></tr>
<tr><th id="398">398</th><td>        <a class="local col2 ref" href="#62newitem" title='newitem' data-ref="62newitem">newitem</a> = <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a>[<a class="local col1 ref" href="#61pos" title='pos' data-ref="61pos">pos</a>];</td></tr>
<tr><th id="399">399</th><td>        <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a>[<a class="local col5 ref" href="#65parentpos" title='parentpos' data-ref="65parentpos">parentpos</a>] = <a class="local col2 ref" href="#62newitem" title='newitem' data-ref="62newitem">newitem</a>;</td></tr>
<tr><th id="400">400</th><td>        <a class="local col4 ref" href="#64arr" title='arr' data-ref="64arr">arr</a>[<a class="local col1 ref" href="#61pos" title='pos' data-ref="61pos">pos</a>] = <a class="local col3 ref" href="#63parent" title='parent' data-ref="63parent">parent</a>;</td></tr>
<tr><th id="401">401</th><td>        <a class="local col1 ref" href="#61pos" title='pos' data-ref="61pos">pos</a> = <a class="local col5 ref" href="#65parentpos" title='parentpos' data-ref="65parentpos">parentpos</a>;</td></tr>
<tr><th id="402">402</th><td>    }</td></tr>
<tr><th id="403">403</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="404">404</th><td>}</td></tr>
<tr><th id="405">405</th><td></td></tr>
<tr><th id="406">406</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="407">407</th><td><dfn class="tu decl def" id="siftup_max" title='siftup_max' data-type='int siftup_max(PyListObject * heap, Py_ssize_t pos)' data-ref="siftup_max">siftup_max</dfn>(<a class="typedef" href="../Include/listobject.h.html#PyListObject" title='PyListObject' data-type='struct PyListObject' data-ref="PyListObject">PyListObject</a> *<dfn class="local col8 decl" id="68heap" title='heap' data-type='PyListObject *' data-ref="68heap">heap</dfn>, <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col9 decl" id="69pos" title='pos' data-type='Py_ssize_t' data-ref="69pos">pos</dfn>)</td></tr>
<tr><th id="408">408</th><td>{</td></tr>
<tr><th id="409">409</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col0 decl" id="70startpos" title='startpos' data-type='Py_ssize_t' data-ref="70startpos">startpos</dfn>, <dfn class="local col1 decl" id="71endpos" title='endpos' data-type='Py_ssize_t' data-ref="71endpos">endpos</dfn>, <dfn class="local col2 decl" id="72childpos" title='childpos' data-type='Py_ssize_t' data-ref="72childpos">childpos</dfn>, <dfn class="local col3 decl" id="73limit" title='limit' data-type='Py_ssize_t' data-ref="73limit">limit</dfn>;</td></tr>
<tr><th id="410">410</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col4 decl" id="74tmp1" title='tmp1' data-type='PyObject *' data-ref="74tmp1">tmp1</dfn>, *<dfn class="local col5 decl" id="75tmp2" title='tmp2' data-type='PyObject *' data-ref="75tmp2">tmp2</dfn>, **<dfn class="local col6 decl" id="76arr" title='arr' data-type='PyObject **' data-ref="76arr">arr</dfn>;</td></tr>
<tr><th id="411">411</th><td>    <em>int</em> <dfn class="local col7 decl" id="77cmp" title='cmp' data-type='int' data-ref="77cmp">cmp</dfn>;</td></tr>
<tr><th id="412">412</th><td></td></tr>
<tr><th id="413">413</th><td>    <a class="macro" href="../../include/assert.h.html#88" title="((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 413, __PRETTY_FUNCTION__))" data-ref="_M/assert">assert</a>(<a class="macro" href="../Include/listobject.h.html#48" title="((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)" data-ref="_M/PyList_Check">PyList_Check</a>(<a class="local col8 ref" href="#68heap" title='heap' data-ref="68heap">heap</a>));</td></tr>
<tr><th id="414">414</th><td>    <a class="local col1 ref" href="#71endpos" title='endpos' data-ref="71endpos">endpos</a> = <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 414, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col8 ref" href="#68heap" title='heap' data-ref="68heap">heap</a>);</td></tr>
<tr><th id="415">415</th><td>    <a class="local col0 ref" href="#70startpos" title='startpos' data-ref="70startpos">startpos</a> = <a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a>;</td></tr>
<tr><th id="416">416</th><td>    <b>if</b> (<a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a> &gt;= <a class="local col1 ref" href="#71endpos" title='endpos' data-ref="71endpos">endpos</a>) {</td></tr>
<tr><th id="417">417</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_IndexError" title='PyExc_IndexError' data-ref="PyExc_IndexError">PyExc_IndexError</a>, <q>"index out of range"</q>);</td></tr>
<tr><th id="418">418</th><td>        <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="419">419</th><td>    }</td></tr>
<tr><th id="420">420</th><td></td></tr>
<tr><th id="421">421</th><td>    <i>/* Bubble up the smaller child until hitting a leaf. */</i></td></tr>
<tr><th id="422">422</th><td>    <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col8 ref" href="#68heap" title='heap' data-ref="68heap">heap</a>);</td></tr>
<tr><th id="423">423</th><td>    <a class="local col3 ref" href="#73limit" title='limit' data-ref="73limit">limit</a> = <a class="local col1 ref" href="#71endpos" title='endpos' data-ref="71endpos">endpos</a> &gt;&gt; <var>1</var>;         <i>/* smallest pos that has no child */</i></td></tr>
<tr><th id="424">424</th><td>    <b>while</b> (<a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a> &lt; <a class="local col3 ref" href="#73limit" title='limit' data-ref="73limit">limit</a>) {</td></tr>
<tr><th id="425">425</th><td>        <i>/* Set childpos to index of smaller child.   */</i></td></tr>
<tr><th id="426">426</th><td>        <a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a> = <var>2</var>*<a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a> + <var>1</var>;    <i>/* leftmost child position  */</i></td></tr>
<tr><th id="427">427</th><td>        <b>if</b> (<a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a> + <var>1</var> &lt; <a class="local col1 ref" href="#71endpos" title='endpos' data-ref="71endpos">endpos</a>) {</td></tr>
<tr><th id="428">428</th><td>            <a class="local col7 ref" href="#77cmp" title='cmp' data-ref="77cmp">cmp</a> = <a class="ref" href="../Include/object.h.html#PyObject_RichCompareBool" title='PyObject_RichCompareBool' data-ref="PyObject_RichCompareBool">PyObject_RichCompareBool</a>(</td></tr>
<tr><th id="429">429</th><td>                <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a>[<a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a> + <var>1</var>],</td></tr>
<tr><th id="430">430</th><td>                <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a>[<a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a>],</td></tr>
<tr><th id="431">431</th><td>                <a class="macro" href="../Include/object.h.html#927" title="0" data-ref="_M/Py_LT">Py_LT</a>);</td></tr>
<tr><th id="432">432</th><td>            <b>if</b> (<a class="local col7 ref" href="#77cmp" title='cmp' data-ref="77cmp">cmp</a> &lt; <var>0</var>)</td></tr>
<tr><th id="433">433</th><td>                <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="434">434</th><td>            <a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a> += ((<em>unsigned</em>)<a class="local col7 ref" href="#77cmp" title='cmp' data-ref="77cmp">cmp</a> ^ <var>1</var>);   <i>/* increment when cmp==0 */</i></td></tr>
<tr><th id="435">435</th><td>            <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a> = <a class="macro" href="../Include/listobject.h.html#75" title="(((PyListObject *)(heap))-&gt;ob_item)" data-ref="_M/_PyList_ITEMS">_PyList_ITEMS</a>(<a class="local col8 ref" href="#68heap" title='heap' data-ref="68heap">heap</a>);         <i>/* arr may have changed */</i></td></tr>
<tr><th id="436">436</th><td>            <b>if</b> (<a class="local col1 ref" href="#71endpos" title='endpos' data-ref="71endpos">endpos</a> != <a class="macro" href="../Include/listobject.h.html#74" title="(((((((((PyObject*)(heap))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(heap)&quot;, &quot;/home/jon/workspace/cpython/Modules/_heapqmodule.c&quot;, 436, __PRETTY_FUNCTION__)),(((PyVarObject*)(heap))-&gt;ob_size))" data-ref="_M/PyList_GET_SIZE">PyList_GET_SIZE</a>(<a class="local col8 ref" href="#68heap" title='heap' data-ref="68heap">heap</a>)) {</td></tr>
<tr><th id="437">437</th><td>                <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_RuntimeError" title='PyExc_RuntimeError' data-ref="PyExc_RuntimeError">PyExc_RuntimeError</a>,</td></tr>
<tr><th id="438">438</th><td>                                <q>"list changed size during iteration"</q>);</td></tr>
<tr><th id="439">439</th><td>                <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="440">440</th><td>            }</td></tr>
<tr><th id="441">441</th><td>        }</td></tr>
<tr><th id="442">442</th><td>        <i>/* Move the smaller child up. */</i></td></tr>
<tr><th id="443">443</th><td>        <a class="local col4 ref" href="#74tmp1" title='tmp1' data-ref="74tmp1">tmp1</a> = <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a>[<a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a>];</td></tr>
<tr><th id="444">444</th><td>        <a class="local col5 ref" href="#75tmp2" title='tmp2' data-ref="75tmp2">tmp2</a> = <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a>[<a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a>];</td></tr>
<tr><th id="445">445</th><td>        <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a>[<a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a>] = <a class="local col5 ref" href="#75tmp2" title='tmp2' data-ref="75tmp2">tmp2</a>;</td></tr>
<tr><th id="446">446</th><td>        <a class="local col6 ref" href="#76arr" title='arr' data-ref="76arr">arr</a>[<a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a>] = <a class="local col4 ref" href="#74tmp1" title='tmp1' data-ref="74tmp1">tmp1</a>;</td></tr>
<tr><th id="447">447</th><td>        <a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a> = <a class="local col2 ref" href="#72childpos" title='childpos' data-ref="72childpos">childpos</a>;</td></tr>
<tr><th id="448">448</th><td>    }</td></tr>
<tr><th id="449">449</th><td>    <i>/* Bubble it up to its final resting place (by sifting its parents down). */</i></td></tr>
<tr><th id="450">450</th><td>    <b>return</b> <a class="tu ref" href="#siftdown_max" title='siftdown_max' data-use='c' data-ref="siftdown_max">siftdown_max</a>(<a class="local col8 ref" href="#68heap" title='heap' data-ref="68heap">heap</a>, <a class="local col0 ref" href="#70startpos" title='startpos' data-ref="70startpos">startpos</a>, <a class="local col9 ref" href="#69pos" title='pos' data-ref="69pos">pos</a>);</td></tr>
<tr><th id="451">451</th><td>}</td></tr>
<tr><th id="452">452</th><td></td></tr>
<tr><th id="453">453</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="454">454</th><td><dfn class="tu decl def" id="heappop_max" title='heappop_max' data-type='PyObject * heappop_max(PyObject * self, PyObject * heap)' data-ref="heappop_max">heappop_max</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col8 decl" id="78self" title='self' data-type='PyObject *' data-ref="78self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col9 decl" id="79heap" title='heap' data-type='PyObject *' data-ref="79heap">heap</dfn>)</td></tr>
<tr><th id="455">455</th><td>{</td></tr>
<tr><th id="456">456</th><td>    <b>return</b> <a class="tu ref" href="#heappop_internal" title='heappop_internal' data-use='c' data-ref="heappop_internal">heappop_internal</a>(<a class="local col9 ref" href="#79heap" title='heap' data-ref="79heap">heap</a>, <a class="tu ref" href="#siftup_max" title='siftup_max' data-use='r' data-ref="siftup_max">siftup_max</a>);</td></tr>
<tr><th id="457">457</th><td>}</td></tr>
<tr><th id="458">458</th><td></td></tr>
<tr><th id="459">459</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heappop_max_doc[] = &quot;Maxheap variant of heappop.&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heappop_max_doc" title='heappop_max_doc' data-ref="heappop_max_doc">heappop_max_doc</dfn>, <q>"Maxheap variant of heappop."</q>);</td></tr>
<tr><th id="460">460</th><td></td></tr>
<tr><th id="461">461</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="462">462</th><td><dfn class="tu decl def" id="heapreplace_max" title='heapreplace_max' data-type='PyObject * heapreplace_max(PyObject * self, PyObject * args)' data-ref="heapreplace_max">heapreplace_max</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col0 decl" id="80self" title='self' data-type='PyObject *' data-ref="80self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col1 decl" id="81args" title='args' data-type='PyObject *' data-ref="81args">args</dfn>)</td></tr>
<tr><th id="463">463</th><td>{</td></tr>
<tr><th id="464">464</th><td>    <b>return</b> <a class="tu ref" href="#heapreplace_internal" title='heapreplace_internal' data-use='c' data-ref="heapreplace_internal">heapreplace_internal</a>(<a class="local col1 ref" href="#81args" title='args' data-ref="81args">args</a>, <a class="tu ref" href="#siftup_max" title='siftup_max' data-use='r' data-ref="siftup_max">siftup_max</a>);</td></tr>
<tr><th id="465">465</th><td>}</td></tr>
<tr><th id="466">466</th><td></td></tr>
<tr><th id="467">467</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heapreplace_max_doc[] = &quot;Maxheap variant of heapreplace&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heapreplace_max_doc" title='heapreplace_max_doc' data-ref="heapreplace_max_doc">heapreplace_max_doc</dfn>, <q>"Maxheap variant of heapreplace"</q>);</td></tr>
<tr><th id="468">468</th><td></td></tr>
<tr><th id="469">469</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="470">470</th><td><dfn class="tu decl def" id="heapify_max" title='heapify_max' data-type='PyObject * heapify_max(PyObject * self, PyObject * heap)' data-ref="heapify_max">heapify_max</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col2 decl" id="82self" title='self' data-type='PyObject *' data-ref="82self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col3 decl" id="83heap" title='heap' data-type='PyObject *' data-ref="83heap">heap</dfn>)</td></tr>
<tr><th id="471">471</th><td>{</td></tr>
<tr><th id="472">472</th><td>    <b>return</b> <a class="tu ref" href="#heapify_internal" title='heapify_internal' data-use='c' data-ref="heapify_internal">heapify_internal</a>(<a class="local col3 ref" href="#83heap" title='heap' data-ref="83heap">heap</a>, <a class="tu ref" href="#siftup_max" title='siftup_max' data-use='r' data-ref="siftup_max">siftup_max</a>);</td></tr>
<tr><th id="473">473</th><td>}</td></tr>
<tr><th id="474">474</th><td></td></tr>
<tr><th id="475">475</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char heapify_max_doc[] = &quot;Maxheap variant of heapify.&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="heapify_max_doc" title='heapify_max_doc' data-ref="heapify_max_doc">heapify_max_doc</dfn>, <q>"Maxheap variant of heapify."</q>);</td></tr>
<tr><th id="476">476</th><td></td></tr>
<tr><th id="477">477</th><td><em>static</em> <a class="typedef" href="../Include/methodobject.h.html#PyMethodDef" title='PyMethodDef' data-type='struct PyMethodDef' data-ref="PyMethodDef">PyMethodDef</a> <dfn class="tu decl def" id="heapq_methods" title='heapq_methods' data-type='PyMethodDef [9]' data-ref="heapq_methods">heapq_methods</dfn>[] = {</td></tr>
<tr><th id="478">478</th><td>    {<q>"heappush"</q>,        (<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heappush" title='heappush' data-ref="heappush">heappush</a>,</td></tr>
<tr><th id="479">479</th><td>        <a class="macro" href="../Include/methodobject.h.html#71" title="0x0001" data-ref="_M/METH_VARARGS">METH_VARARGS</a>,           <a class="ref" href="#120" title='heappush_doc' data-ref="heappush_doc">heappush_doc</a>},</td></tr>
<tr><th id="480">480</th><td>    {<q>"heappushpop"</q>,     (<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heappushpop" title='heappushpop' data-ref="heappushpop">heappushpop</a>,</td></tr>
<tr><th id="481">481</th><td>        <a class="macro" href="../Include/methodobject.h.html#71" title="0x0001" data-ref="_M/METH_VARARGS">METH_VARARGS</a>,           <a class="ref" href="#255" title='heappushpop_doc' data-ref="heappushpop_doc">heappushpop_doc</a>},</td></tr>
<tr><th id="482">482</th><td>    {<q>"heappop"</q>,         (<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heappop" title='heappop' data-ref="heappop">heappop</a>,</td></tr>
<tr><th id="483">483</th><td>        <a class="macro" href="../Include/methodobject.h.html#75" title="0x0008" data-ref="_M/METH_O">METH_O</a>,                 <a class="ref" href="#166" title='heappop_doc' data-ref="heappop_doc">heappop_doc</a>},</td></tr>
<tr><th id="484">484</th><td>    {<q>"heapreplace"</q>,     (<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heapreplace" title='heapreplace' data-ref="heapreplace">heapreplace</a>,</td></tr>
<tr><th id="485">485</th><td>        <a class="macro" href="../Include/methodobject.h.html#71" title="0x0001" data-ref="_M/METH_VARARGS">METH_VARARGS</a>,           <a class="ref" href="#203" title='heapreplace_doc' data-ref="heapreplace_doc">heapreplace_doc</a>},</td></tr>
<tr><th id="486">486</th><td>    {<q>"heapify"</q>,         (<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heapify" title='heapify' data-ref="heapify">heapify</a>,</td></tr>
<tr><th id="487">487</th><td>        <a class="macro" href="../Include/methodobject.h.html#75" title="0x0008" data-ref="_M/METH_O">METH_O</a>,                 <a class="ref" href="#362" title='heapify_doc' data-ref="heapify_doc">heapify_doc</a>},</td></tr>
<tr><th id="488">488</th><td>    {<q>"_heappop_max"</q>,    (<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heappop_max" title='heappop_max' data-ref="heappop_max">heappop_max</a>,</td></tr>
<tr><th id="489">489</th><td>        <a class="macro" href="../Include/methodobject.h.html#75" title="0x0008" data-ref="_M/METH_O">METH_O</a>,                 <a class="ref" href="#459" title='heappop_max_doc' data-ref="heappop_max_doc">heappop_max_doc</a>},</td></tr>
<tr><th id="490">490</th><td>    {<q>"_heapreplace_max"</q>,(<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heapreplace_max" title='heapreplace_max' data-ref="heapreplace_max">heapreplace_max</a>,</td></tr>
<tr><th id="491">491</th><td>        <a class="macro" href="../Include/methodobject.h.html#71" title="0x0001" data-ref="_M/METH_VARARGS">METH_VARARGS</a>,           <a class="ref" href="#467" title='heapreplace_max_doc' data-ref="heapreplace_max_doc">heapreplace_max_doc</a>},</td></tr>
<tr><th id="492">492</th><td>    {<q>"_heapify_max"</q>,    (<a class="typedef" href="../Include/methodobject.h.html#PyCFunction" title='PyCFunction' data-type='PyObject *(*)(PyObject *, PyObject *)' data-ref="PyCFunction">PyCFunction</a>)<a class="tu ref" href="#heapify_max" title='heapify_max' data-ref="heapify_max">heapify_max</a>,</td></tr>
<tr><th id="493">493</th><td>        <a class="macro" href="../Include/methodobject.h.html#75" title="0x0008" data-ref="_M/METH_O">METH_O</a>,                 <a class="ref" href="#475" title='heapify_max_doc' data-ref="heapify_max_doc">heapify_max_doc</a>},</td></tr>
<tr><th id="494">494</th><td>    {<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,              <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>}           <i>/* sentinel */</i></td></tr>
<tr><th id="495">495</th><td>};</td></tr>
<tr><th id="496">496</th><td></td></tr>
<tr><th id="497">497</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char module_doc[] = &quot;Heap queue algorithm (a.k.a. priority queue).\n\nHeaps are arrays for which a[k] &lt;= a[2*k+1] and a[k] &lt;= a[2*k+2] for\nall k, counting elements from 0.  For the sake of comparison,\nnon-existing elements are considered to be infinite.  The interesting\nproperty of a heap is that a[0] is always its smallest element.\n\nUsage:\n\nheap = []            # creates an empty heap\nheappush(heap, item) # pushes a new item on the heap\nitem = heappop(heap) # pops the smallest item from the heap\nitem = heap[0]       # smallest item on the heap without popping it\nheapify(x)           # transforms list into a heap, in-place, in linear time\nitem = heapreplace(heap, item) # pops and returns smallest item, and adds\n                               # new item; the heap size is unchanged\n\nOur API differs from textbook heap algorithms as follows:\n\n- We use 0-based indexing.  This makes the relationship between the\n  index for a node and the indexes for its children slightly less\n  obvious, but is more suitable since Python uses 0-based indexing.\n\n- Our heappop() method returns the smallest item, not the largest.\n\nThese two make it possible to view the heap as a regular Python list\nwithout surprises: heap[0] is the smallest item, and heap.sort()\nmaintains the heap invariant!\n&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="module_doc" title='module_doc' data-ref="module_doc">module_doc</dfn>,</td></tr>
<tr><th id="498">498</th><td><q>"Heap queue algorithm (a.k.a. priority queue).\n\</q></td></tr>
<tr><th id="499">499</th><td><q>\n\</q></td></tr>
<tr><th id="500">500</th><td><q>Heaps are arrays for which a[k] &lt;= a[2*k+1] and a[k] &lt;= a[2*k+2] for\n\</q></td></tr>
<tr><th id="501">501</th><td><q>all k, counting elements from 0.  For the sake of comparison,\n\</q></td></tr>
<tr><th id="502">502</th><td><q>non-existing elements are considered to be infinite.  The interesting\n\</q></td></tr>
<tr><th id="503">503</th><td><q>property of a heap is that a[0] is always its smallest element.\n\</q></td></tr>
<tr><th id="504">504</th><td><q>\n\</q></td></tr>
<tr><th id="505">505</th><td><q>Usage:\n\</q></td></tr>
<tr><th id="506">506</th><td><q>\n\</q></td></tr>
<tr><th id="507">507</th><td><q>heap = []            # creates an empty heap\n\</q></td></tr>
<tr><th id="508">508</th><td><q>heappush(heap, item) # pushes a new item on the heap\n\</q></td></tr>
<tr><th id="509">509</th><td><q>item = heappop(heap) # pops the smallest item from the heap\n\</q></td></tr>
<tr><th id="510">510</th><td><q>item = heap[0]       # smallest item on the heap without popping it\n\</q></td></tr>
<tr><th id="511">511</th><td><q>heapify(x)           # transforms list into a heap, in-place, in linear time\n\</q></td></tr>
<tr><th id="512">512</th><td><q>item = heapreplace(heap, item) # pops and returns smallest item, and adds\n\</q></td></tr>
<tr><th id="513">513</th><td><q>                               # new item; the heap size is unchanged\n\</q></td></tr>
<tr><th id="514">514</th><td><q>\n\</q></td></tr>
<tr><th id="515">515</th><td><q>Our API differs from textbook heap algorithms as follows:\n\</q></td></tr>
<tr><th id="516">516</th><td><q>\n\</q></td></tr>
<tr><th id="517">517</th><td><q>- We use 0-based indexing.  This makes the relationship between the\n\</q></td></tr>
<tr><th id="518">518</th><td><q>  index for a node and the indexes for its children slightly less\n\</q></td></tr>
<tr><th id="519">519</th><td><q>  obvious, but is more suitable since Python uses 0-based indexing.\n\</q></td></tr>
<tr><th id="520">520</th><td><q>\n\</q></td></tr>
<tr><th id="521">521</th><td><q>- Our heappop() method returns the smallest item, not the largest.\n\</q></td></tr>
<tr><th id="522">522</th><td><q>\n\</q></td></tr>
<tr><th id="523">523</th><td><q>These two make it possible to view the heap as a regular Python list\n\</q></td></tr>
<tr><th id="524">524</th><td><q>without surprises: heap[0] is the smallest item, and heap.sort()\n\</q></td></tr>
<tr><th id="525">525</th><td><q>maintains the heap invariant!\n"</q>);</td></tr>
<tr><th id="526">526</th><td></td></tr>
<tr><th id="527">527</th><td></td></tr>
<tr><th id="528">528</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char __about__[] = &quot;Heap queues\n\n[explanation by Fran\xc3\xa7ois Pinard]\n\nHeaps are arrays for which a[k] &lt;= a[2*k+1] and a[k] &lt;= a[2*k+2] for\nall k, counting elements from 0.  For the sake of comparison,\nnon-existing elements are considered to be infinite.  The interesting\nproperty of a heap is that a[0] is always its smallest element.\n&quot;&quot;\nThe strange invariant above is meant to be an efficient memory\nrepresentation for a tournament.  The numbers below are `k&apos;, not a[k]:\n\n                                   0\n\n                  1                                 2\n\n          3               4                5               6\n\n      7       8       9       10      11      12      13      14\n\n    15 16   17 18   19 20   21 22   23 24   25 26   27 28   29 30\n\n\nIn the tree above, each cell `k&apos; is topping `2*k+1&apos; and `2*k+2&apos;.  In\na usual binary tournament we see in sports, each cell is the winner\nover the two cells it tops, and we can trace the winner down the tree\nto see all opponents s/he had.  However, in many computer applications\nof such tournaments, we do not need to trace the history of a winner.\nTo be more memory efficient, when a winner is promoted, we try to\nreplace it by something else at a lower level, and the rule becomes\nthat a cell and the two cells it tops contain three different items,\nbut the top cell \&quot;wins\&quot; over the two topped cells.\n&quot;&quot;\nIf this heap invariant is protected at all time, index 0 is clearly\nthe overall winner.  The simplest algorithmic way to remove it and\nfind the \&quot;next\&quot; winner is to move some loser (let&apos;s say cell 30 in the\ndiagram above) into the 0 position, and then percolate this new 0 down\nthe tree, exchanging values, until the invariant is re-established.\nThis is clearly logarithmic on the total number of items in the tree.\nBy iterating over all items, you get an O(n ln n) sort.\n&quot;&quot;\nA nice feature of this sort is that you can efficiently insert new\nitems while the sort is going on, provided that the inserted items are\nnot \&quot;better\&quot; than the last 0&apos;th element you extracted.  This is\nespecially useful in simulation contexts, where the tree holds all\nincoming events, and the \&quot;win\&quot; condition means the smallest scheduled\ntime.  When an event schedule other events for execution, they are\nscheduled into the future, so they can easily go into the heap.  So, a\nheap is a good structure for implementing schedulers (this is what I\nused for my MIDI sequencer :-).\n&quot;&quot;\nVarious structures for implementing schedulers have been extensively\nstudied, and heaps are good for this, as they are reasonably speedy,\nthe speed is almost constant, and the worst case is not much different\nthan the average case.  However, there are other representations which\nare more efficient overall, yet the worst cases might be terrible.\n&quot;&quot;\nHeaps are also very useful in big disk sorts.  You most probably all\nknow that a big sort implies producing \&quot;runs\&quot; (which are pre-sorted\nsequences, which size is usually related to the amount of CPU memory),\nfollowed by a merging passes for these runs, which merging is often\nvery cleverly organised[1].  It is very important that the initial\nsort produces the longest runs possible.  Tournaments are a good way\nto that.  If, using all the memory available to hold a tournament, you\nreplace and percolate items that happen to fit the current run, you&apos;ll\nproduce runs which are twice the size of the memory for random input,\nand much better for input fuzzily ordered.\n&quot;&quot;\nMoreover, if you output the 0&apos;th item on disk and get an input which\nmay not fit in the current tournament (because the value \&quot;wins\&quot; over\nthe last output value), it cannot fit in the heap, so the size of the\nheap decreases.  The freed memory could be cleverly reused immediately\nfor progressively building a second heap, which grows at exactly the\nsame rate the first heap is melting.  When the first heap completely\nvanishes, you switch heaps and start a new run.  Clever and quite\neffective!\n\nIn a word, heaps are useful memory structures to know.  I use them in\na few applications, and I think it is good to keep a `heap&apos; module\naround. :-)\n&quot;&quot;\n--------------------\n[1] The disk balancing algorithms which are current, nowadays, are\nmore annoying than clever, and this is a consequence of the seeking\ncapabilities of the disks.  On devices which cannot seek, like big\ntape drives, the story was quite different, and one had to be very\nclever to ensure (far in advance) that each tape movement will be the\nmost effective possible (that is, will best participate at\n\&quot;progressing\&quot; the merge).  Some tapes were even able to read\nbackwards, and this was also used to avoid the rewinding time.\nBelieve me, real good tape sorts were quite spectacular to watch!\nFrom all times, sorting has always been a Great Art! :-)\n&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="__about__" title='__about__' data-ref="__about__">__about__</dfn>,</td></tr>
<tr><th id="529">529</th><td><q>"Heap queues\n\</q></td></tr>
<tr><th id="530">530</th><td><q>\n\</q></td></tr>
<tr><th id="531">531</th><td><q>[explanation by Fran\xc3\xa7ois Pinard]\n\</q></td></tr>
<tr><th id="532">532</th><td><q>\n\</q></td></tr>
<tr><th id="533">533</th><td><q>Heaps are arrays for which a[k] &lt;= a[2*k+1] and a[k] &lt;= a[2*k+2] for\n\</q></td></tr>
<tr><th id="534">534</th><td><q>all k, counting elements from 0.  For the sake of comparison,\n\</q></td></tr>
<tr><th id="535">535</th><td><q>non-existing elements are considered to be infinite.  The interesting\n\</q></td></tr>
<tr><th id="536">536</th><td><q>property of a heap is that a[0] is always its smallest element.\n"</q></td></tr>
<tr><th id="537">537</th><td><q>"\n\</q></td></tr>
<tr><th id="538">538</th><td><q>The strange invariant above is meant to be an efficient memory\n\</q></td></tr>
<tr><th id="539">539</th><td><q>representation for a tournament.  The numbers below are `k', not a[k]:\n\</q></td></tr>
<tr><th id="540">540</th><td><q>\n\</q></td></tr>
<tr><th id="541">541</th><td><q>                                   0\n\</q></td></tr>
<tr><th id="542">542</th><td><q>\n\</q></td></tr>
<tr><th id="543">543</th><td><q>                  1                                 2\n\</q></td></tr>
<tr><th id="544">544</th><td><q>\n\</q></td></tr>
<tr><th id="545">545</th><td><q>          3               4                5               6\n\</q></td></tr>
<tr><th id="546">546</th><td><q>\n\</q></td></tr>
<tr><th id="547">547</th><td><q>      7       8       9       10      11      12      13      14\n\</q></td></tr>
<tr><th id="548">548</th><td><q>\n\</q></td></tr>
<tr><th id="549">549</th><td><q>    15 16   17 18   19 20   21 22   23 24   25 26   27 28   29 30\n\</q></td></tr>
<tr><th id="550">550</th><td><q>\n\</q></td></tr>
<tr><th id="551">551</th><td><q>\n\</q></td></tr>
<tr><th id="552">552</th><td><q>In the tree above, each cell `k' is topping `2*k+1' and `2*k+2'.  In\n\</q></td></tr>
<tr><th id="553">553</th><td><q>a usual binary tournament we see in sports, each cell is the winner\n\</q></td></tr>
<tr><th id="554">554</th><td><q>over the two cells it tops, and we can trace the winner down the tree\n\</q></td></tr>
<tr><th id="555">555</th><td><q>to see all opponents s/he had.  However, in many computer applications\n\</q></td></tr>
<tr><th id="556">556</th><td><q>of such tournaments, we do not need to trace the history of a winner.\n\</q></td></tr>
<tr><th id="557">557</th><td><q>To be more memory efficient, when a winner is promoted, we try to\n\</q></td></tr>
<tr><th id="558">558</th><td><q>replace it by something else at a lower level, and the rule becomes\n\</q></td></tr>
<tr><th id="559">559</th><td><q>that a cell and the two cells it tops contain three different items,\n\</q></td></tr>
<tr><th id="560">560</th><td><q>but the top cell \"wins\" over the two topped cells.\n"</q></td></tr>
<tr><th id="561">561</th><td><q>"\n\</q></td></tr>
<tr><th id="562">562</th><td><q>If this heap invariant is protected at all time, index 0 is clearly\n\</q></td></tr>
<tr><th id="563">563</th><td><q>the overall winner.  The simplest algorithmic way to remove it and\n\</q></td></tr>
<tr><th id="564">564</th><td><q>find the \"next\" winner is to move some loser (let's say cell 30 in the\n\</q></td></tr>
<tr><th id="565">565</th><td><q>diagram above) into the 0 position, and then percolate this new 0 down\n\</q></td></tr>
<tr><th id="566">566</th><td><q>the tree, exchanging values, until the invariant is re-established.\n\</q></td></tr>
<tr><th id="567">567</th><td><q>This is clearly logarithmic on the total number of items in the tree.\n\</q></td></tr>
<tr><th id="568">568</th><td><q>By iterating over all items, you get an O(n ln n) sort.\n"</q></td></tr>
<tr><th id="569">569</th><td><q>"\n\</q></td></tr>
<tr><th id="570">570</th><td><q>A nice feature of this sort is that you can efficiently insert new\n\</q></td></tr>
<tr><th id="571">571</th><td><q>items while the sort is going on, provided that the inserted items are\n\</q></td></tr>
<tr><th id="572">572</th><td><q>not \"better\" than the last 0'th element you extracted.  This is\n\</q></td></tr>
<tr><th id="573">573</th><td><q>especially useful in simulation contexts, where the tree holds all\n\</q></td></tr>
<tr><th id="574">574</th><td><q>incoming events, and the \"win\" condition means the smallest scheduled\n\</q></td></tr>
<tr><th id="575">575</th><td><q>time.  When an event schedule other events for execution, they are\n\</q></td></tr>
<tr><th id="576">576</th><td><q>scheduled into the future, so they can easily go into the heap.  So, a\n\</q></td></tr>
<tr><th id="577">577</th><td><q>heap is a good structure for implementing schedulers (this is what I\n\</q></td></tr>
<tr><th id="578">578</th><td><q>used for my MIDI sequencer :-).\n"</q></td></tr>
<tr><th id="579">579</th><td><q>"\n\</q></td></tr>
<tr><th id="580">580</th><td><q>Various structures for implementing schedulers have been extensively\n\</q></td></tr>
<tr><th id="581">581</th><td><q>studied, and heaps are good for this, as they are reasonably speedy,\n\</q></td></tr>
<tr><th id="582">582</th><td><q>the speed is almost constant, and the worst case is not much different\n\</q></td></tr>
<tr><th id="583">583</th><td><q>than the average case.  However, there are other representations which\n\</q></td></tr>
<tr><th id="584">584</th><td><q>are more efficient overall, yet the worst cases might be terrible.\n"</q></td></tr>
<tr><th id="585">585</th><td><q>"\n\</q></td></tr>
<tr><th id="586">586</th><td><q>Heaps are also very useful in big disk sorts.  You most probably all\n\</q></td></tr>
<tr><th id="587">587</th><td><q>know that a big sort implies producing \"runs\" (which are pre-sorted\n\</q></td></tr>
<tr><th id="588">588</th><td><q>sequences, which size is usually related to the amount of CPU memory),\n\</q></td></tr>
<tr><th id="589">589</th><td><q>followed by a merging passes for these runs, which merging is often\n\</q></td></tr>
<tr><th id="590">590</th><td><q>very cleverly organised[1].  It is very important that the initial\n\</q></td></tr>
<tr><th id="591">591</th><td><q>sort produces the longest runs possible.  Tournaments are a good way\n\</q></td></tr>
<tr><th id="592">592</th><td><q>to that.  If, using all the memory available to hold a tournament, you\n\</q></td></tr>
<tr><th id="593">593</th><td><q>replace and percolate items that happen to fit the current run, you'll\n\</q></td></tr>
<tr><th id="594">594</th><td><q>produce runs which are twice the size of the memory for random input,\n\</q></td></tr>
<tr><th id="595">595</th><td><q>and much better for input fuzzily ordered.\n"</q></td></tr>
<tr><th id="596">596</th><td><q>"\n\</q></td></tr>
<tr><th id="597">597</th><td><q>Moreover, if you output the 0'th item on disk and get an input which\n\</q></td></tr>
<tr><th id="598">598</th><td><q>may not fit in the current tournament (because the value \"wins\" over\n\</q></td></tr>
<tr><th id="599">599</th><td><q>the last output value), it cannot fit in the heap, so the size of the\n\</q></td></tr>
<tr><th id="600">600</th><td><q>heap decreases.  The freed memory could be cleverly reused immediately\n\</q></td></tr>
<tr><th id="601">601</th><td><q>for progressively building a second heap, which grows at exactly the\n\</q></td></tr>
<tr><th id="602">602</th><td><q>same rate the first heap is melting.  When the first heap completely\n\</q></td></tr>
<tr><th id="603">603</th><td><q>vanishes, you switch heaps and start a new run.  Clever and quite\n\</q></td></tr>
<tr><th id="604">604</th><td><q>effective!\n\</q></td></tr>
<tr><th id="605">605</th><td><q>\n\</q></td></tr>
<tr><th id="606">606</th><td><q>In a word, heaps are useful memory structures to know.  I use them in\n\</q></td></tr>
<tr><th id="607">607</th><td><q>a few applications, and I think it is good to keep a `heap' module\n\</q></td></tr>
<tr><th id="608">608</th><td><q>around. :-)\n"</q></td></tr>
<tr><th id="609">609</th><td><q>"\n\</q></td></tr>
<tr><th id="610">610</th><td><q>--------------------\n\</q></td></tr>
<tr><th id="611">611</th><td><q>[1] The disk balancing algorithms which are current, nowadays, are\n\</q></td></tr>
<tr><th id="612">612</th><td><q>more annoying than clever, and this is a consequence of the seeking\n\</q></td></tr>
<tr><th id="613">613</th><td><q>capabilities of the disks.  On devices which cannot seek, like big\n\</q></td></tr>
<tr><th id="614">614</th><td><q>tape drives, the story was quite different, and one had to be very\n\</q></td></tr>
<tr><th id="615">615</th><td><q>clever to ensure (far in advance) that each tape movement will be the\n\</q></td></tr>
<tr><th id="616">616</th><td><q>most effective possible (that is, will best participate at\n\</q></td></tr>
<tr><th id="617">617</th><td><q>\"progressing\" the merge).  Some tapes were even able to read\n\</q></td></tr>
<tr><th id="618">618</th><td><q>backwards, and this was also used to avoid the rewinding time.\n\</q></td></tr>
<tr><th id="619">619</th><td><q>Believe me, real good tape sorts were quite spectacular to watch!\n\</q></td></tr>
<tr><th id="620">620</th><td><q>From all times, sorting has always been a Great Art! :-)\n"</q>);</td></tr>
<tr><th id="621">621</th><td></td></tr>
<tr><th id="622">622</th><td></td></tr>
<tr><th id="623">623</th><td><em>static</em> <b>struct</b> <a class="type" href="../Include/moduleobject.h.html#PyModuleDef" title='PyModuleDef' data-ref="PyModuleDef">PyModuleDef</a> <dfn class="tu decl def" id="_heapqmodule" title='_heapqmodule' data-type='struct PyModuleDef' data-ref="_heapqmodule">_heapqmodule</dfn> = {</td></tr>
<tr><th id="624">624</th><td>    <a class="macro" href="../Include/moduleobject.h.html#50" title="{ { 0, 0, 1, ((void*)0) }, ((void*)0), 0, ((void*)0), }" data-ref="_M/PyModuleDef_HEAD_INIT">PyModuleDef_HEAD_INIT</a>,</td></tr>
<tr><th id="625">625</th><td>    <q>"_heapq"</q>,</td></tr>
<tr><th id="626">626</th><td>    <a class="ref" href="#497" title='module_doc' data-ref="module_doc">module_doc</a>,</td></tr>
<tr><th id="627">627</th><td>    -<var>1</var>,</td></tr>
<tr><th id="628">628</th><td>    <a class="tu ref" href="#heapq_methods" title='heapq_methods' data-ref="heapq_methods">heapq_methods</a>,</td></tr>
<tr><th id="629">629</th><td>    <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,</td></tr>
<tr><th id="630">630</th><td>    <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,</td></tr>
<tr><th id="631">631</th><td>    <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>,</td></tr>
<tr><th id="632">632</th><td>    <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span></td></tr>
<tr><th id="633">633</th><td>};</td></tr>
<tr><th id="634">634</th><td></td></tr>
<tr><th id="635">635</th><td><a class="macro" href="../Include/pyport.h.html#685" title="PyObject*" data-ref="_M/PyMODINIT_FUNC">PyMODINIT_FUNC</a></td></tr>
<tr><th id="636">636</th><td><dfn class="decl def" id="PyInit__heapq" title='PyInit__heapq' data-ref="PyInit__heapq">PyInit__heapq</dfn>(<em>void</em>)</td></tr>
<tr><th id="637">637</th><td>{</td></tr>
<tr><th id="638">638</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col4 decl" id="84m" title='m' data-type='PyObject *' data-ref="84m">m</dfn>, *<dfn class="local col5 decl" id="85about" title='about' data-type='PyObject *' data-ref="85about">about</dfn>;</td></tr>
<tr><th id="639">639</th><td></td></tr>
<tr><th id="640">640</th><td>    <a class="local col4 ref" href="#84m" title='m' data-ref="84m">m</a> = <a class="macro" href="../Include/modsupport.h.html#199" title="PyModule_Create2TraceRefs(&amp;_heapqmodule, 1013)" data-ref="_M/PyModule_Create">PyModule_Create</a>(&amp;<a class="tu ref" href="#_heapqmodule" title='_heapqmodule' data-use='a' data-ref="_heapqmodule">_heapqmodule</a>);</td></tr>
<tr><th id="641">641</th><td>    <b>if</b> (<a class="local col4 ref" href="#84m" title='m' data-ref="84m">m</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="642">642</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="643">643</th><td>    <a class="local col5 ref" href="#85about" title='about' data-ref="85about">about</a> = <a class="ref" href="../Include/unicodeobject.h.html#PyUnicode_DecodeUTF8" title='PyUnicode_DecodeUTF8' data-ref="PyUnicode_DecodeUTF8">PyUnicode_DecodeUTF8</a>(<a class="ref" href="#528" title='__about__' data-ref="__about__">__about__</a>, <a class="ref" href="../../include/string.h.html#strlen" title='strlen' data-ref="strlen">strlen</a>(<a class="ref" href="#528" title='__about__' data-ref="__about__">__about__</a>), <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="644">644</th><td>    <a class="ref" href="../Include/modsupport.h.html#PyModule_AddObject" title='PyModule_AddObject' data-ref="PyModule_AddObject">PyModule_AddObject</a>(<a class="local col4 ref" href="#84m" title='m' data-ref="84m">m</a>, <q>"__about__"</q>, <a class="local col5 ref" href="#85about" title='about' data-ref="85about">about</a>);</td></tr>
<tr><th id="645">645</th><td>    <b>return</b> <a class="local col4 ref" href="#84m" title='m' data-ref="84m">m</a>;</td></tr>
<tr><th id="646">646</th><td>}</td></tr>
<tr><th id="647">647</th><td></td></tr>
<tr><th id="648">648</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2017-Aug-29</em> from project codebrowser revision <em>v3.6.0b2-99580-g07f1658</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
