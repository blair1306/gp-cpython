<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>_posixsubprocess.c source code [codebrowser/Modules/_posixsubprocess.c] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="linux_dirent64 "/>
<link rel="stylesheet" href="../../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'codebrowser/Modules/_posixsubprocess.c'; var root_path = '../..'; var data_path = '../../../data';</script>
<script src='../../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='..'>codebrowser</a>/<a href='./'>Modules</a>/<a href='_posixsubprocess.c.html'>_posixsubprocess.c</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>/* Authors: Gregory P. Smith &amp; Jeffrey Yasskin */</i></td></tr>
<tr><th id="2">2</th><td><u>#include <a href="../Include/Python.h.html">"Python.h"</a></u></td></tr>
<tr><th id="3">3</th><td><u>#<span data-ppcond="3">if</span> defined(<a class="macro" href="../pyconfig.h.html#663" data-ref="_M/HAVE_PIPE2">HAVE_PIPE2</a>) &amp;&amp; !defined(<a class="macro" href="../pyconfig.h.html#1429" data-ref="_M/_GNU_SOURCE">_GNU_SOURCE</a>)</u></td></tr>
<tr><th id="4">4</th><td><u># define _GNU_SOURCE</u></td></tr>
<tr><th id="5">5</th><td><u>#<span data-ppcond="3">endif</span></u></td></tr>
<tr><th id="6">6</th><td><u>#include <a href="../../include/unistd.h.html">&lt;unistd.h&gt;</a></u></td></tr>
<tr><th id="7">7</th><td><u>#include <a href="../../include/fcntl.h.html">&lt;fcntl.h&gt;</a></u></td></tr>
<tr><th id="8">8</th><td><u>#<span data-ppcond="8">ifdef</span> <a class="macro" href="../pyconfig.h.html#1071" data-ref="_M/HAVE_SYS_TYPES_H">HAVE_SYS_TYPES_H</a></u></td></tr>
<tr><th id="9">9</th><td><u>#include <a href="../../include/x86_64-linux-gnu/sys/types.h.html">&lt;sys/types.h&gt;</a></u></td></tr>
<tr><th id="10">10</th><td><u>#<span data-ppcond="8">endif</span></u></td></tr>
<tr><th id="11">11</th><td><u>#<span data-ppcond="11">if</span> defined(<a class="macro" href="../pyconfig.h.html#1053" data-ref="_M/HAVE_SYS_STAT_H">HAVE_SYS_STAT_H</a>) &amp;&amp; defined(<span class="macro" data-ref="_M/__FreeBSD__">__FreeBSD__</span>)</u></td></tr>
<tr><th id="12">12</th><td><u>#include &lt;sys/stat.h&gt;</u></td></tr>
<tr><th id="13">13</th><td><u>#<span data-ppcond="11">endif</span></u></td></tr>
<tr><th id="14">14</th><td><u>#<span data-ppcond="14">ifdef</span> <a class="macro" href="../pyconfig.h.html#1056" data-ref="_M/HAVE_SYS_SYSCALL_H">HAVE_SYS_SYSCALL_H</a></u></td></tr>
<tr><th id="15">15</th><td><u>#include <a href="../../include/x86_64-linux-gnu/sys/syscall.h.html">&lt;sys/syscall.h&gt;</a></u></td></tr>
<tr><th id="16">16</th><td><u>#<span data-ppcond="14">endif</span></u></td></tr>
<tr><th id="17">17</th><td><u>#<span data-ppcond="17">if</span> defined(<a class="macro" href="../pyconfig.h.html#1038" data-ref="_M/HAVE_SYS_RESOURCE_H">HAVE_SYS_RESOURCE_H</a>)</u></td></tr>
<tr><th id="18">18</th><td><u>#include <a href="../../include/x86_64-linux-gnu/sys/resource.h.html">&lt;sys/resource.h&gt;</a></u></td></tr>
<tr><th id="19">19</th><td><u>#<span data-ppcond="17">endif</span></u></td></tr>
<tr><th id="20">20</th><td><u>#<span data-ppcond="20">ifdef</span> <a class="macro" href="../pyconfig.h.html#223" data-ref="_M/HAVE_DIRENT_H">HAVE_DIRENT_H</a></u></td></tr>
<tr><th id="21">21</th><td><u>#include <a href="../../include/dirent.h.html">&lt;dirent.h&gt;</a></u></td></tr>
<tr><th id="22">22</th><td><u>#<span data-ppcond="20">endif</span></u></td></tr>
<tr><th id="23">23</th><td></td></tr>
<tr><th id="24">24</th><td><u>#<span data-ppcond="24">if</span> defined(<span class="macro" data-ref="_M/__ANDROID__">__ANDROID__</span>) &amp;&amp; __ANDROID_API__ &lt; 21 &amp;&amp; !defined(<a class="macro" href="../../include/x86_64-linux-gnu/bits/syscall.h.html#462" data-ref="_M/SYS_getdents64">SYS_getdents64</a>)</u></td></tr>
<tr><th id="25">25</th><td><u># include &lt;sys/linux-syscalls.h&gt;</u></td></tr>
<tr><th id="26">26</th><td><u># define SYS_getdents64  __NR_getdents64</u></td></tr>
<tr><th id="27">27</th><td><u>#<span data-ppcond="24">endif</span></u></td></tr>
<tr><th id="28">28</th><td></td></tr>
<tr><th id="29">29</th><td><u>#<span data-ppcond="29">if</span> defined(<span class="macro" data-ref="_M/sun">sun</span>)</u></td></tr>
<tr><th id="30">30</th><td><i>/* readdir64 is used to work around Solaris 9 bug 6395699. */</i></td></tr>
<tr><th id="31">31</th><td><u># define readdir readdir64</u></td></tr>
<tr><th id="32">32</th><td><u># define dirent dirent64</u></td></tr>
<tr><th id="33">33</th><td><u># if !defined(HAVE_DIRFD)</u></td></tr>
<tr><th id="34">34</th><td><i>/* Some versions of Solaris lack dirfd(). */</i></td></tr>
<tr><th id="35">35</th><td><u>#  define dirfd(dirp) ((dirp)-&gt;dd_fd)</u></td></tr>
<tr><th id="36">36</th><td><u>#  define HAVE_DIRFD</u></td></tr>
<tr><th id="37">37</th><td><u># endif</u></td></tr>
<tr><th id="38">38</th><td><u>#<span data-ppcond="29">endif</span></u></td></tr>
<tr><th id="39">39</th><td></td></tr>
<tr><th id="40">40</th><td><u>#<span data-ppcond="40">if</span> defined(<span class="macro" data-ref="_M/__FreeBSD__">__FreeBSD__</span>) || (defined(<span class="macro" data-ref="_M/__APPLE__">__APPLE__</span>) &amp;&amp; defined(<span class="macro" data-ref="_M/__MACH__">__MACH__</span>))</u></td></tr>
<tr><th id="41">41</th><td><u># define FD_DIR "/dev/fd"</u></td></tr>
<tr><th id="42">42</th><td><u>#<span data-ppcond="40">else</span></u></td></tr>
<tr><th id="43">43</th><td><u># define <dfn class="macro" id="_M/FD_DIR" data-ref="_M/FD_DIR">FD_DIR</dfn> "/proc/self/fd"</u></td></tr>
<tr><th id="44">44</th><td><u>#<span data-ppcond="40">endif</span></u></td></tr>
<tr><th id="45">45</th><td></td></tr>
<tr><th id="46">46</th><td><u>#define <dfn class="macro" id="_M/POSIX_CALL" data-ref="_M/POSIX_CALL">POSIX_CALL</dfn>(call)   do { if ((call) == -1) goto <a class="lbl" href="#118error" data-ref="118error">error</a>; } while (0)</u></td></tr>
<tr><th id="47">47</th><td></td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td><i  data-doc="_enable_gc">/* If gc was disabled, call gc.enable().  Return 0 on success. */</i></td></tr>
<tr><th id="50">50</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="51">51</th><td><dfn class="tu decl def" id="_enable_gc" title='_enable_gc' data-type='int _enable_gc(int need_to_reenable_gc, PyObject * gc_module)' data-ref="_enable_gc">_enable_gc</dfn>(<em>int</em> <dfn class="local col1 decl" id="51need_to_reenable_gc" title='need_to_reenable_gc' data-type='int' data-ref="51need_to_reenable_gc">need_to_reenable_gc</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col2 decl" id="52gc_module" title='gc_module' data-type='PyObject *' data-ref="52gc_module">gc_module</dfn>)</td></tr>
<tr><th id="52">52</th><td>{</td></tr>
<tr><th id="53">53</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col3 decl" id="53result" title='result' data-type='PyObject *' data-ref="53result">result</dfn>;</td></tr>
<tr><th id="54">54</th><td>    <a class="macro" href="../Include/object.h.html#150" title="static _Py_Identifier PyId_enable = { .next = ((void*)0), .string = &quot;enable&quot;, .object = ((void*)0) }" data-ref="_M/_Py_IDENTIFIER">_Py_IDENTIFIER</a>(enable);</td></tr>
<tr><th id="55">55</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col4 decl" id="54exctype" title='exctype' data-type='PyObject *' data-ref="54exctype">exctype</dfn>, *<dfn class="local col5 decl" id="55val" title='val' data-type='PyObject *' data-ref="55val">val</dfn>, *<dfn class="local col6 decl" id="56tb" title='tb' data-type='PyObject *' data-ref="56tb">tb</dfn>;</td></tr>
<tr><th id="56">56</th><td></td></tr>
<tr><th id="57">57</th><td>    <b>if</b> (<a class="local col1 ref" href="#51need_to_reenable_gc" title='need_to_reenable_gc' data-ref="51need_to_reenable_gc">need_to_reenable_gc</a>) {</td></tr>
<tr><th id="58">58</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_Fetch" title='PyErr_Fetch' data-ref="PyErr_Fetch">PyErr_Fetch</a>(&amp;<a class="local col4 ref" href="#54exctype" title='exctype' data-ref="54exctype">exctype</a>, &amp;<a class="local col5 ref" href="#55val" title='val' data-ref="55val">val</a>, &amp;<a class="local col6 ref" href="#56tb" title='tb' data-ref="56tb">tb</a>);</td></tr>
<tr><th id="59">59</th><td>        <a class="local col3 ref" href="#53result" title='result' data-ref="53result">result</a> = <a class="ref" href="../Include/abstract.h.html#_PyObject_CallMethodId" title='_PyObject_CallMethodId' data-ref="_PyObject_CallMethodId">_PyObject_CallMethodId</a>(<a class="local col2 ref" href="#52gc_module" title='gc_module' data-ref="52gc_module">gc_module</a>, &amp;<a class="local col7 ref" href="#54" title='PyId_enable' data-ref="57PyId_enable">PyId_enable</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="60">60</th><td>        <b>if</b> (<a class="local col4 ref" href="#54exctype" title='exctype' data-ref="54exctype">exctype</a> != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="61">61</th><td>            <a class="ref" href="../Include/pyerrors.h.html#PyErr_Restore" title='PyErr_Restore' data-ref="PyErr_Restore">PyErr_Restore</a>(<a class="local col4 ref" href="#54exctype" title='exctype' data-ref="54exctype">exctype</a>, <a class="local col5 ref" href="#55val" title='val' data-ref="55val">val</a>, <a class="local col6 ref" href="#56tb" title='tb' data-ref="56tb">tb</a>);</td></tr>
<tr><th id="62">62</th><td>        }</td></tr>
<tr><th id="63">63</th><td>        <b>if</b> (<a class="local col3 ref" href="#53result" title='result' data-ref="53result">result</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="64">64</th><td>            <b>return</b> <var>1</var>;</td></tr>
<tr><th id="65">65</th><td>        }</td></tr>
<tr><th id="66">66</th><td>        <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(result); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 66, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col3 ref" href="#53result" title='result' data-ref="53result">result</a>);</td></tr>
<tr><th id="67">67</th><td>    }</td></tr>
<tr><th id="68">68</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="69">69</th><td>}</td></tr>
<tr><th id="70">70</th><td></td></tr>
<tr><th id="71">71</th><td></td></tr>
<tr><th id="72">72</th><td><i  data-doc="_pos_int_from_ascii">/* Convert ASCII to a positive int, no libc call. no overflow. -1 on error. */</i></td></tr>
<tr><th id="73">73</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="74">74</th><td><dfn class="tu decl def" id="_pos_int_from_ascii" title='_pos_int_from_ascii' data-type='int _pos_int_from_ascii(const char * name)' data-ref="_pos_int_from_ascii">_pos_int_from_ascii</dfn>(<em>const</em> <em>char</em> *<dfn class="local col8 decl" id="58name" title='name' data-type='const char *' data-ref="58name">name</dfn>)</td></tr>
<tr><th id="75">75</th><td>{</td></tr>
<tr><th id="76">76</th><td>    <em>int</em> <dfn class="local col9 decl" id="59num" title='num' data-type='int' data-ref="59num">num</dfn> = <var>0</var>;</td></tr>
<tr><th id="77">77</th><td>    <b>while</b> (*<a class="local col8 ref" href="#58name" title='name' data-ref="58name">name</a> &gt;= <kbd>'0'</kbd> &amp;&amp; *<a class="local col8 ref" href="#58name" title='name' data-ref="58name">name</a> &lt;= <kbd>'9'</kbd>) {</td></tr>
<tr><th id="78">78</th><td>        <a class="local col9 ref" href="#59num" title='num' data-ref="59num">num</a> = <a class="local col9 ref" href="#59num" title='num' data-ref="59num">num</a> * <var>10</var> + (*<a class="local col8 ref" href="#58name" title='name' data-ref="58name">name</a> - <kbd>'0'</kbd>);</td></tr>
<tr><th id="79">79</th><td>        ++<a class="local col8 ref" href="#58name" title='name' data-ref="58name">name</a>;</td></tr>
<tr><th id="80">80</th><td>    }</td></tr>
<tr><th id="81">81</th><td>    <b>if</b> (*<a class="local col8 ref" href="#58name" title='name' data-ref="58name">name</a>)</td></tr>
<tr><th id="82">82</th><td>        <b>return</b> -<var>1</var>;  <i>/* Non digit found, not a number. */</i></td></tr>
<tr><th id="83">83</th><td>    <b>return</b> <a class="local col9 ref" href="#59num" title='num' data-ref="59num">num</a>;</td></tr>
<tr><th id="84">84</th><td>}</td></tr>
<tr><th id="85">85</th><td></td></tr>
<tr><th id="86">86</th><td></td></tr>
<tr><th id="87">87</th><td><u>#<span data-ppcond="87">if</span> defined(<span class="macro" data-ref="_M/__FreeBSD__">__FreeBSD__</span>)</u></td></tr>
<tr><th id="88">88</th><td><i>/* When /dev/fd isn't mounted it is often a static directory populated</i></td></tr>
<tr><th id="89">89</th><td><i> * with 0 1 2 or entries for 0 .. 63 on FreeBSD, NetBSD and OpenBSD.</i></td></tr>
<tr><th id="90">90</th><td><i> * NetBSD and OpenBSD have a /proc fs available (though not necessarily</i></td></tr>
<tr><th id="91">91</th><td><i> * mounted) and do not have fdescfs for /dev/fd.  MacOS X has a devfs</i></td></tr>
<tr><th id="92">92</th><td><i> * that properly supports /dev/fd.</i></td></tr>
<tr><th id="93">93</th><td><i> */</i></td></tr>
<tr><th id="94">94</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="95">95</th><td>_is_fdescfs_mounted_on_dev_fd(<em>void</em>)</td></tr>
<tr><th id="96">96</th><td>{</td></tr>
<tr><th id="97">97</th><td>    <b>struct</b> stat dev_stat;</td></tr>
<tr><th id="98">98</th><td>    <b>struct</b> stat dev_fd_stat;</td></tr>
<tr><th id="99">99</th><td>    <b>if</b> (stat(<q>"/dev"</q>, &amp;dev_stat) != <var>0</var>)</td></tr>
<tr><th id="100">100</th><td>        <b>return</b> <var>0</var>;</td></tr>
<tr><th id="101">101</th><td>    <b>if</b> (stat(FD_DIR, &amp;dev_fd_stat) != <var>0</var>)</td></tr>
<tr><th id="102">102</th><td>        <b>return</b> <var>0</var>;</td></tr>
<tr><th id="103">103</th><td>    <b>if</b> (dev_stat.st_dev == dev_fd_stat.st_dev)</td></tr>
<tr><th id="104">104</th><td>        <b>return</b> <var>0</var>;  <i>/* / == /dev == /dev/fd means it is static. #fail */</i></td></tr>
<tr><th id="105">105</th><td>    <b>return</b> <var>1</var>;</td></tr>
<tr><th id="106">106</th><td>}</td></tr>
<tr><th id="107">107</th><td><u>#<span data-ppcond="87">endif</span></u></td></tr>
<tr><th id="108">108</th><td></td></tr>
<tr><th id="109">109</th><td></td></tr>
<tr><th id="110">110</th><td><i  data-doc="_sanity_check_python_fd_sequence">/* Returns 1 if there is a problem with fd_sequence, 0 otherwise. */</i></td></tr>
<tr><th id="111">111</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="112">112</th><td><dfn class="tu decl def" id="_sanity_check_python_fd_sequence" title='_sanity_check_python_fd_sequence' data-type='int _sanity_check_python_fd_sequence(PyObject * fd_sequence)' data-ref="_sanity_check_python_fd_sequence">_sanity_check_python_fd_sequence</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col0 decl" id="60fd_sequence" title='fd_sequence' data-type='PyObject *' data-ref="60fd_sequence">fd_sequence</dfn>)</td></tr>
<tr><th id="113">113</th><td>{</td></tr>
<tr><th id="114">114</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col1 decl" id="61seq_idx" title='seq_idx' data-type='Py_ssize_t' data-ref="61seq_idx">seq_idx</dfn>;</td></tr>
<tr><th id="115">115</th><td>    <em>long</em> <dfn class="local col2 decl" id="62prev_fd" title='prev_fd' data-type='long' data-ref="62prev_fd">prev_fd</dfn> = -<var>1</var>;</td></tr>
<tr><th id="116">116</th><td>    <b>for</b> (<a class="local col1 ref" href="#61seq_idx" title='seq_idx' data-ref="61seq_idx">seq_idx</a> = <var>0</var>; <a class="local col1 ref" href="#61seq_idx" title='seq_idx' data-ref="61seq_idx">seq_idx</a> &lt; <a class="macro" href="../Include/tupleobject.h.html#59" title="(((((((((PyObject*)(fd_sequence))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 26))) != 0)) ? (void) (0) : __assert_fail (&quot;PyTuple_Check(fd_sequence)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 116, __PRETTY_FUNCTION__)),(((PyVarObject*)(fd_sequence))-&gt;ob_size))" data-ref="_M/PyTuple_GET_SIZE">PyTuple_GET_SIZE</a>(<a class="local col0 ref" href="#60fd_sequence" title='fd_sequence' data-ref="60fd_sequence">fd_sequence</a>); ++<a class="local col1 ref" href="#61seq_idx" title='seq_idx' data-ref="61seq_idx">seq_idx</a>) {</td></tr>
<tr><th id="117">117</th><td>        <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a>* <dfn class="local col3 decl" id="63py_fd" title='py_fd' data-type='PyObject *' data-ref="63py_fd">py_fd</dfn> = <a class="macro" href="../Include/tupleobject.h.html#58" title="(((PyTupleObject *)(fd_sequence))-&gt;ob_item[seq_idx])" data-ref="_M/PyTuple_GET_ITEM">PyTuple_GET_ITEM</a>(<a class="local col0 ref" href="#60fd_sequence" title='fd_sequence' data-ref="60fd_sequence">fd_sequence</a>, <a class="local col1 ref" href="#61seq_idx" title='seq_idx' data-ref="61seq_idx">seq_idx</a>);</td></tr>
<tr><th id="118">118</th><td>        <em>long</em> <dfn class="local col4 decl" id="64iter_fd" title='iter_fd' data-type='long' data-ref="64iter_fd">iter_fd</dfn>;</td></tr>
<tr><th id="119">119</th><td>        <b>if</b> (!<a class="macro" href="../Include/longobject.h.html#14" title="((((((PyObject*)(py_fd))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 24))) != 0)" data-ref="_M/PyLong_Check">PyLong_Check</a>(<a class="local col3 ref" href="#63py_fd" title='py_fd' data-ref="63py_fd">py_fd</a>)) {</td></tr>
<tr><th id="120">120</th><td>            <b>return</b> <var>1</var>;</td></tr>
<tr><th id="121">121</th><td>        }</td></tr>
<tr><th id="122">122</th><td>        <a class="local col4 ref" href="#64iter_fd" title='iter_fd' data-ref="64iter_fd">iter_fd</a> = <a class="ref" href="../Include/longobject.h.html#PyLong_AsLong" title='PyLong_AsLong' data-ref="PyLong_AsLong">PyLong_AsLong</a>(<a class="local col3 ref" href="#63py_fd" title='py_fd' data-ref="63py_fd">py_fd</a>);</td></tr>
<tr><th id="123">123</th><td>        <b>if</b> (<a class="local col4 ref" href="#64iter_fd" title='iter_fd' data-ref="64iter_fd">iter_fd</a> &lt; <var>0</var> || <a class="local col4 ref" href="#64iter_fd" title='iter_fd' data-ref="64iter_fd">iter_fd</a> &lt;= <a class="local col2 ref" href="#62prev_fd" title='prev_fd' data-ref="62prev_fd">prev_fd</a> || <a class="local col4 ref" href="#64iter_fd" title='iter_fd' data-ref="64iter_fd">iter_fd</a> &gt; <span class="macro" title="2147483647" data-ref="_M/INT_MAX">INT_MAX</span>) {</td></tr>
<tr><th id="124">124</th><td>            <i>/* Negative, overflow, unsorted, too big for a fd. */</i></td></tr>
<tr><th id="125">125</th><td>            <b>return</b> <var>1</var>;</td></tr>
<tr><th id="126">126</th><td>        }</td></tr>
<tr><th id="127">127</th><td>        <a class="local col2 ref" href="#62prev_fd" title='prev_fd' data-ref="62prev_fd">prev_fd</a> = <a class="local col4 ref" href="#64iter_fd" title='iter_fd' data-ref="64iter_fd">iter_fd</a>;</td></tr>
<tr><th id="128">128</th><td>    }</td></tr>
<tr><th id="129">129</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="130">130</th><td>}</td></tr>
<tr><th id="131">131</th><td></td></tr>
<tr><th id="132">132</th><td></td></tr>
<tr><th id="133">133</th><td><i  data-doc="_is_fd_in_sorted_fd_sequence">/* Is fd found in the sorted Python Sequence? */</i></td></tr>
<tr><th id="134">134</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="135">135</th><td><dfn class="tu decl def" id="_is_fd_in_sorted_fd_sequence" title='_is_fd_in_sorted_fd_sequence' data-type='int _is_fd_in_sorted_fd_sequence(int fd, PyObject * fd_sequence)' data-ref="_is_fd_in_sorted_fd_sequence">_is_fd_in_sorted_fd_sequence</dfn>(<em>int</em> <dfn class="local col5 decl" id="65fd" title='fd' data-type='int' data-ref="65fd">fd</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col6 decl" id="66fd_sequence" title='fd_sequence' data-type='PyObject *' data-ref="66fd_sequence">fd_sequence</dfn>)</td></tr>
<tr><th id="136">136</th><td>{</td></tr>
<tr><th id="137">137</th><td>    <i>/* Binary search. */</i></td></tr>
<tr><th id="138">138</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col7 decl" id="67search_min" title='search_min' data-type='Py_ssize_t' data-ref="67search_min">search_min</dfn> = <var>0</var>;</td></tr>
<tr><th id="139">139</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col8 decl" id="68search_max" title='search_max' data-type='Py_ssize_t' data-ref="68search_max">search_max</dfn> = <a class="macro" href="../Include/tupleobject.h.html#59" title="(((((((((PyObject*)(fd_sequence))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 26))) != 0)) ? (void) (0) : __assert_fail (&quot;PyTuple_Check(fd_sequence)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 139, __PRETTY_FUNCTION__)),(((PyVarObject*)(fd_sequence))-&gt;ob_size))" data-ref="_M/PyTuple_GET_SIZE">PyTuple_GET_SIZE</a>(<a class="local col6 ref" href="#66fd_sequence" title='fd_sequence' data-ref="66fd_sequence">fd_sequence</a>) - <var>1</var>;</td></tr>
<tr><th id="140">140</th><td>    <b>if</b> (<a class="local col8 ref" href="#68search_max" title='search_max' data-ref="68search_max">search_max</a> &lt; <var>0</var>)</td></tr>
<tr><th id="141">141</th><td>        <b>return</b> <var>0</var>;</td></tr>
<tr><th id="142">142</th><td>    <b>do</b> {</td></tr>
<tr><th id="143">143</th><td>        <em>long</em> <dfn class="local col9 decl" id="69middle" title='middle' data-type='long' data-ref="69middle">middle</dfn> = (<a class="local col7 ref" href="#67search_min" title='search_min' data-ref="67search_min">search_min</a> + <a class="local col8 ref" href="#68search_max" title='search_max' data-ref="68search_max">search_max</a>) / <var>2</var>;</td></tr>
<tr><th id="144">144</th><td>        <em>long</em> <dfn class="local col0 decl" id="70middle_fd" title='middle_fd' data-type='long' data-ref="70middle_fd">middle_fd</dfn> = <a class="ref" href="../Include/longobject.h.html#PyLong_AsLong" title='PyLong_AsLong' data-ref="PyLong_AsLong">PyLong_AsLong</a>(<a class="macro" href="../Include/tupleobject.h.html#58" title="(((PyTupleObject *)(fd_sequence))-&gt;ob_item[middle])" data-ref="_M/PyTuple_GET_ITEM">PyTuple_GET_ITEM</a>(<a class="local col6 ref" href="#66fd_sequence" title='fd_sequence' data-ref="66fd_sequence">fd_sequence</a>, <a class="local col9 ref" href="#69middle" title='middle' data-ref="69middle">middle</a>));</td></tr>
<tr><th id="145">145</th><td>        <b>if</b> (<a class="local col5 ref" href="#65fd" title='fd' data-ref="65fd">fd</a> == <a class="local col0 ref" href="#70middle_fd" title='middle_fd' data-ref="70middle_fd">middle_fd</a>)</td></tr>
<tr><th id="146">146</th><td>            <b>return</b> <var>1</var>;</td></tr>
<tr><th id="147">147</th><td>        <b>if</b> (<a class="local col5 ref" href="#65fd" title='fd' data-ref="65fd">fd</a> &gt; <a class="local col0 ref" href="#70middle_fd" title='middle_fd' data-ref="70middle_fd">middle_fd</a>)</td></tr>
<tr><th id="148">148</th><td>            <a class="local col7 ref" href="#67search_min" title='search_min' data-ref="67search_min">search_min</a> = <a class="local col9 ref" href="#69middle" title='middle' data-ref="69middle">middle</a> + <var>1</var>;</td></tr>
<tr><th id="149">149</th><td>        <b>else</b></td></tr>
<tr><th id="150">150</th><td>            <a class="local col8 ref" href="#68search_max" title='search_max' data-ref="68search_max">search_max</a> = <a class="local col9 ref" href="#69middle" title='middle' data-ref="69middle">middle</a> - <var>1</var>;</td></tr>
<tr><th id="151">151</th><td>    } <b>while</b> (<a class="local col7 ref" href="#67search_min" title='search_min' data-ref="67search_min">search_min</a> &lt;= <a class="local col8 ref" href="#68search_max" title='search_max' data-ref="68search_max">search_max</a>);</td></tr>
<tr><th id="152">152</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="153">153</th><td>}</td></tr>
<tr><th id="154">154</th><td></td></tr>
<tr><th id="155">155</th><td><em>static</em> <em>int</em></td></tr>
<tr><th id="156">156</th><td><dfn class="tu decl def" id="make_inheritable" title='make_inheritable' data-type='int make_inheritable(PyObject * py_fds_to_keep, int errpipe_write)' data-ref="make_inheritable">make_inheritable</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col1 decl" id="71py_fds_to_keep" title='py_fds_to_keep' data-type='PyObject *' data-ref="71py_fds_to_keep">py_fds_to_keep</dfn>, <em>int</em> <dfn class="local col2 decl" id="72errpipe_write" title='errpipe_write' data-type='int' data-ref="72errpipe_write">errpipe_write</dfn>)</td></tr>
<tr><th id="157">157</th><td>{</td></tr>
<tr><th id="158">158</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col3 decl" id="73i" title='i' data-type='Py_ssize_t' data-ref="73i">i</dfn>, <dfn class="local col4 decl" id="74len" title='len' data-type='Py_ssize_t' data-ref="74len">len</dfn>;</td></tr>
<tr><th id="159">159</th><td></td></tr>
<tr><th id="160">160</th><td>    <a class="local col4 ref" href="#74len" title='len' data-ref="74len">len</a> = <a class="macro" href="../Include/tupleobject.h.html#59" title="(((((((((PyObject*)(py_fds_to_keep))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 26))) != 0)) ? (void) (0) : __assert_fail (&quot;PyTuple_Check(py_fds_to_keep)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 160, __PRETTY_FUNCTION__)),(((PyVarObject*)(py_fds_to_keep))-&gt;ob_size))" data-ref="_M/PyTuple_GET_SIZE">PyTuple_GET_SIZE</a>(<a class="local col1 ref" href="#71py_fds_to_keep" title='py_fds_to_keep' data-ref="71py_fds_to_keep">py_fds_to_keep</a>);</td></tr>
<tr><th id="161">161</th><td>    <b>for</b> (<a class="local col3 ref" href="#73i" title='i' data-ref="73i">i</a> = <var>0</var>; <a class="local col3 ref" href="#73i" title='i' data-ref="73i">i</a> &lt; <a class="local col4 ref" href="#74len" title='len' data-ref="74len">len</a>; ++<a class="local col3 ref" href="#73i" title='i' data-ref="73i">i</a>) {</td></tr>
<tr><th id="162">162</th><td>        <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a>* <dfn class="local col5 decl" id="75fdobj" title='fdobj' data-type='PyObject *' data-ref="75fdobj">fdobj</dfn> = <a class="macro" href="../Include/tupleobject.h.html#58" title="(((PyTupleObject *)(py_fds_to_keep))-&gt;ob_item[i])" data-ref="_M/PyTuple_GET_ITEM">PyTuple_GET_ITEM</a>(<a class="local col1 ref" href="#71py_fds_to_keep" title='py_fds_to_keep' data-ref="71py_fds_to_keep">py_fds_to_keep</a>, <a class="local col3 ref" href="#73i" title='i' data-ref="73i">i</a>);</td></tr>
<tr><th id="163">163</th><td>        <em>long</em> <dfn class="local col6 decl" id="76fd" title='fd' data-type='long' data-ref="76fd">fd</dfn> = <a class="ref" href="../Include/longobject.h.html#PyLong_AsLong" title='PyLong_AsLong' data-ref="PyLong_AsLong">PyLong_AsLong</a>(<a class="local col5 ref" href="#75fdobj" title='fdobj' data-ref="75fdobj">fdobj</a>);</td></tr>
<tr><th id="164">164</th><td>        <a class="macro" href="../../include/assert.h.html#88" title="((!PyErr_Occurred()) ? (void) (0) : __assert_fail (&quot;!PyErr_Occurred()&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 164, __PRETTY_FUNCTION__))" data-ref="_M/assert">assert</a>(!<a class="ref" href="../Include/pyerrors.h.html#PyErr_Occurred" title='PyErr_Occurred' data-ref="PyErr_Occurred">PyErr_Occurred</a>());</td></tr>
<tr><th id="165">165</th><td>        <a class="macro" href="../../include/assert.h.html#88" title="((0 &lt;= fd &amp;&amp; fd &lt;= 2147483647) ? (void) (0) : __assert_fail (&quot;0 &lt;= fd &amp;&amp; fd &lt;= INT_MAX&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 165, __PRETTY_FUNCTION__))" data-ref="_M/assert">assert</a>(<var>0</var> &lt;= <a class="local col6 ref" href="#76fd" title='fd' data-ref="76fd">fd</a> &amp;&amp; <a class="local col6 ref" href="#76fd" title='fd' data-ref="76fd">fd</a> &lt;= <span class="macro" title="2147483647" data-ref="_M/INT_MAX">INT_MAX</span>);</td></tr>
<tr><th id="166">166</th><td>        <b>if</b> (<a class="local col6 ref" href="#76fd" title='fd' data-ref="76fd">fd</a> == <a class="local col2 ref" href="#72errpipe_write" title='errpipe_write' data-ref="72errpipe_write">errpipe_write</a>) {</td></tr>
<tr><th id="167">167</th><td>            <i>/* errpipe_write is part of py_fds_to_keep. It must be closed at</i></td></tr>
<tr><th id="168">168</th><td><i>               exec(), but kept open in the child process until exec() is</i></td></tr>
<tr><th id="169">169</th><td><i>               called. */</i></td></tr>
<tr><th id="170">170</th><td>            <b>continue</b>;</td></tr>
<tr><th id="171">171</th><td>        }</td></tr>
<tr><th id="172">172</th><td>        <b>if</b> (<a class="ref" href="../Include/fileutils.h.html#_Py_set_inheritable" title='_Py_set_inheritable' data-ref="_Py_set_inheritable">_Py_set_inheritable</a>((<em>int</em>)<a class="local col6 ref" href="#76fd" title='fd' data-ref="76fd">fd</a>, <var>1</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) &lt; <var>0</var>)</td></tr>
<tr><th id="173">173</th><td>            <b>return</b> -<var>1</var>;</td></tr>
<tr><th id="174">174</th><td>    }</td></tr>
<tr><th id="175">175</th><td>    <b>return</b> <var>0</var>;</td></tr>
<tr><th id="176">176</th><td>}</td></tr>
<tr><th id="177">177</th><td></td></tr>
<tr><th id="178">178</th><td></td></tr>
<tr><th id="179">179</th><td><i  data-doc="safe_get_max_fd">/* Get the maximum file descriptor that could be opened by this process.</i></td></tr>
<tr><th id="180">180</th><td><i  data-doc="safe_get_max_fd"> * This function is async signal safe for use between fork() and exec().</i></td></tr>
<tr><th id="181">181</th><td><i  data-doc="safe_get_max_fd"> */</i></td></tr>
<tr><th id="182">182</th><td><em>static</em> <em>long</em></td></tr>
<tr><th id="183">183</th><td><dfn class="tu decl def" id="safe_get_max_fd" title='safe_get_max_fd' data-type='long safe_get_max_fd()' data-ref="safe_get_max_fd">safe_get_max_fd</dfn>(<em>void</em>)</td></tr>
<tr><th id="184">184</th><td>{</td></tr>
<tr><th id="185">185</th><td>    <em>long</em> <dfn class="local col7 decl" id="77local_max_fd" title='local_max_fd' data-type='long' data-ref="77local_max_fd">local_max_fd</dfn>;</td></tr>
<tr><th id="186">186</th><td><u>#<span data-ppcond="186">if</span> defined(<span class="macro" data-ref="_M/__NetBSD__">__NetBSD__</span>)</u></td></tr>
<tr><th id="187">187</th><td>    local_max_fd = fcntl(<var>0</var>, F_MAXFD);</td></tr>
<tr><th id="188">188</th><td>    <b>if</b> (local_max_fd &gt;= <var>0</var>)</td></tr>
<tr><th id="189">189</th><td>        <b>return</b> local_max_fd;</td></tr>
<tr><th id="190">190</th><td><u>#<span data-ppcond="186">endif</span></u></td></tr>
<tr><th id="191">191</th><td><u>#<span data-ppcond="191">if</span> defined(<a class="macro" href="../pyconfig.h.html#1038" data-ref="_M/HAVE_SYS_RESOURCE_H">HAVE_SYS_RESOURCE_H</a>) &amp;&amp; defined(<span class="macro" data-ref="_M/__OpenBSD__">__OpenBSD__</span>)</u></td></tr>
<tr><th id="192">192</th><td>    <b>struct</b> rlimit rl;</td></tr>
<tr><th id="193">193</th><td>    <i>/* Not on the POSIX async signal safe functions list but likely</i></td></tr>
<tr><th id="194">194</th><td><i>     * safe.  TODO - Someone should audit OpenBSD to make sure. */</i></td></tr>
<tr><th id="195">195</th><td>    <b>if</b> (getrlimit(RLIMIT_NOFILE, &amp;rl) &gt;= <var>0</var>)</td></tr>
<tr><th id="196">196</th><td>        <b>return</b> (<em>long</em>) rl.rlim_max;</td></tr>
<tr><th id="197">197</th><td><u>#<span data-ppcond="191">endif</span></u></td></tr>
<tr><th id="198">198</th><td><u>#<span data-ppcond="198">ifdef</span> <a class="macro" href="../../include/x86_64-linux-gnu/bits/confname.h.html#82" data-ref="_M/_SC_OPEN_MAX">_SC_OPEN_MAX</a></u></td></tr>
<tr><th id="199">199</th><td>    <a class="local col7 ref" href="#77local_max_fd" title='local_max_fd' data-ref="77local_max_fd">local_max_fd</a> = <a class="ref" href="../../include/unistd.h.html#sysconf" title='sysconf' data-ref="sysconf">sysconf</a>(<a class="macro" href="../../include/x86_64-linux-gnu/bits/confname.h.html#82" title="_SC_OPEN_MAX" data-ref="_M/_SC_OPEN_MAX">_SC_OPEN_MAX</a>);</td></tr>
<tr><th id="200">200</th><td>    <b>if</b> (<a class="local col7 ref" href="#77local_max_fd" title='local_max_fd' data-ref="77local_max_fd">local_max_fd</a> == -<var>1</var>)</td></tr>
<tr><th id="201">201</th><td><u>#<span data-ppcond="198">endif</span></u></td></tr>
<tr><th id="202">202</th><td>        <a class="local col7 ref" href="#77local_max_fd" title='local_max_fd' data-ref="77local_max_fd">local_max_fd</a> = <var>256</var>;  <i>/* Matches legacy Lib/subprocess.py behavior. */</i></td></tr>
<tr><th id="203">203</th><td>    <b>return</b> <a class="local col7 ref" href="#77local_max_fd" title='local_max_fd' data-ref="77local_max_fd">local_max_fd</a>;</td></tr>
<tr><th id="204">204</th><td>}</td></tr>
<tr><th id="205">205</th><td></td></tr>
<tr><th id="206">206</th><td></td></tr>
<tr><th id="207">207</th><td><i  data-doc="_close_fds_by_brute_force">/* Close all file descriptors in the range from start_fd and higher</i></td></tr>
<tr><th id="208">208</th><td><i  data-doc="_close_fds_by_brute_force"> * except for those in py_fds_to_keep.  If the range defined by</i></td></tr>
<tr><th id="209">209</th><td><i  data-doc="_close_fds_by_brute_force"> * [start_fd, safe_get_max_fd()) is large this will take a long</i></td></tr>
<tr><th id="210">210</th><td><i  data-doc="_close_fds_by_brute_force"> * time as it calls close() on EVERY possible fd.</i></td></tr>
<tr><th id="211">211</th><td><i  data-doc="_close_fds_by_brute_force"> *</i></td></tr>
<tr><th id="212">212</th><td><i  data-doc="_close_fds_by_brute_force"> * It isn't possible to know for sure what the max fd to go up to</i></td></tr>
<tr><th id="213">213</th><td><i  data-doc="_close_fds_by_brute_force"> * is for processes with the capability of raising their maximum.</i></td></tr>
<tr><th id="214">214</th><td><i  data-doc="_close_fds_by_brute_force"> */</i></td></tr>
<tr><th id="215">215</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="216">216</th><td><dfn class="tu decl def" id="_close_fds_by_brute_force" title='_close_fds_by_brute_force' data-type='void _close_fds_by_brute_force(long start_fd, PyObject * py_fds_to_keep)' data-ref="_close_fds_by_brute_force">_close_fds_by_brute_force</dfn>(<em>long</em> <dfn class="local col8 decl" id="78start_fd" title='start_fd' data-type='long' data-ref="78start_fd">start_fd</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col9 decl" id="79py_fds_to_keep" title='py_fds_to_keep' data-type='PyObject *' data-ref="79py_fds_to_keep">py_fds_to_keep</dfn>)</td></tr>
<tr><th id="217">217</th><td>{</td></tr>
<tr><th id="218">218</th><td>    <em>long</em> <dfn class="local col0 decl" id="80end_fd" title='end_fd' data-type='long' data-ref="80end_fd">end_fd</dfn> = <a class="tu ref" href="#safe_get_max_fd" title='safe_get_max_fd' data-use='c' data-ref="safe_get_max_fd">safe_get_max_fd</a>();</td></tr>
<tr><th id="219">219</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col1 decl" id="81num_fds_to_keep" title='num_fds_to_keep' data-type='Py_ssize_t' data-ref="81num_fds_to_keep">num_fds_to_keep</dfn> = <a class="macro" href="../Include/tupleobject.h.html#59" title="(((((((((PyObject*)(py_fds_to_keep))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 26))) != 0)) ? (void) (0) : __assert_fail (&quot;PyTuple_Check(py_fds_to_keep)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 219, __PRETTY_FUNCTION__)),(((PyVarObject*)(py_fds_to_keep))-&gt;ob_size))" data-ref="_M/PyTuple_GET_SIZE">PyTuple_GET_SIZE</a>(<a class="local col9 ref" href="#79py_fds_to_keep" title='py_fds_to_keep' data-ref="79py_fds_to_keep">py_fds_to_keep</a>);</td></tr>
<tr><th id="220">220</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col2 decl" id="82keep_seq_idx" title='keep_seq_idx' data-type='Py_ssize_t' data-ref="82keep_seq_idx">keep_seq_idx</dfn>;</td></tr>
<tr><th id="221">221</th><td>    <em>int</em> <dfn class="local col3 decl" id="83fd_num" title='fd_num' data-type='int' data-ref="83fd_num">fd_num</dfn>;</td></tr>
<tr><th id="222">222</th><td>    <i>/* As py_fds_to_keep is sorted we can loop through the list closing</i></td></tr>
<tr><th id="223">223</th><td><i>     * fds inbetween any in the keep list falling within our range. */</i></td></tr>
<tr><th id="224">224</th><td>    <b>for</b> (<a class="local col2 ref" href="#82keep_seq_idx" title='keep_seq_idx' data-ref="82keep_seq_idx">keep_seq_idx</a> = <var>0</var>; <a class="local col2 ref" href="#82keep_seq_idx" title='keep_seq_idx' data-ref="82keep_seq_idx">keep_seq_idx</a> &lt; <a class="local col1 ref" href="#81num_fds_to_keep" title='num_fds_to_keep' data-ref="81num_fds_to_keep">num_fds_to_keep</a>; ++<a class="local col2 ref" href="#82keep_seq_idx" title='keep_seq_idx' data-ref="82keep_seq_idx">keep_seq_idx</a>) {</td></tr>
<tr><th id="225">225</th><td>        <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a>* <dfn class="local col4 decl" id="84py_keep_fd" title='py_keep_fd' data-type='PyObject *' data-ref="84py_keep_fd">py_keep_fd</dfn> = <a class="macro" href="../Include/tupleobject.h.html#58" title="(((PyTupleObject *)(py_fds_to_keep))-&gt;ob_item[keep_seq_idx])" data-ref="_M/PyTuple_GET_ITEM">PyTuple_GET_ITEM</a>(<a class="local col9 ref" href="#79py_fds_to_keep" title='py_fds_to_keep' data-ref="79py_fds_to_keep">py_fds_to_keep</a>, <a class="local col2 ref" href="#82keep_seq_idx" title='keep_seq_idx' data-ref="82keep_seq_idx">keep_seq_idx</a>);</td></tr>
<tr><th id="226">226</th><td>        <em>int</em> <dfn class="local col5 decl" id="85keep_fd" title='keep_fd' data-type='int' data-ref="85keep_fd">keep_fd</dfn> = <a class="ref" href="../Include/longobject.h.html#PyLong_AsLong" title='PyLong_AsLong' data-ref="PyLong_AsLong">PyLong_AsLong</a>(<a class="local col4 ref" href="#84py_keep_fd" title='py_keep_fd' data-ref="84py_keep_fd">py_keep_fd</a>);</td></tr>
<tr><th id="227">227</th><td>        <b>if</b> (<a class="local col5 ref" href="#85keep_fd" title='keep_fd' data-ref="85keep_fd">keep_fd</a> &lt; <a class="local col8 ref" href="#78start_fd" title='start_fd' data-ref="78start_fd">start_fd</a>)</td></tr>
<tr><th id="228">228</th><td>            <b>continue</b>;</td></tr>
<tr><th id="229">229</th><td>        <b>for</b> (<a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a> = <a class="local col8 ref" href="#78start_fd" title='start_fd' data-ref="78start_fd">start_fd</a>; <a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a> &lt; <a class="local col5 ref" href="#85keep_fd" title='keep_fd' data-ref="85keep_fd">keep_fd</a>; ++<a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a>) {</td></tr>
<tr><th id="230">230</th><td>            <a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a>);</td></tr>
<tr><th id="231">231</th><td>        }</td></tr>
<tr><th id="232">232</th><td>        <a class="local col8 ref" href="#78start_fd" title='start_fd' data-ref="78start_fd">start_fd</a> = <a class="local col5 ref" href="#85keep_fd" title='keep_fd' data-ref="85keep_fd">keep_fd</a> + <var>1</var>;</td></tr>
<tr><th id="233">233</th><td>    }</td></tr>
<tr><th id="234">234</th><td>    <b>if</b> (<a class="local col8 ref" href="#78start_fd" title='start_fd' data-ref="78start_fd">start_fd</a> &lt;= <a class="local col0 ref" href="#80end_fd" title='end_fd' data-ref="80end_fd">end_fd</a>) {</td></tr>
<tr><th id="235">235</th><td>        <b>for</b> (<a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a> = <a class="local col8 ref" href="#78start_fd" title='start_fd' data-ref="78start_fd">start_fd</a>; <a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a> &lt; <a class="local col0 ref" href="#80end_fd" title='end_fd' data-ref="80end_fd">end_fd</a>; ++<a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a>) {</td></tr>
<tr><th id="236">236</th><td>            <a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col3 ref" href="#83fd_num" title='fd_num' data-ref="83fd_num">fd_num</a>);</td></tr>
<tr><th id="237">237</th><td>        }</td></tr>
<tr><th id="238">238</th><td>    }</td></tr>
<tr><th id="239">239</th><td>}</td></tr>
<tr><th id="240">240</th><td></td></tr>
<tr><th id="241">241</th><td></td></tr>
<tr><th id="242">242</th><td><u>#<span data-ppcond="242">if</span> defined(<span class="macro" data-ref="_M/__linux__">__linux__</span>) &amp;&amp; defined(<a class="macro" href="../pyconfig.h.html#1056" data-ref="_M/HAVE_SYS_SYSCALL_H">HAVE_SYS_SYSCALL_H</a>)</u></td></tr>
<tr><th id="243">243</th><td><i>/* It doesn't matter if d_name has room for NAME_MAX chars; we're using this</i></td></tr>
<tr><th id="244">244</th><td><i> * only to read a directory of short file descriptor number names.  The kernel</i></td></tr>
<tr><th id="245">245</th><td><i> * will return an error if we didn't give it enough space.  Highly Unlikely.</i></td></tr>
<tr><th id="246">246</th><td><i> * This structure is very old and stable: It will not change unless the kernel</i></td></tr>
<tr><th id="247">247</th><td><i> * chooses to break compatibility with all existing binaries.  Highly Unlikely.</i></td></tr>
<tr><th id="248">248</th><td><i> */</i></td></tr>
<tr><th id="249">249</th><td><b>struct</b> <dfn class="type def" id="linux_dirent64" title='linux_dirent64' data-ref="linux_dirent64">linux_dirent64</dfn> {</td></tr>
<tr><th id="250">250</th><td>   <em>unsigned</em> <em>long</em> <em>long</em> <dfn class="tu decl" id="linux_dirent64::d_ino" title='linux_dirent64::d_ino' data-type='unsigned long long' data-ref="linux_dirent64::d_ino">d_ino</dfn>;</td></tr>
<tr><th id="251">251</th><td>   <em>long</em> <em>long</em> <dfn class="tu decl" id="linux_dirent64::d_off" title='linux_dirent64::d_off' data-type='long long' data-ref="linux_dirent64::d_off">d_off</dfn>;</td></tr>
<tr><th id="252">252</th><td>   <em>unsigned</em> <em>short</em> <dfn class="tu decl" id="linux_dirent64::d_reclen" title='linux_dirent64::d_reclen' data-type='unsigned short' data-ref="linux_dirent64::d_reclen">d_reclen</dfn>;     <i  data-doc="linux_dirent64::d_reclen">/* Length of this linux_dirent */</i></td></tr>
<tr><th id="253">253</th><td>   <em>unsigned</em> <em>char</em>  <dfn class="tu decl" id="linux_dirent64::d_type" title='linux_dirent64::d_type' data-type='unsigned char' data-ref="linux_dirent64::d_type">d_type</dfn>;</td></tr>
<tr><th id="254">254</th><td>   <em>char</em>           <dfn class="tu decl" id="linux_dirent64::d_name" title='linux_dirent64::d_name' data-type='char [256]' data-ref="linux_dirent64::d_name">d_name</dfn>[<var>256</var>];  <i  data-doc="linux_dirent64::d_name">/* Filename (null-terminated) */</i></td></tr>
<tr><th id="255">255</th><td>};</td></tr>
<tr><th id="256">256</th><td></td></tr>
<tr><th id="257">257</th><td><i  data-doc="_close_open_fds_safe">/* Close all open file descriptors in the range from start_fd and higher</i></td></tr>
<tr><th id="258">258</th><td><i  data-doc="_close_open_fds_safe"> * Do not close any in the sorted py_fds_to_keep list.</i></td></tr>
<tr><th id="259">259</th><td><i  data-doc="_close_open_fds_safe"> *</i></td></tr>
<tr><th id="260">260</th><td><i  data-doc="_close_open_fds_safe"> * This version is async signal safe as it does not make any unsafe C library</i></td></tr>
<tr><th id="261">261</th><td><i  data-doc="_close_open_fds_safe"> * calls, malloc calls or handle any locks.  It is _unfortunate_ to be forced</i></td></tr>
<tr><th id="262">262</th><td><i  data-doc="_close_open_fds_safe"> * to resort to making a kernel system call directly but this is the ONLY api</i></td></tr>
<tr><th id="263">263</th><td><i  data-doc="_close_open_fds_safe"> * available that does no harm.  opendir/readdir/closedir perform memory</i></td></tr>
<tr><th id="264">264</th><td><i  data-doc="_close_open_fds_safe"> * allocation and locking so while they usually work they are not guaranteed</i></td></tr>
<tr><th id="265">265</th><td><i  data-doc="_close_open_fds_safe"> * to (especially if you have replaced your malloc implementation).  A version</i></td></tr>
<tr><th id="266">266</th><td><i  data-doc="_close_open_fds_safe"> * of this function that uses those can be found in the _maybe_unsafe variant.</i></td></tr>
<tr><th id="267">267</th><td><i  data-doc="_close_open_fds_safe"> *</i></td></tr>
<tr><th id="268">268</th><td><i  data-doc="_close_open_fds_safe"> * This is Linux specific because that is all I am ready to test it on.  It</i></td></tr>
<tr><th id="269">269</th><td><i  data-doc="_close_open_fds_safe"> * should be easy to add OS specific dirent or dirent64 structures and modify</i></td></tr>
<tr><th id="270">270</th><td><i  data-doc="_close_open_fds_safe"> * it with some cpp #define magic to work on other OSes as well if you want.</i></td></tr>
<tr><th id="271">271</th><td><i  data-doc="_close_open_fds_safe"> */</i></td></tr>
<tr><th id="272">272</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="273">273</th><td><dfn class="tu decl def" id="_close_open_fds_safe" title='_close_open_fds_safe' data-type='void _close_open_fds_safe(int start_fd, PyObject * py_fds_to_keep)' data-ref="_close_open_fds_safe">_close_open_fds_safe</dfn>(<em>int</em> <dfn class="local col6 decl" id="86start_fd" title='start_fd' data-type='int' data-ref="86start_fd">start_fd</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a>* <dfn class="local col7 decl" id="87py_fds_to_keep" title='py_fds_to_keep' data-type='PyObject *' data-ref="87py_fds_to_keep">py_fds_to_keep</dfn>)</td></tr>
<tr><th id="274">274</th><td>{</td></tr>
<tr><th id="275">275</th><td>    <em>int</em> <dfn class="local col8 decl" id="88fd_dir_fd" title='fd_dir_fd' data-type='int' data-ref="88fd_dir_fd">fd_dir_fd</dfn>;</td></tr>
<tr><th id="276">276</th><td></td></tr>
<tr><th id="277">277</th><td>    <a class="local col8 ref" href="#88fd_dir_fd" title='fd_dir_fd' data-ref="88fd_dir_fd">fd_dir_fd</a> = <a class="ref" href="../Include/fileutils.h.html#_Py_open_noraise" title='_Py_open_noraise' data-ref="_Py_open_noraise">_Py_open_noraise</a>(<a class="macro" href="#43" title="&quot;/proc/self/fd&quot;" data-ref="_M/FD_DIR">FD_DIR</a>, <a class="macro" href="../../include/x86_64-linux-gnu/bits/fcntl-linux.h.html#43" title="00" data-ref="_M/O_RDONLY">O_RDONLY</a>);</td></tr>
<tr><th id="278">278</th><td>    <b>if</b> (<a class="local col8 ref" href="#88fd_dir_fd" title='fd_dir_fd' data-ref="88fd_dir_fd">fd_dir_fd</a> == -<var>1</var>) {</td></tr>
<tr><th id="279">279</th><td>        <i>/* No way to get a list of open fds. */</i></td></tr>
<tr><th id="280">280</th><td>        <a class="tu ref" href="#_close_fds_by_brute_force" title='_close_fds_by_brute_force' data-use='c' data-ref="_close_fds_by_brute_force">_close_fds_by_brute_force</a>(<a class="local col6 ref" href="#86start_fd" title='start_fd' data-ref="86start_fd">start_fd</a>, <a class="local col7 ref" href="#87py_fds_to_keep" title='py_fds_to_keep' data-ref="87py_fds_to_keep">py_fds_to_keep</a>);</td></tr>
<tr><th id="281">281</th><td>        <b>return</b>;</td></tr>
<tr><th id="282">282</th><td>    } <b>else</b> {</td></tr>
<tr><th id="283">283</th><td>        <em>char</em> <dfn class="local col9 decl" id="89buffer" title='buffer' data-type='char [280]' data-ref="89buffer">buffer</dfn>[<b>sizeof</b>(<b>struct</b> <a class="type" href="#linux_dirent64" title='linux_dirent64' data-ref="linux_dirent64">linux_dirent64</a>)];</td></tr>
<tr><th id="284">284</th><td>        <em>int</em> <dfn class="local col0 decl" id="90bytes" title='bytes' data-type='int' data-ref="90bytes">bytes</dfn>;</td></tr>
<tr><th id="285">285</th><td>        <b>while</b> ((<a class="local col0 ref" href="#90bytes" title='bytes' data-ref="90bytes">bytes</a> = <a class="ref" href="../../include/unistd.h.html#syscall" title='syscall' data-ref="syscall">syscall</a>(<a class="macro" href="../../include/x86_64-linux-gnu/bits/syscall.h.html#462" title="217" data-ref="_M/SYS_getdents64">SYS_getdents64</a>, <a class="local col8 ref" href="#88fd_dir_fd" title='fd_dir_fd' data-ref="88fd_dir_fd">fd_dir_fd</a>,</td></tr>
<tr><th id="286">286</th><td>                                (<b>struct</b> <a class="type" href="#linux_dirent64" title='linux_dirent64' data-ref="linux_dirent64">linux_dirent64</a> *)<a class="local col9 ref" href="#89buffer" title='buffer' data-ref="89buffer">buffer</a>,</td></tr>
<tr><th id="287">287</th><td>                                <b>sizeof</b>(<a class="local col9 ref" href="#89buffer" title='buffer' data-ref="89buffer">buffer</a>))) &gt; <var>0</var>) {</td></tr>
<tr><th id="288">288</th><td>            <b>struct</b> <a class="type" href="#linux_dirent64" title='linux_dirent64' data-ref="linux_dirent64">linux_dirent64</a> *<dfn class="local col1 decl" id="91entry" title='entry' data-type='struct linux_dirent64 *' data-ref="91entry">entry</dfn>;</td></tr>
<tr><th id="289">289</th><td>            <em>int</em> <dfn class="local col2 decl" id="92offset" title='offset' data-type='int' data-ref="92offset">offset</dfn>;</td></tr>
<tr><th id="290">290</th><td>            <b>for</b> (<a class="local col2 ref" href="#92offset" title='offset' data-ref="92offset">offset</a> = <var>0</var>; <a class="local col2 ref" href="#92offset" title='offset' data-ref="92offset">offset</a> &lt; <a class="local col0 ref" href="#90bytes" title='bytes' data-ref="90bytes">bytes</a>; <a class="local col2 ref" href="#92offset" title='offset' data-ref="92offset">offset</a> += <a class="local col1 ref" href="#91entry" title='entry' data-ref="91entry">entry</a>-&gt;<a class="tu ref" href="#linux_dirent64::d_reclen" title='linux_dirent64::d_reclen' data-use='r' data-ref="linux_dirent64::d_reclen">d_reclen</a>) {</td></tr>
<tr><th id="291">291</th><td>                <em>int</em> <dfn class="local col3 decl" id="93fd" title='fd' data-type='int' data-ref="93fd">fd</dfn>;</td></tr>
<tr><th id="292">292</th><td>                <a class="local col1 ref" href="#91entry" title='entry' data-ref="91entry">entry</a> = (<b>struct</b> <a class="type" href="#linux_dirent64" title='linux_dirent64' data-ref="linux_dirent64">linux_dirent64</a> *)(<a class="local col9 ref" href="#89buffer" title='buffer' data-ref="89buffer">buffer</a> + <a class="local col2 ref" href="#92offset" title='offset' data-ref="92offset">offset</a>);</td></tr>
<tr><th id="293">293</th><td>                <b>if</b> ((<a class="local col3 ref" href="#93fd" title='fd' data-ref="93fd">fd</a> = <a class="tu ref" href="#_pos_int_from_ascii" title='_pos_int_from_ascii' data-use='c' data-ref="_pos_int_from_ascii">_pos_int_from_ascii</a>(<a class="local col1 ref" href="#91entry" title='entry' data-ref="91entry">entry</a>-&gt;<a class="tu ref" href="#linux_dirent64::d_name" title='linux_dirent64::d_name' data-use='r' data-ref="linux_dirent64::d_name">d_name</a>)) &lt; <var>0</var>)</td></tr>
<tr><th id="294">294</th><td>                    <b>continue</b>;  <i>/* Not a number. */</i></td></tr>
<tr><th id="295">295</th><td>                <b>if</b> (<a class="local col3 ref" href="#93fd" title='fd' data-ref="93fd">fd</a> != <a class="local col8 ref" href="#88fd_dir_fd" title='fd_dir_fd' data-ref="88fd_dir_fd">fd_dir_fd</a> &amp;&amp; <a class="local col3 ref" href="#93fd" title='fd' data-ref="93fd">fd</a> &gt;= <a class="local col6 ref" href="#86start_fd" title='start_fd' data-ref="86start_fd">start_fd</a> &amp;&amp;</td></tr>
<tr><th id="296">296</th><td>                    !<a class="tu ref" href="#_is_fd_in_sorted_fd_sequence" title='_is_fd_in_sorted_fd_sequence' data-use='c' data-ref="_is_fd_in_sorted_fd_sequence">_is_fd_in_sorted_fd_sequence</a>(<a class="local col3 ref" href="#93fd" title='fd' data-ref="93fd">fd</a>, <a class="local col7 ref" href="#87py_fds_to_keep" title='py_fds_to_keep' data-ref="87py_fds_to_keep">py_fds_to_keep</a>)) {</td></tr>
<tr><th id="297">297</th><td>                    <a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col3 ref" href="#93fd" title='fd' data-ref="93fd">fd</a>);</td></tr>
<tr><th id="298">298</th><td>                }</td></tr>
<tr><th id="299">299</th><td>            }</td></tr>
<tr><th id="300">300</th><td>        }</td></tr>
<tr><th id="301">301</th><td>        <a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col8 ref" href="#88fd_dir_fd" title='fd_dir_fd' data-ref="88fd_dir_fd">fd_dir_fd</a>);</td></tr>
<tr><th id="302">302</th><td>    }</td></tr>
<tr><th id="303">303</th><td>}</td></tr>
<tr><th id="304">304</th><td></td></tr>
<tr><th id="305">305</th><td><u>#define <dfn class="macro" id="_M/_close_open_fds" data-ref="_M/_close_open_fds">_close_open_fds</dfn> <a class="tu ref" href="#_close_open_fds_safe" title='_close_open_fds_safe' data-use='c' data-ref="_close_open_fds_safe">_close_open_fds_safe</a></u></td></tr>
<tr><th id="306">306</th><td></td></tr>
<tr><th id="307">307</th><td><u>#<span data-ppcond="242">else</span>  /* NOT (defined(__linux__) &amp;&amp; defined(HAVE_SYS_SYSCALL_H)) */</u></td></tr>
<tr><th id="308">308</th><td></td></tr>
<tr><th id="309">309</th><td></td></tr>
<tr><th id="310">310</th><td><i>/* Close all open file descriptors from start_fd and higher.</i></td></tr>
<tr><th id="311">311</th><td><i> * Do not close any in the sorted py_fds_to_keep tuple.</i></td></tr>
<tr><th id="312">312</th><td><i> *</i></td></tr>
<tr><th id="313">313</th><td><i> * This function violates the strict use of async signal safe functions. :(</i></td></tr>
<tr><th id="314">314</th><td><i> * It calls opendir(), readdir() and closedir().  Of these, the one most</i></td></tr>
<tr><th id="315">315</th><td><i> * likely to ever cause a problem is opendir() as it performs an internal</i></td></tr>
<tr><th id="316">316</th><td><i> * malloc().  Practically this should not be a problem.  The Java VM makes the</i></td></tr>
<tr><th id="317">317</th><td><i> * same calls between fork and exec in its own UNIXProcess_md.c implementation.</i></td></tr>
<tr><th id="318">318</th><td><i> *</i></td></tr>
<tr><th id="319">319</th><td><i> * readdir_r() is not used because it provides no benefit.  It is typically</i></td></tr>
<tr><th id="320">320</th><td><i> * implemented as readdir() followed by memcpy().  See also:</i></td></tr>
<tr><th id="321">321</th><td><i> *   <a href="http://womble.decadent.org.uk/readdir_r-advisory.html">http://womble.decadent.org.uk/readdir_r-advisory.html</a></i></td></tr>
<tr><th id="322">322</th><td><i> */</i></td></tr>
<tr><th id="323">323</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="324">324</th><td>_close_open_fds_maybe_unsafe(<em>long</em> start_fd, PyObject* py_fds_to_keep)</td></tr>
<tr><th id="325">325</th><td>{</td></tr>
<tr><th id="326">326</th><td>    DIR *proc_fd_dir;</td></tr>
<tr><th id="327">327</th><td><u>#ifndef HAVE_DIRFD</u></td></tr>
<tr><th id="328">328</th><td>    <b>while</b> (_is_fd_in_sorted_fd_sequence(start_fd, py_fds_to_keep)) {</td></tr>
<tr><th id="329">329</th><td>        ++start_fd;</td></tr>
<tr><th id="330">330</th><td>    }</td></tr>
<tr><th id="331">331</th><td>    <i>/* Close our lowest fd before we call opendir so that it is likely to</i></td></tr>
<tr><th id="332">332</th><td><i>     * reuse that fd otherwise we might close opendir's file descriptor in</i></td></tr>
<tr><th id="333">333</th><td><i>     * our loop.  This trick assumes that fd's are allocated on a lowest</i></td></tr>
<tr><th id="334">334</th><td><i>     * available basis. */</i></td></tr>
<tr><th id="335">335</th><td>    close(start_fd);</td></tr>
<tr><th id="336">336</th><td>    ++start_fd;</td></tr>
<tr><th id="337">337</th><td><u>#endif</u></td></tr>
<tr><th id="338">338</th><td></td></tr>
<tr><th id="339">339</th><td><u>#if defined(__FreeBSD__)</u></td></tr>
<tr><th id="340">340</th><td>    <b>if</b> (!_is_fdescfs_mounted_on_dev_fd())</td></tr>
<tr><th id="341">341</th><td>        proc_fd_dir = NULL;</td></tr>
<tr><th id="342">342</th><td>    <b>else</b></td></tr>
<tr><th id="343">343</th><td><u>#endif</u></td></tr>
<tr><th id="344">344</th><td>        proc_fd_dir = opendir(FD_DIR);</td></tr>
<tr><th id="345">345</th><td>    <b>if</b> (!proc_fd_dir) {</td></tr>
<tr><th id="346">346</th><td>        <i>/* No way to get a list of open fds. */</i></td></tr>
<tr><th id="347">347</th><td>        _close_fds_by_brute_force(start_fd, py_fds_to_keep);</td></tr>
<tr><th id="348">348</th><td>    } <b>else</b> {</td></tr>
<tr><th id="349">349</th><td>        <b>struct</b> dirent *dir_entry;</td></tr>
<tr><th id="350">350</th><td><u>#ifdef HAVE_DIRFD</u></td></tr>
<tr><th id="351">351</th><td>        <em>int</em> fd_used_by_opendir = dirfd(proc_fd_dir);</td></tr>
<tr><th id="352">352</th><td><u>#else</u></td></tr>
<tr><th id="353">353</th><td>        <em>int</em> fd_used_by_opendir = start_fd - <var>1</var>;</td></tr>
<tr><th id="354">354</th><td><u>#endif</u></td></tr>
<tr><th id="355">355</th><td>        errno = <var>0</var>;</td></tr>
<tr><th id="356">356</th><td>        <b>while</b> ((dir_entry = readdir(proc_fd_dir))) {</td></tr>
<tr><th id="357">357</th><td>            <em>int</em> fd;</td></tr>
<tr><th id="358">358</th><td>            <b>if</b> ((fd = _pos_int_from_ascii(dir_entry-&gt;d_name)) &lt; <var>0</var>)</td></tr>
<tr><th id="359">359</th><td>                <b>continue</b>;  <i>/* Not a number. */</i></td></tr>
<tr><th id="360">360</th><td>            <b>if</b> (fd != fd_used_by_opendir &amp;&amp; fd &gt;= start_fd &amp;&amp;</td></tr>
<tr><th id="361">361</th><td>                !_is_fd_in_sorted_fd_sequence(fd, py_fds_to_keep)) {</td></tr>
<tr><th id="362">362</th><td>                close(fd);</td></tr>
<tr><th id="363">363</th><td>            }</td></tr>
<tr><th id="364">364</th><td>            errno = <var>0</var>;</td></tr>
<tr><th id="365">365</th><td>        }</td></tr>
<tr><th id="366">366</th><td>        <b>if</b> (errno) {</td></tr>
<tr><th id="367">367</th><td>            <i>/* readdir error, revert behavior. Highly Unlikely. */</i></td></tr>
<tr><th id="368">368</th><td>            _close_fds_by_brute_force(start_fd, py_fds_to_keep);</td></tr>
<tr><th id="369">369</th><td>        }</td></tr>
<tr><th id="370">370</th><td>        closedir(proc_fd_dir);</td></tr>
<tr><th id="371">371</th><td>    }</td></tr>
<tr><th id="372">372</th><td>}</td></tr>
<tr><th id="373">373</th><td></td></tr>
<tr><th id="374">374</th><td><u>#define _close_open_fds _close_open_fds_maybe_unsafe</u></td></tr>
<tr><th id="375">375</th><td></td></tr>
<tr><th id="376">376</th><td><u>#<span data-ppcond="242">endif</span>  /* else NOT (defined(__linux__) &amp;&amp; defined(HAVE_SYS_SYSCALL_H)) */</u></td></tr>
<tr><th id="377">377</th><td></td></tr>
<tr><th id="378">378</th><td></td></tr>
<tr><th id="379">379</th><td><i  data-doc="child_exec">/*</i></td></tr>
<tr><th id="380">380</th><td><i  data-doc="child_exec"> * This function is code executed in the child process immediately after fork</i></td></tr>
<tr><th id="381">381</th><td><i  data-doc="child_exec"> * to set things up and call exec().</i></td></tr>
<tr><th id="382">382</th><td><i  data-doc="child_exec"> *</i></td></tr>
<tr><th id="383">383</th><td><i  data-doc="child_exec"> * All of the code in this function must only use async-signal-safe functions,</i></td></tr>
<tr><th id="384">384</th><td><i  data-doc="child_exec"> * listed at `man 7 signal` or</i></td></tr>
<tr><th id="385">385</th><td><i  data-doc="child_exec"> * <a href="http://www.opengroup.org/onlinepubs/009695399/functions/xsh_chap02_04.html">http://www.opengroup.org/onlinepubs/009695399/functions/xsh_chap02_04.html</a>.</i></td></tr>
<tr><th id="386">386</th><td><i  data-doc="child_exec"> *</i></td></tr>
<tr><th id="387">387</th><td><i  data-doc="child_exec"> * This restriction is documented at</i></td></tr>
<tr><th id="388">388</th><td><i  data-doc="child_exec"> * <a href="http://www.opengroup.org/onlinepubs/009695399/functions/fork.html">http://www.opengroup.org/onlinepubs/009695399/functions/fork.html</a>.</i></td></tr>
<tr><th id="389">389</th><td><i  data-doc="child_exec"> */</i></td></tr>
<tr><th id="390">390</th><td><em>static</em> <em>void</em></td></tr>
<tr><th id="391">391</th><td><dfn class="tu decl def" id="child_exec" title='child_exec' data-type='void child_exec(char *const * exec_array, char *const * argv, char *const * envp, const char * cwd, int p2cread, int p2cwrite, int c2pread, int c2pwrite, int errread, int errwrite, int errpipe_read, int errpipe_write, int close_fds, int restore_signals, int call_setsid, PyObject * py_fds_to_keep, PyObject * preexec_fn, PyObject * preexec_fn_args_tuple)' data-ref="child_exec">child_exec</dfn>(<em>char</em> *<em>const</em> <dfn class="local col4 decl" id="94exec_array" title='exec_array' data-type='char *const *' data-ref="94exec_array">exec_array</dfn>[],</td></tr>
<tr><th id="392">392</th><td>           <em>char</em> *<em>const</em> <dfn class="local col5 decl" id="95argv" title='argv' data-type='char *const *' data-ref="95argv">argv</dfn>[],</td></tr>
<tr><th id="393">393</th><td>           <em>char</em> *<em>const</em> <dfn class="local col6 decl" id="96envp" title='envp' data-type='char *const *' data-ref="96envp">envp</dfn>[],</td></tr>
<tr><th id="394">394</th><td>           <em>const</em> <em>char</em> *<dfn class="local col7 decl" id="97cwd" title='cwd' data-type='const char *' data-ref="97cwd">cwd</dfn>,</td></tr>
<tr><th id="395">395</th><td>           <em>int</em> <dfn class="local col8 decl" id="98p2cread" title='p2cread' data-type='int' data-ref="98p2cread">p2cread</dfn>, <em>int</em> <dfn class="local col9 decl" id="99p2cwrite" title='p2cwrite' data-type='int' data-ref="99p2cwrite">p2cwrite</dfn>,</td></tr>
<tr><th id="396">396</th><td>           <em>int</em> <dfn class="local col0 decl" id="100c2pread" title='c2pread' data-type='int' data-ref="100c2pread">c2pread</dfn>, <em>int</em> <dfn class="local col1 decl" id="101c2pwrite" title='c2pwrite' data-type='int' data-ref="101c2pwrite">c2pwrite</dfn>,</td></tr>
<tr><th id="397">397</th><td>           <em>int</em> <dfn class="local col2 decl" id="102errread" title='errread' data-type='int' data-ref="102errread">errread</dfn>, <em>int</em> <dfn class="local col3 decl" id="103errwrite" title='errwrite' data-type='int' data-ref="103errwrite">errwrite</dfn>,</td></tr>
<tr><th id="398">398</th><td>           <em>int</em> <dfn class="local col4 decl" id="104errpipe_read" title='errpipe_read' data-type='int' data-ref="104errpipe_read">errpipe_read</dfn>, <em>int</em> <dfn class="local col5 decl" id="105errpipe_write" title='errpipe_write' data-type='int' data-ref="105errpipe_write">errpipe_write</dfn>,</td></tr>
<tr><th id="399">399</th><td>           <em>int</em> <dfn class="local col6 decl" id="106close_fds" title='close_fds' data-type='int' data-ref="106close_fds">close_fds</dfn>, <em>int</em> <dfn class="local col7 decl" id="107restore_signals" title='restore_signals' data-type='int' data-ref="107restore_signals">restore_signals</dfn>,</td></tr>
<tr><th id="400">400</th><td>           <em>int</em> <dfn class="local col8 decl" id="108call_setsid" title='call_setsid' data-type='int' data-ref="108call_setsid">call_setsid</dfn>,</td></tr>
<tr><th id="401">401</th><td>           <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col9 decl" id="109py_fds_to_keep" title='py_fds_to_keep' data-type='PyObject *' data-ref="109py_fds_to_keep">py_fds_to_keep</dfn>,</td></tr>
<tr><th id="402">402</th><td>           <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col0 decl" id="110preexec_fn" title='preexec_fn' data-type='PyObject *' data-ref="110preexec_fn">preexec_fn</dfn>,</td></tr>
<tr><th id="403">403</th><td>           <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col1 decl" id="111preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-type='PyObject *' data-ref="111preexec_fn_args_tuple">preexec_fn_args_tuple</dfn>)</td></tr>
<tr><th id="404">404</th><td>{</td></tr>
<tr><th id="405">405</th><td>    <em>int</em> <dfn class="local col2 decl" id="112i" title='i' data-type='int' data-ref="112i">i</dfn>, <dfn class="local col3 decl" id="113saved_errno" title='saved_errno' data-type='int' data-ref="113saved_errno">saved_errno</dfn>, <dfn class="local col4 decl" id="114reached_preexec" title='reached_preexec' data-type='int' data-ref="114reached_preexec">reached_preexec</dfn> = <var>0</var>;</td></tr>
<tr><th id="406">406</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col5 decl" id="115result" title='result' data-type='PyObject *' data-ref="115result">result</dfn>;</td></tr>
<tr><th id="407">407</th><td>    <em>const</em> <em>char</em>* <dfn class="local col6 decl" id="116err_msg" title='err_msg' data-type='const char *' data-ref="116err_msg">err_msg</dfn> = <q>""</q>;</td></tr>
<tr><th id="408">408</th><td>    <i>/* Buffer large enough to hold a hex integer.  We can't malloc. */</i></td></tr>
<tr><th id="409">409</th><td>    <em>char</em> <dfn class="local col7 decl" id="117hex_errno" title='hex_errno' data-type='char [9]' data-ref="117hex_errno">hex_errno</dfn>[<b>sizeof</b>(<a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a>)*<var>2</var>+<var>1</var>];</td></tr>
<tr><th id="410">410</th><td></td></tr>
<tr><th id="411">411</th><td>    <b>if</b> (<a class="tu ref" href="#make_inheritable" title='make_inheritable' data-use='c' data-ref="make_inheritable">make_inheritable</a>(<a class="local col9 ref" href="#109py_fds_to_keep" title='py_fds_to_keep' data-ref="109py_fds_to_keep">py_fds_to_keep</a>, <a class="local col5 ref" href="#105errpipe_write" title='errpipe_write' data-ref="105errpipe_write">errpipe_write</a>) &lt; <var>0</var>)</td></tr>
<tr><th id="412">412</th><td>        <b>goto</b> <a class="lbl" href="#118error" data-ref="118error">error</a>;</td></tr>
<tr><th id="413">413</th><td></td></tr>
<tr><th id="414">414</th><td>    <i>/* Close parent's pipe ends. */</i></td></tr>
<tr><th id="415">415</th><td>    <b>if</b> (<a class="local col9 ref" href="#99p2cwrite" title='p2cwrite' data-ref="99p2cwrite">p2cwrite</a> != -<var>1</var>)</td></tr>
<tr><th id="416">416</th><td>        <a class="macro" href="#46" title="do { if ((close(p2cwrite)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col9 ref" href="#99p2cwrite" title='p2cwrite' data-ref="99p2cwrite">p2cwrite</a>));</td></tr>
<tr><th id="417">417</th><td>    <b>if</b> (<a class="local col0 ref" href="#100c2pread" title='c2pread' data-ref="100c2pread">c2pread</a> != -<var>1</var>)</td></tr>
<tr><th id="418">418</th><td>        <a class="macro" href="#46" title="do { if ((close(c2pread)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col0 ref" href="#100c2pread" title='c2pread' data-ref="100c2pread">c2pread</a>));</td></tr>
<tr><th id="419">419</th><td>    <b>if</b> (<a class="local col2 ref" href="#102errread" title='errread' data-ref="102errread">errread</a> != -<var>1</var>)</td></tr>
<tr><th id="420">420</th><td>        <a class="macro" href="#46" title="do { if ((close(errread)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col2 ref" href="#102errread" title='errread' data-ref="102errread">errread</a>));</td></tr>
<tr><th id="421">421</th><td>    <a class="macro" href="#46" title="do { if ((close(errpipe_read)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col4 ref" href="#104errpipe_read" title='errpipe_read' data-ref="104errpipe_read">errpipe_read</a>));</td></tr>
<tr><th id="422">422</th><td></td></tr>
<tr><th id="423">423</th><td>    <i>/* When duping fds, if there arises a situation where one of the fds is</i></td></tr>
<tr><th id="424">424</th><td><i>       either 0, 1 or 2, it is possible that it is overwritten (#12607). */</i></td></tr>
<tr><th id="425">425</th><td>    <b>if</b> (<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a> == <var>0</var>)</td></tr>
<tr><th id="426">426</th><td>        <a class="macro" href="#46" title="do { if ((c2pwrite = dup(c2pwrite)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a> = <a class="ref" href="../../include/unistd.h.html#dup" title='dup' data-ref="dup">dup</a>(<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a>));</td></tr>
<tr><th id="427">427</th><td>    <b>if</b> (<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> == <var>0</var> || <a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> == <var>1</var>)</td></tr>
<tr><th id="428">428</th><td>        <a class="macro" href="#46" title="do { if ((errwrite = dup(errwrite)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> = <a class="ref" href="../../include/unistd.h.html#dup" title='dup' data-ref="dup">dup</a>(<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a>));</td></tr>
<tr><th id="429">429</th><td></td></tr>
<tr><th id="430">430</th><td>    <i>/* Dup fds for child.</i></td></tr>
<tr><th id="431">431</th><td><i>       dup2() removes the CLOEXEC flag but we must do it ourselves if dup2()</i></td></tr>
<tr><th id="432">432</th><td><i>       would be a no-op (issue #10806). */</i></td></tr>
<tr><th id="433">433</th><td>    <b>if</b> (<a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a> == <var>0</var>) {</td></tr>
<tr><th id="434">434</th><td>        <b>if</b> (<a class="ref" href="../Include/fileutils.h.html#_Py_set_inheritable" title='_Py_set_inheritable' data-ref="_Py_set_inheritable">_Py_set_inheritable</a>(<a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a>, <var>1</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) &lt; <var>0</var>)</td></tr>
<tr><th id="435">435</th><td>            <b>goto</b> <a class="lbl" href="#118error" data-ref="118error">error</a>;</td></tr>
<tr><th id="436">436</th><td>    }</td></tr>
<tr><th id="437">437</th><td>    <b>else</b> <b>if</b> (<a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a> != -<var>1</var>)</td></tr>
<tr><th id="438">438</th><td>        <a class="macro" href="#46" title="do { if ((dup2(p2cread, 0)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#dup2" title='dup2' data-ref="dup2">dup2</a>(<a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a>, <var>0</var>));  <i>/* stdin */</i></td></tr>
<tr><th id="439">439</th><td></td></tr>
<tr><th id="440">440</th><td>    <b>if</b> (<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a> == <var>1</var>) {</td></tr>
<tr><th id="441">441</th><td>        <b>if</b> (<a class="ref" href="../Include/fileutils.h.html#_Py_set_inheritable" title='_Py_set_inheritable' data-ref="_Py_set_inheritable">_Py_set_inheritable</a>(<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a>, <var>1</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) &lt; <var>0</var>)</td></tr>
<tr><th id="442">442</th><td>            <b>goto</b> <a class="lbl" href="#118error" data-ref="118error">error</a>;</td></tr>
<tr><th id="443">443</th><td>    }</td></tr>
<tr><th id="444">444</th><td>    <b>else</b> <b>if</b> (<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a> != -<var>1</var>)</td></tr>
<tr><th id="445">445</th><td>        <a class="macro" href="#46" title="do { if ((dup2(c2pwrite, 1)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#dup2" title='dup2' data-ref="dup2">dup2</a>(<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a>, <var>1</var>));  <i>/* stdout */</i></td></tr>
<tr><th id="446">446</th><td></td></tr>
<tr><th id="447">447</th><td>    <b>if</b> (<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> == <var>2</var>) {</td></tr>
<tr><th id="448">448</th><td>        <b>if</b> (<a class="ref" href="../Include/fileutils.h.html#_Py_set_inheritable" title='_Py_set_inheritable' data-ref="_Py_set_inheritable">_Py_set_inheritable</a>(<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a>, <var>1</var>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) &lt; <var>0</var>)</td></tr>
<tr><th id="449">449</th><td>            <b>goto</b> <a class="lbl" href="#118error" data-ref="118error">error</a>;</td></tr>
<tr><th id="450">450</th><td>    }</td></tr>
<tr><th id="451">451</th><td>    <b>else</b> <b>if</b> (<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> != -<var>1</var>)</td></tr>
<tr><th id="452">452</th><td>        <a class="macro" href="#46" title="do { if ((dup2(errwrite, 2)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#dup2" title='dup2' data-ref="dup2">dup2</a>(<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a>, <var>2</var>));  <i>/* stderr */</i></td></tr>
<tr><th id="453">453</th><td></td></tr>
<tr><th id="454">454</th><td>    <i>/* Close pipe fds.  Make sure we don't close the same fd more than */</i></td></tr>
<tr><th id="455">455</th><td>    <i>/* once, or standard fds. */</i></td></tr>
<tr><th id="456">456</th><td>    <b>if</b> (<a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a> &gt; <var>2</var>)</td></tr>
<tr><th id="457">457</th><td>        <a class="macro" href="#46" title="do { if ((close(p2cread)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a>));</td></tr>
<tr><th id="458">458</th><td>    <b>if</b> (<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a> &gt; <var>2</var> &amp;&amp; <a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a> != <a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a>)</td></tr>
<tr><th id="459">459</th><td>        <a class="macro" href="#46" title="do { if ((close(c2pwrite)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a>));</td></tr>
<tr><th id="460">460</th><td>    <b>if</b> (<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> != <a class="local col1 ref" href="#101c2pwrite" title='c2pwrite' data-ref="101c2pwrite">c2pwrite</a> &amp;&amp; <a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> != <a class="local col8 ref" href="#98p2cread" title='p2cread' data-ref="98p2cread">p2cread</a> &amp;&amp; <a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a> &gt; <var>2</var>)</td></tr>
<tr><th id="461">461</th><td>        <a class="macro" href="#46" title="do { if ((close(errwrite)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#close" title='close' data-ref="close">close</a>(<a class="local col3 ref" href="#103errwrite" title='errwrite' data-ref="103errwrite">errwrite</a>));</td></tr>
<tr><th id="462">462</th><td></td></tr>
<tr><th id="463">463</th><td>    <b>if</b> (<a class="local col7 ref" href="#97cwd" title='cwd' data-ref="97cwd">cwd</a>)</td></tr>
<tr><th id="464">464</th><td>        <a class="macro" href="#46" title="do { if ((chdir(cwd)) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#chdir" title='chdir' data-ref="chdir">chdir</a>(<a class="local col7 ref" href="#97cwd" title='cwd' data-ref="97cwd">cwd</a>));</td></tr>
<tr><th id="465">465</th><td></td></tr>
<tr><th id="466">466</th><td>    <b>if</b> (<a class="local col7 ref" href="#107restore_signals" title='restore_signals' data-ref="107restore_signals">restore_signals</a>)</td></tr>
<tr><th id="467">467</th><td>        <a class="ref" href="../Include/pylifecycle.h.html#_Py_RestoreSignals" title='_Py_RestoreSignals' data-ref="_Py_RestoreSignals">_Py_RestoreSignals</a>();</td></tr>
<tr><th id="468">468</th><td></td></tr>
<tr><th id="469">469</th><td><u>#<span data-ppcond="469">ifdef</span> <a class="macro" href="../pyconfig.h.html#837" data-ref="_M/HAVE_SETSID">HAVE_SETSID</a></u></td></tr>
<tr><th id="470">470</th><td>    <b>if</b> (<a class="local col8 ref" href="#108call_setsid" title='call_setsid' data-ref="108call_setsid">call_setsid</a>)</td></tr>
<tr><th id="471">471</th><td>        <a class="macro" href="#46" title="do { if ((setsid()) == -1) goto error; } while (0)" data-ref="_M/POSIX_CALL">POSIX_CALL</a>(<a class="ref" href="../../include/unistd.h.html#setsid" title='setsid' data-ref="setsid">setsid</a>());</td></tr>
<tr><th id="472">472</th><td><u>#<span data-ppcond="469">endif</span></u></td></tr>
<tr><th id="473">473</th><td></td></tr>
<tr><th id="474">474</th><td>    <a class="local col4 ref" href="#114reached_preexec" title='reached_preexec' data-ref="114reached_preexec">reached_preexec</a> = <var>1</var>;</td></tr>
<tr><th id="475">475</th><td>    <b>if</b> (<a class="local col0 ref" href="#110preexec_fn" title='preexec_fn' data-ref="110preexec_fn">preexec_fn</a> != <a class="macro" href="../Include/object.h.html#910" title="(&amp;_Py_NoneStruct)" data-ref="_M/Py_None">Py_None</a> &amp;&amp; <a class="local col1 ref" href="#111preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-ref="111preexec_fn_args_tuple">preexec_fn_args_tuple</a>) {</td></tr>
<tr><th id="476">476</th><td>        <i>/* This is where the user has asked us to deadlock their program. */</i></td></tr>
<tr><th id="477">477</th><td>        <a class="local col5 ref" href="#115result" title='result' data-ref="115result">result</a> = <a class="ref" href="../Include/abstract.h.html#PyObject_Call" title='PyObject_Call' data-ref="PyObject_Call">PyObject_Call</a>(<a class="local col0 ref" href="#110preexec_fn" title='preexec_fn' data-ref="110preexec_fn">preexec_fn</a>, <a class="local col1 ref" href="#111preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-ref="111preexec_fn_args_tuple">preexec_fn_args_tuple</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="478">478</th><td>        <b>if</b> (<a class="local col5 ref" href="#115result" title='result' data-ref="115result">result</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="479">479</th><td>            <i>/* Stringifying the exception or traceback would involve</i></td></tr>
<tr><th id="480">480</th><td><i>             * memory allocation and thus potential for deadlock.</i></td></tr>
<tr><th id="481">481</th><td><i>             * We've already faced potential deadlock by calling back</i></td></tr>
<tr><th id="482">482</th><td><i>             * into Python in the first place, so it probably doesn't</i></td></tr>
<tr><th id="483">483</th><td><i>             * matter but we avoid it to minimize the possibility. */</i></td></tr>
<tr><th id="484">484</th><td>            <a class="local col6 ref" href="#116err_msg" title='err_msg' data-ref="116err_msg">err_msg</a> = <q>"Exception occurred in preexec_fn."</q>;</td></tr>
<tr><th id="485">485</th><td>            <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> = <var>0</var>;  <i>/* We don't want to report an OSError. */</i></td></tr>
<tr><th id="486">486</th><td>            <b>goto</b> <a class="lbl" href="#118error" data-ref="118error">error</a>;</td></tr>
<tr><th id="487">487</th><td>        }</td></tr>
<tr><th id="488">488</th><td>        <i>/* Py_DECREF(result); - We're about to exec so why bother? */</i></td></tr>
<tr><th id="489">489</th><td>    }</td></tr>
<tr><th id="490">490</th><td></td></tr>
<tr><th id="491">491</th><td>    <i>/* close FDs after executing preexec_fn, which might open FDs */</i></td></tr>
<tr><th id="492">492</th><td>    <b>if</b> (<a class="local col6 ref" href="#106close_fds" title='close_fds' data-ref="106close_fds">close_fds</a>) {</td></tr>
<tr><th id="493">493</th><td>        <i>/* TODO HP-UX could use pstat_getproc() if anyone cares about it. */</i></td></tr>
<tr><th id="494">494</th><td>        <a class="macro" href="#305" title="_close_open_fds_safe" data-ref="_M/_close_open_fds">_close_open_fds</a>(<var>3</var>, <a class="local col9 ref" href="#109py_fds_to_keep" title='py_fds_to_keep' data-ref="109py_fds_to_keep">py_fds_to_keep</a>);</td></tr>
<tr><th id="495">495</th><td>    }</td></tr>
<tr><th id="496">496</th><td></td></tr>
<tr><th id="497">497</th><td>    <i>/* This loop matches the Lib/os.py _execvpe()'s PATH search when */</i></td></tr>
<tr><th id="498">498</th><td>    <i>/* given the executable_list generated by Lib/subprocess.py.     */</i></td></tr>
<tr><th id="499">499</th><td>    <a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a> = <var>0</var>;</td></tr>
<tr><th id="500">500</th><td>    <b>for</b> (<a class="local col2 ref" href="#112i" title='i' data-ref="112i">i</a> = <var>0</var>; <a class="local col4 ref" href="#94exec_array" title='exec_array' data-ref="94exec_array">exec_array</a>[<a class="local col2 ref" href="#112i" title='i' data-ref="112i">i</a>] != <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>; ++<a class="local col2 ref" href="#112i" title='i' data-ref="112i">i</a>) {</td></tr>
<tr><th id="501">501</th><td>        <em>const</em> <em>char</em> *<dfn class="local col9 decl" id="119executable" title='executable' data-type='const char *' data-ref="119executable">executable</dfn> = <a class="local col4 ref" href="#94exec_array" title='exec_array' data-ref="94exec_array">exec_array</a>[<a class="local col2 ref" href="#112i" title='i' data-ref="112i">i</a>];</td></tr>
<tr><th id="502">502</th><td>        <b>if</b> (<a class="local col6 ref" href="#96envp" title='envp' data-ref="96envp">envp</a>) {</td></tr>
<tr><th id="503">503</th><td>            <a class="ref" href="../../include/unistd.h.html#execve" title='execve' data-ref="execve">execve</a>(<a class="local col9 ref" href="#119executable" title='executable' data-ref="119executable">executable</a>, <a class="local col5 ref" href="#95argv" title='argv' data-ref="95argv">argv</a>, <a class="local col6 ref" href="#96envp" title='envp' data-ref="96envp">envp</a>);</td></tr>
<tr><th id="504">504</th><td>        } <b>else</b> {</td></tr>
<tr><th id="505">505</th><td>            <a class="ref" href="../../include/unistd.h.html#execv" title='execv' data-ref="execv">execv</a>(<a class="local col9 ref" href="#119executable" title='executable' data-ref="119executable">executable</a>, <a class="local col5 ref" href="#95argv" title='argv' data-ref="95argv">argv</a>);</td></tr>
<tr><th id="506">506</th><td>        }</td></tr>
<tr><th id="507">507</th><td>        <b>if</b> (<a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> != <a class="macro" href="../../include/asm-generic/errno-base.h.html#5" title="2" data-ref="_M/ENOENT">ENOENT</a> &amp;&amp; <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> != <a class="macro" href="../../include/asm-generic/errno-base.h.html#23" title="20" data-ref="_M/ENOTDIR">ENOTDIR</a> &amp;&amp; <a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a> == <var>0</var>) {</td></tr>
<tr><th id="508">508</th><td>            <a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a> = <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a>;</td></tr>
<tr><th id="509">509</th><td>        }</td></tr>
<tr><th id="510">510</th><td>    }</td></tr>
<tr><th id="511">511</th><td>    <i>/* Report the first exec error, not the last. */</i></td></tr>
<tr><th id="512">512</th><td>    <b>if</b> (<a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a>)</td></tr>
<tr><th id="513">513</th><td>        <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a> = <a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a>;</td></tr>
<tr><th id="514">514</th><td></td></tr>
<tr><th id="515">515</th><td><dfn class="lbl" id="118error" data-ref="118error">error</dfn>:</td></tr>
<tr><th id="516">516</th><td>    <a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a> = <a class="macro" href="../../include/x86_64-linux-gnu/bits/errno.h.html#54" title="(*__errno_location ())" data-ref="_M/errno">errno</a>;</td></tr>
<tr><th id="517">517</th><td>    <i>/* Report the posix error to our parent process. */</i></td></tr>
<tr><th id="518">518</th><td>    <i>/* We ignore all write() return values as the total size of our writes is</i></td></tr>
<tr><th id="519">519</th><td><i>       less than PIPEBUF and we cannot do anything about an error anyways.</i></td></tr>
<tr><th id="520">520</th><td><i>       Use _Py_write_noraise() to retry write() if it is interrupted by a</i></td></tr>
<tr><th id="521">521</th><td><i>       signal (fails with EINTR). */</i></td></tr>
<tr><th id="522">522</th><td>    <b>if</b> (<a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a>) {</td></tr>
<tr><th id="523">523</th><td>        <em>char</em> *<dfn class="local col0 decl" id="120cur" title='cur' data-type='char *' data-ref="120cur">cur</dfn>;</td></tr>
<tr><th id="524">524</th><td>        <a class="ref" href="../Include/fileutils.h.html#_Py_write_noraise" title='_Py_write_noraise' data-ref="_Py_write_noraise">_Py_write_noraise</a>(<a class="local col5 ref" href="#105errpipe_write" title='errpipe_write' data-ref="105errpipe_write">errpipe_write</a>, <q>"OSError:"</q>, <var>8</var>);</td></tr>
<tr><th id="525">525</th><td>        <a class="local col0 ref" href="#120cur" title='cur' data-ref="120cur">cur</a> = <a class="local col7 ref" href="#117hex_errno" title='hex_errno' data-ref="117hex_errno">hex_errno</a> + <b>sizeof</b>(<a class="local col7 ref" href="#117hex_errno" title='hex_errno' data-ref="117hex_errno">hex_errno</a>);</td></tr>
<tr><th id="526">526</th><td>        <b>while</b> (<a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a> != <var>0</var> &amp;&amp; <a class="local col0 ref" href="#120cur" title='cur' data-ref="120cur">cur</a> != <a class="local col7 ref" href="#117hex_errno" title='hex_errno' data-ref="117hex_errno">hex_errno</a>) {</td></tr>
<tr><th id="527">527</th><td>            *--<a class="local col0 ref" href="#120cur" title='cur' data-ref="120cur">cur</a> = <a class="ref" href="../Include/codecs.h.html#Py_hexdigits" title='Py_hexdigits' data-ref="Py_hexdigits">Py_hexdigits</a>[<a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a> % <var>16</var>];</td></tr>
<tr><th id="528">528</th><td>            <a class="local col3 ref" href="#113saved_errno" title='saved_errno' data-ref="113saved_errno">saved_errno</a> /= <var>16</var>;</td></tr>
<tr><th id="529">529</th><td>        }</td></tr>
<tr><th id="530">530</th><td>        <a class="ref" href="../Include/fileutils.h.html#_Py_write_noraise" title='_Py_write_noraise' data-ref="_Py_write_noraise">_Py_write_noraise</a>(<a class="local col5 ref" href="#105errpipe_write" title='errpipe_write' data-ref="105errpipe_write">errpipe_write</a>, <a class="local col0 ref" href="#120cur" title='cur' data-ref="120cur">cur</a>, <a class="local col7 ref" href="#117hex_errno" title='hex_errno' data-ref="117hex_errno">hex_errno</a> + <b>sizeof</b>(<a class="local col7 ref" href="#117hex_errno" title='hex_errno' data-ref="117hex_errno">hex_errno</a>) - <a class="local col0 ref" href="#120cur" title='cur' data-ref="120cur">cur</a>);</td></tr>
<tr><th id="531">531</th><td>        <a class="ref" href="../Include/fileutils.h.html#_Py_write_noraise" title='_Py_write_noraise' data-ref="_Py_write_noraise">_Py_write_noraise</a>(<a class="local col5 ref" href="#105errpipe_write" title='errpipe_write' data-ref="105errpipe_write">errpipe_write</a>, <q>":"</q>, <var>1</var>);</td></tr>
<tr><th id="532">532</th><td>        <b>if</b> (!<a class="local col4 ref" href="#114reached_preexec" title='reached_preexec' data-ref="114reached_preexec">reached_preexec</a>) {</td></tr>
<tr><th id="533">533</th><td>            <i>/* Indicate to the parent that the error happened before exec(). */</i></td></tr>
<tr><th id="534">534</th><td>            <a class="ref" href="../Include/fileutils.h.html#_Py_write_noraise" title='_Py_write_noraise' data-ref="_Py_write_noraise">_Py_write_noraise</a>(<a class="local col5 ref" href="#105errpipe_write" title='errpipe_write' data-ref="105errpipe_write">errpipe_write</a>, <q>"noexec"</q>, <var>6</var>);</td></tr>
<tr><th id="535">535</th><td>        }</td></tr>
<tr><th id="536">536</th><td>        <i>/* We can't call strerror(saved_errno).  It is not async signal safe.</i></td></tr>
<tr><th id="537">537</th><td><i>         * The parent process will look the error message up. */</i></td></tr>
<tr><th id="538">538</th><td>    } <b>else</b> {</td></tr>
<tr><th id="539">539</th><td>        <a class="ref" href="../Include/fileutils.h.html#_Py_write_noraise" title='_Py_write_noraise' data-ref="_Py_write_noraise">_Py_write_noraise</a>(<a class="local col5 ref" href="#105errpipe_write" title='errpipe_write' data-ref="105errpipe_write">errpipe_write</a>, <q>"SubprocessError:0:"</q>, <var>18</var>);</td></tr>
<tr><th id="540">540</th><td>        <a class="ref" href="../Include/fileutils.h.html#_Py_write_noraise" title='_Py_write_noraise' data-ref="_Py_write_noraise">_Py_write_noraise</a>(<a class="local col5 ref" href="#105errpipe_write" title='errpipe_write' data-ref="105errpipe_write">errpipe_write</a>, <a class="local col6 ref" href="#116err_msg" title='err_msg' data-ref="116err_msg">err_msg</a>, <a class="ref" href="../../include/string.h.html#strlen" title='strlen' data-ref="strlen">strlen</a>(<a class="local col6 ref" href="#116err_msg" title='err_msg' data-ref="116err_msg">err_msg</a>));</td></tr>
<tr><th id="541">541</th><td>    }</td></tr>
<tr><th id="542">542</th><td>}</td></tr>
<tr><th id="543">543</th><td></td></tr>
<tr><th id="544">544</th><td></td></tr>
<tr><th id="545">545</th><td><em>static</em> <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *</td></tr>
<tr><th id="546">546</th><td><dfn class="tu decl def" id="subprocess_fork_exec" title='subprocess_fork_exec' data-type='PyObject * subprocess_fork_exec(PyObject * self, PyObject * args)' data-ref="subprocess_fork_exec">subprocess_fork_exec</dfn>(<a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a>* <dfn class="local col1 decl" id="121self" title='self' data-type='PyObject *' data-ref="121self">self</dfn>, <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col2 decl" id="122args" title='args' data-type='PyObject *' data-ref="122args">args</dfn>)</td></tr>
<tr><th id="547">547</th><td>{</td></tr>
<tr><th id="548">548</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col3 decl" id="123gc_module" title='gc_module' data-type='PyObject *' data-ref="123gc_module">gc_module</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="549">549</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col4 decl" id="124executable_list" title='executable_list' data-type='PyObject *' data-ref="124executable_list">executable_list</dfn>, *<dfn class="local col5 decl" id="125py_fds_to_keep" title='py_fds_to_keep' data-type='PyObject *' data-ref="125py_fds_to_keep">py_fds_to_keep</dfn>;</td></tr>
<tr><th id="550">550</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col6 decl" id="126env_list" title='env_list' data-type='PyObject *' data-ref="126env_list">env_list</dfn>, *<dfn class="local col7 decl" id="127preexec_fn" title='preexec_fn' data-type='PyObject *' data-ref="127preexec_fn">preexec_fn</dfn>;</td></tr>
<tr><th id="551">551</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col8 decl" id="128process_args" title='process_args' data-type='PyObject *' data-ref="128process_args">process_args</dfn>, *<dfn class="local col9 decl" id="129converted_args" title='converted_args' data-type='PyObject *' data-ref="129converted_args">converted_args</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, *<dfn class="local col0 decl" id="130fast_args" title='fast_args' data-type='PyObject *' data-ref="130fast_args">fast_args</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="552">552</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col1 decl" id="131preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-type='PyObject *' data-ref="131preexec_fn_args_tuple">preexec_fn_args_tuple</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="553">553</th><td>    <em>int</em> <dfn class="local col2 decl" id="132p2cread" title='p2cread' data-type='int' data-ref="132p2cread">p2cread</dfn>, <dfn class="local col3 decl" id="133p2cwrite" title='p2cwrite' data-type='int' data-ref="133p2cwrite">p2cwrite</dfn>, <dfn class="local col4 decl" id="134c2pread" title='c2pread' data-type='int' data-ref="134c2pread">c2pread</dfn>, <dfn class="local col5 decl" id="135c2pwrite" title='c2pwrite' data-type='int' data-ref="135c2pwrite">c2pwrite</dfn>, <dfn class="local col6 decl" id="136errread" title='errread' data-type='int' data-ref="136errread">errread</dfn>, <dfn class="local col7 decl" id="137errwrite" title='errwrite' data-type='int' data-ref="137errwrite">errwrite</dfn>;</td></tr>
<tr><th id="554">554</th><td>    <em>int</em> <dfn class="local col8 decl" id="138errpipe_read" title='errpipe_read' data-type='int' data-ref="138errpipe_read">errpipe_read</dfn>, <dfn class="local col9 decl" id="139errpipe_write" title='errpipe_write' data-type='int' data-ref="139errpipe_write">errpipe_write</dfn>, <dfn class="local col0 decl" id="140close_fds" title='close_fds' data-type='int' data-ref="140close_fds">close_fds</dfn>, <dfn class="local col1 decl" id="141restore_signals" title='restore_signals' data-type='int' data-ref="141restore_signals">restore_signals</dfn>;</td></tr>
<tr><th id="555">555</th><td>    <em>int</em> <dfn class="local col2 decl" id="142call_setsid" title='call_setsid' data-type='int' data-ref="142call_setsid">call_setsid</dfn>;</td></tr>
<tr><th id="556">556</th><td>    <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col3 decl" id="143cwd_obj" title='cwd_obj' data-type='PyObject *' data-ref="143cwd_obj">cwd_obj</dfn>, *<dfn class="local col4 decl" id="144cwd_obj2" title='cwd_obj2' data-type='PyObject *' data-ref="144cwd_obj2">cwd_obj2</dfn>;</td></tr>
<tr><th id="557">557</th><td>    <em>const</em> <em>char</em> *<dfn class="local col5 decl" id="145cwd" title='cwd' data-type='const char *' data-ref="145cwd">cwd</dfn>;</td></tr>
<tr><th id="558">558</th><td>    <a class="typedef" href="../../include/x86_64-linux-gnu/sys/types.h.html#pid_t" title='pid_t' data-type='__pid_t' data-ref="pid_t">pid_t</a> <dfn class="local col6 decl" id="146pid" title='pid' data-type='pid_t' data-ref="146pid">pid</dfn>;</td></tr>
<tr><th id="559">559</th><td>    <em>int</em> <dfn class="local col7 decl" id="147need_to_reenable_gc" title='need_to_reenable_gc' data-type='int' data-ref="147need_to_reenable_gc">need_to_reenable_gc</dfn> = <var>0</var>;</td></tr>
<tr><th id="560">560</th><td>    <em>char</em> *<em>const</em> *<dfn class="local col8 decl" id="148exec_array" title='exec_array' data-type='char *const *' data-ref="148exec_array">exec_array</dfn>, *<em>const</em> *<dfn class="local col9 decl" id="149argv" title='argv' data-type='char *const *' data-ref="149argv">argv</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, *<em>const</em> *<dfn class="local col0 decl" id="150envp" title='envp' data-type='char *const *' data-ref="150envp">envp</dfn> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="561">561</th><td>    <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col1 decl" id="151arg_num" title='arg_num' data-type='Py_ssize_t' data-ref="151arg_num">arg_num</dfn>;</td></tr>
<tr><th id="562">562</th><td>    <em>int</em> <dfn class="local col2 decl" id="152need_after_fork" title='need_after_fork' data-type='int' data-ref="152need_after_fork">need_after_fork</dfn> = <var>0</var>;</td></tr>
<tr><th id="563">563</th><td></td></tr>
<tr><th id="564">564</th><td>    <b>if</b> (!<a class="ref" href="../Include/modsupport.h.html#PyArg_ParseTuple" title='PyArg_ParseTuple' data-ref="PyArg_ParseTuple">PyArg_ParseTuple</a>(</td></tr>
<tr><th id="565">565</th><td>            <a class="local col2 ref" href="#122args" title='args' data-ref="122args">args</a>, <q>"OOpO!OOiiiiiiiiiiO:fork_exec"</q>,</td></tr>
<tr><th id="566">566</th><td>            &amp;<a class="local col8 ref" href="#128process_args" title='process_args' data-ref="128process_args">process_args</a>, &amp;<a class="local col4 ref" href="#124executable_list" title='executable_list' data-ref="124executable_list">executable_list</a>,</td></tr>
<tr><th id="567">567</th><td>            &amp;<a class="local col0 ref" href="#140close_fds" title='close_fds' data-ref="140close_fds">close_fds</a>, &amp;<a class="ref" href="../Include/tupleobject.h.html#PyTuple_Type" title='PyTuple_Type' data-ref="PyTuple_Type">PyTuple_Type</a>, &amp;<a class="local col5 ref" href="#125py_fds_to_keep" title='py_fds_to_keep' data-ref="125py_fds_to_keep">py_fds_to_keep</a>,</td></tr>
<tr><th id="568">568</th><td>            &amp;<a class="local col3 ref" href="#143cwd_obj" title='cwd_obj' data-ref="143cwd_obj">cwd_obj</a>, &amp;<a class="local col6 ref" href="#126env_list" title='env_list' data-ref="126env_list">env_list</a>,</td></tr>
<tr><th id="569">569</th><td>            &amp;<a class="local col2 ref" href="#132p2cread" title='p2cread' data-ref="132p2cread">p2cread</a>, &amp;<a class="local col3 ref" href="#133p2cwrite" title='p2cwrite' data-ref="133p2cwrite">p2cwrite</a>, &amp;<a class="local col4 ref" href="#134c2pread" title='c2pread' data-ref="134c2pread">c2pread</a>, &amp;<a class="local col5 ref" href="#135c2pwrite" title='c2pwrite' data-ref="135c2pwrite">c2pwrite</a>,</td></tr>
<tr><th id="570">570</th><td>            &amp;<a class="local col6 ref" href="#136errread" title='errread' data-ref="136errread">errread</a>, &amp;<a class="local col7 ref" href="#137errwrite" title='errwrite' data-ref="137errwrite">errwrite</a>, &amp;<a class="local col8 ref" href="#138errpipe_read" title='errpipe_read' data-ref="138errpipe_read">errpipe_read</a>, &amp;<a class="local col9 ref" href="#139errpipe_write" title='errpipe_write' data-ref="139errpipe_write">errpipe_write</a>,</td></tr>
<tr><th id="571">571</th><td>            &amp;<a class="local col1 ref" href="#141restore_signals" title='restore_signals' data-ref="141restore_signals">restore_signals</a>, &amp;<a class="local col2 ref" href="#142call_setsid" title='call_setsid' data-ref="142call_setsid">call_setsid</a>, &amp;<a class="local col7 ref" href="#127preexec_fn" title='preexec_fn' data-ref="127preexec_fn">preexec_fn</a>))</td></tr>
<tr><th id="572">572</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="573">573</th><td></td></tr>
<tr><th id="574">574</th><td>    <b>if</b> (<a class="local col0 ref" href="#140close_fds" title='close_fds' data-ref="140close_fds">close_fds</a> &amp;&amp; <a class="local col9 ref" href="#139errpipe_write" title='errpipe_write' data-ref="139errpipe_write">errpipe_write</a> &lt; <var>3</var>) {  <i>/* precondition */</i></td></tr>
<tr><th id="575">575</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_ValueError" title='PyExc_ValueError' data-ref="PyExc_ValueError">PyExc_ValueError</a>, <q>"errpipe_write must be &gt;= 3"</q>);</td></tr>
<tr><th id="576">576</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="577">577</th><td>    }</td></tr>
<tr><th id="578">578</th><td>    <b>if</b> (<a class="tu ref" href="#_sanity_check_python_fd_sequence" title='_sanity_check_python_fd_sequence' data-use='c' data-ref="_sanity_check_python_fd_sequence">_sanity_check_python_fd_sequence</a>(<a class="local col5 ref" href="#125py_fds_to_keep" title='py_fds_to_keep' data-ref="125py_fds_to_keep">py_fds_to_keep</a>)) {</td></tr>
<tr><th id="579">579</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_ValueError" title='PyExc_ValueError' data-ref="PyExc_ValueError">PyExc_ValueError</a>, <q>"bad value(s) in fds_to_keep"</q>);</td></tr>
<tr><th id="580">580</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="581">581</th><td>    }</td></tr>
<tr><th id="582">582</th><td></td></tr>
<tr><th id="583">583</th><td>    <i>/* We need to call gc.disable() when we'll be calling preexec_fn */</i></td></tr>
<tr><th id="584">584</th><td>    <b>if</b> (<a class="local col7 ref" href="#127preexec_fn" title='preexec_fn' data-ref="127preexec_fn">preexec_fn</a> != <a class="macro" href="../Include/object.h.html#910" title="(&amp;_Py_NoneStruct)" data-ref="_M/Py_None">Py_None</a>) {</td></tr>
<tr><th id="585">585</th><td>        <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col3 decl" id="153result" title='result' data-type='PyObject *' data-ref="153result">result</dfn>;</td></tr>
<tr><th id="586">586</th><td>        <a class="macro" href="../Include/object.h.html#150" title="static _Py_Identifier PyId_isenabled = { .next = ((void*)0), .string = &quot;isenabled&quot;, .object = ((void*)0) }" data-ref="_M/_Py_IDENTIFIER">_Py_IDENTIFIER</a>(isenabled);</td></tr>
<tr><th id="587">587</th><td>        <a class="macro" href="../Include/object.h.html#150" title="static _Py_Identifier PyId_disable = { .next = ((void*)0), .string = &quot;disable&quot;, .object = ((void*)0) }" data-ref="_M/_Py_IDENTIFIER">_Py_IDENTIFIER</a>(disable);</td></tr>
<tr><th id="588">588</th><td></td></tr>
<tr><th id="589">589</th><td>        <a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a> = <a class="ref" href="../Include/import.h.html#PyImport_ImportModule" title='PyImport_ImportModule' data-ref="PyImport_ImportModule">PyImport_ImportModule</a>(<q>"gc"</q>);</td></tr>
<tr><th id="590">590</th><td>        <b>if</b> (<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="591">591</th><td>            <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="592">592</th><td>        <a class="local col3 ref" href="#153result" title='result' data-ref="153result">result</a> = <a class="ref" href="../Include/abstract.h.html#_PyObject_CallMethodId" title='_PyObject_CallMethodId' data-ref="_PyObject_CallMethodId">_PyObject_CallMethodId</a>(<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>, &amp;<a class="local col4 ref" href="#586" title='PyId_isenabled' data-ref="154PyId_isenabled">PyId_isenabled</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="593">593</th><td>        <b>if</b> (<a class="local col3 ref" href="#153result" title='result' data-ref="153result">result</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="594">594</th><td>            <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(gc_module); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 594, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>);</td></tr>
<tr><th id="595">595</th><td>            <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="596">596</th><td>        }</td></tr>
<tr><th id="597">597</th><td>        <a class="local col7 ref" href="#147need_to_reenable_gc" title='need_to_reenable_gc' data-ref="147need_to_reenable_gc">need_to_reenable_gc</a> = <a class="ref" href="../Include/object.h.html#PyObject_IsTrue" title='PyObject_IsTrue' data-ref="PyObject_IsTrue">PyObject_IsTrue</a>(<a class="local col3 ref" href="#153result" title='result' data-ref="153result">result</a>);</td></tr>
<tr><th id="598">598</th><td>        <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(result); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 598, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col3 ref" href="#153result" title='result' data-ref="153result">result</a>);</td></tr>
<tr><th id="599">599</th><td>        <b>if</b> (<a class="local col7 ref" href="#147need_to_reenable_gc" title='need_to_reenable_gc' data-ref="147need_to_reenable_gc">need_to_reenable_gc</a> == -<var>1</var>) {</td></tr>
<tr><th id="600">600</th><td>            <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(gc_module); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 600, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>);</td></tr>
<tr><th id="601">601</th><td>            <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="602">602</th><td>        }</td></tr>
<tr><th id="603">603</th><td>        <a class="local col3 ref" href="#153result" title='result' data-ref="153result">result</a> = <a class="ref" href="../Include/abstract.h.html#_PyObject_CallMethodId" title='_PyObject_CallMethodId' data-ref="_PyObject_CallMethodId">_PyObject_CallMethodId</a>(<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>, &amp;<a class="local col5 ref" href="#587" title='PyId_disable' data-ref="155PyId_disable">PyId_disable</a>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>);</td></tr>
<tr><th id="604">604</th><td>        <b>if</b> (<a class="local col3 ref" href="#153result" title='result' data-ref="153result">result</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>) {</td></tr>
<tr><th id="605">605</th><td>            <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(gc_module); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 605, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>);</td></tr>
<tr><th id="606">606</th><td>            <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="607">607</th><td>        }</td></tr>
<tr><th id="608">608</th><td>        <a class="macro" href="../Include/object.h.html#787" title="do { PyObject *_py_decref_tmp = (PyObject *)(result); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 608, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0)" data-ref="_M/Py_DECREF">Py_DECREF</a>(<a class="local col3 ref" href="#153result" title='result' data-ref="153result">result</a>);</td></tr>
<tr><th id="609">609</th><td>    }</td></tr>
<tr><th id="610">610</th><td></td></tr>
<tr><th id="611">611</th><td>    <a class="local col8 ref" href="#148exec_array" title='exec_array' data-ref="148exec_array">exec_array</a> = <a class="ref" href="../Include/abstract.h.html#_PySequence_BytesToCharpArray" title='_PySequence_BytesToCharpArray' data-ref="_PySequence_BytesToCharpArray">_PySequence_BytesToCharpArray</a>(<a class="local col4 ref" href="#124executable_list" title='executable_list' data-ref="124executable_list">executable_list</a>);</td></tr>
<tr><th id="612">612</th><td>    <b>if</b> (!<a class="local col8 ref" href="#148exec_array" title='exec_array' data-ref="148exec_array">exec_array</a>)</td></tr>
<tr><th id="613">613</th><td>        <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="614">614</th><td></td></tr>
<tr><th id="615">615</th><td>    <i>/* Convert args and env into appropriate arguments for exec() */</i></td></tr>
<tr><th id="616">616</th><td>    <i>/* These conversions are done in the parent process to avoid allocating</i></td></tr>
<tr><th id="617">617</th><td><i>       or freeing memory in the child process. */</i></td></tr>
<tr><th id="618">618</th><td>    <b>if</b> (<a class="local col8 ref" href="#128process_args" title='process_args' data-ref="128process_args">process_args</a> != <a class="macro" href="../Include/object.h.html#910" title="(&amp;_Py_NoneStruct)" data-ref="_M/Py_None">Py_None</a>) {</td></tr>
<tr><th id="619">619</th><td>        <a class="typedef" href="../Include/pyport.h.html#Py_ssize_t" title='Py_ssize_t' data-type='ssize_t' data-ref="Py_ssize_t">Py_ssize_t</a> <dfn class="local col7 decl" id="157num_args" title='num_args' data-type='Py_ssize_t' data-ref="157num_args">num_args</dfn>;</td></tr>
<tr><th id="620">620</th><td>        <i>/* Equivalent to:  */</i></td></tr>
<tr><th id="621">621</th><td>        <i>/*  tuple(PyUnicode_FSConverter(arg) for arg in process_args)  */</i></td></tr>
<tr><th id="622">622</th><td>        <a class="local col0 ref" href="#130fast_args" title='fast_args' data-ref="130fast_args">fast_args</a> = <a class="ref" href="../Include/abstract.h.html#PySequence_Fast" title='PySequence_Fast' data-ref="PySequence_Fast">PySequence_Fast</a>(<a class="local col8 ref" href="#128process_args" title='process_args' data-ref="128process_args">process_args</a>, <q>"argv must be a tuple"</q>);</td></tr>
<tr><th id="623">623</th><td>        <b>if</b> (<a class="local col0 ref" href="#130fast_args" title='fast_args' data-ref="130fast_args">fast_args</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="624">624</th><td>            <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="625">625</th><td>        <a class="local col7 ref" href="#157num_args" title='num_args' data-ref="157num_args">num_args</a> = <a class="macro" href="../Include/abstract.h.html#913" title="(((((((PyObject*)(fast_args))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0) ? (((((((((PyObject*)(fast_args))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(fast_args)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 625, __PRETTY_FUNCTION__)),(((PyVarObject*)(fast_args))-&gt;ob_size)) : (((((((((PyObject*)(fast_args))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 26))) != 0)) ? (void) (0) : __assert_fail (&quot;PyTuple_Check(fast_args)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 625, __PRETTY_FUNCTION__)),(((PyVarObject*)(fast_args))-&gt;ob_size)))" data-ref="_M/PySequence_Fast_GET_SIZE">PySequence_Fast_GET_SIZE</a>(<a class="local col0 ref" href="#130fast_args" title='fast_args' data-ref="130fast_args">fast_args</a>);</td></tr>
<tr><th id="626">626</th><td>        <a class="local col9 ref" href="#129converted_args" title='converted_args' data-ref="129converted_args">converted_args</a> = <a class="ref" href="../Include/tupleobject.h.html#PyTuple_New" title='PyTuple_New' data-ref="PyTuple_New">PyTuple_New</a>(<a class="local col7 ref" href="#157num_args" title='num_args' data-ref="157num_args">num_args</a>);</td></tr>
<tr><th id="627">627</th><td>        <b>if</b> (<a class="local col9 ref" href="#129converted_args" title='converted_args' data-ref="129converted_args">converted_args</a> == <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>)</td></tr>
<tr><th id="628">628</th><td>            <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="629">629</th><td>        <b>for</b> (<a class="local col1 ref" href="#151arg_num" title='arg_num' data-ref="151arg_num">arg_num</a> = <var>0</var>; <a class="local col1 ref" href="#151arg_num" title='arg_num' data-ref="151arg_num">arg_num</a> &lt; <a class="local col7 ref" href="#157num_args" title='num_args' data-ref="157num_args">num_args</a>; ++<a class="local col1 ref" href="#151arg_num" title='arg_num' data-ref="151arg_num">arg_num</a>) {</td></tr>
<tr><th id="630">630</th><td>            <a class="typedef" href="../Include/object.h.html#PyObject" title='PyObject' data-type='struct _object' data-ref="PyObject">PyObject</a> *<dfn class="local col8 decl" id="158borrowed_arg" title='borrowed_arg' data-type='PyObject *' data-ref="158borrowed_arg">borrowed_arg</dfn>, *<dfn class="local col9 decl" id="159converted_arg" title='converted_arg' data-type='PyObject *' data-ref="159converted_arg">converted_arg</dfn>;</td></tr>
<tr><th id="631">631</th><td>            <b>if</b> (<a class="macro" href="../Include/abstract.h.html#913" title="(((((((PyObject*)(fast_args))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0) ? (((((((((PyObject*)(fast_args))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0)) ? (void) (0) : __assert_fail (&quot;PyList_Check(fast_args)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 631, __PRETTY_FUNCTION__)),(((PyVarObject*)(fast_args))-&gt;ob_size)) : (((((((((PyObject*)(fast_args))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 26))) != 0)) ? (void) (0) : __assert_fail (&quot;PyTuple_Check(fast_args)&quot;, &quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 631, __PRETTY_FUNCTION__)),(((PyVarObject*)(fast_args))-&gt;ob_size)))" data-ref="_M/PySequence_Fast_GET_SIZE">PySequence_Fast_GET_SIZE</a>(<a class="local col0 ref" href="#130fast_args" title='fast_args' data-ref="130fast_args">fast_args</a>) != <a class="local col7 ref" href="#157num_args" title='num_args' data-ref="157num_args">num_args</a>) {</td></tr>
<tr><th id="632">632</th><td>                <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetString" title='PyErr_SetString' data-ref="PyErr_SetString">PyErr_SetString</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_RuntimeError" title='PyExc_RuntimeError' data-ref="PyExc_RuntimeError">PyExc_RuntimeError</a>, <q>"args changed during iteration"</q>);</td></tr>
<tr><th id="633">633</th><td>                <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="634">634</th><td>            }</td></tr>
<tr><th id="635">635</th><td>            <a class="local col8 ref" href="#158borrowed_arg" title='borrowed_arg' data-ref="158borrowed_arg">borrowed_arg</a> = <a class="macro" href="../Include/abstract.h.html#918" title="(((((((PyObject*)(fast_args))-&gt;ob_type))-&gt;tp_flags &amp; ((1UL &lt;&lt; 25))) != 0) ? (((PyListObject *)(fast_args))-&gt;ob_item[arg_num]) : (((PyTupleObject *)(fast_args))-&gt;ob_item[arg_num]))" data-ref="_M/PySequence_Fast_GET_ITEM">PySequence_Fast_GET_ITEM</a>(<a class="local col0 ref" href="#130fast_args" title='fast_args' data-ref="130fast_args">fast_args</a>, <a class="local col1 ref" href="#151arg_num" title='arg_num' data-ref="151arg_num">arg_num</a>);</td></tr>
<tr><th id="636">636</th><td>            <b>if</b> (<a class="ref" href="../Include/unicodeobject.h.html#PyUnicode_FSConverter" title='PyUnicode_FSConverter' data-ref="PyUnicode_FSConverter">PyUnicode_FSConverter</a>(<a class="local col8 ref" href="#158borrowed_arg" title='borrowed_arg' data-ref="158borrowed_arg">borrowed_arg</a>, &amp;<a class="local col9 ref" href="#159converted_arg" title='converted_arg' data-ref="159converted_arg">converted_arg</a>) == <var>0</var>)</td></tr>
<tr><th id="637">637</th><td>                <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="638">638</th><td>            <a class="macro" href="../Include/tupleobject.h.html#62" title="(((PyTupleObject *)(converted_args))-&gt;ob_item[arg_num] = converted_arg)" data-ref="_M/PyTuple_SET_ITEM">PyTuple_SET_ITEM</a>(<a class="local col9 ref" href="#129converted_args" title='converted_args' data-ref="129converted_args">converted_args</a>, <a class="local col1 ref" href="#151arg_num" title='arg_num' data-ref="151arg_num">arg_num</a>, <a class="local col9 ref" href="#159converted_arg" title='converted_arg' data-ref="159converted_arg">converted_arg</a>);</td></tr>
<tr><th id="639">639</th><td>        }</td></tr>
<tr><th id="640">640</th><td></td></tr>
<tr><th id="641">641</th><td>        <a class="local col9 ref" href="#149argv" title='argv' data-ref="149argv">argv</a> = <a class="ref" href="../Include/abstract.h.html#_PySequence_BytesToCharpArray" title='_PySequence_BytesToCharpArray' data-ref="_PySequence_BytesToCharpArray">_PySequence_BytesToCharpArray</a>(<a class="local col9 ref" href="#129converted_args" title='converted_args' data-ref="129converted_args">converted_args</a>);</td></tr>
<tr><th id="642">642</th><td>        <a class="macro" href="../Include/object.h.html#831" title="do { PyObject *_py_tmp = (PyObject *)(converted_args); if (_py_tmp != ((void*)0)) { (converted_args) = ((void*)0); do { PyObject *_py_decref_tmp = (PyObject *)(_py_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 642, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } } while (0)" data-ref="_M/Py_CLEAR">Py_CLEAR</a>(<a class="local col9 ref" href="#129converted_args" title='converted_args' data-ref="129converted_args">converted_args</a>);</td></tr>
<tr><th id="643">643</th><td>        <a class="macro" href="../Include/object.h.html#831" title="do { PyObject *_py_tmp = (PyObject *)(fast_args); if (_py_tmp != ((void*)0)) { (fast_args) = ((void*)0); do { PyObject *_py_decref_tmp = (PyObject *)(_py_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 643, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } } while (0)" data-ref="_M/Py_CLEAR">Py_CLEAR</a>(<a class="local col0 ref" href="#130fast_args" title='fast_args' data-ref="130fast_args">fast_args</a>);</td></tr>
<tr><th id="644">644</th><td>        <b>if</b> (!<a class="local col9 ref" href="#149argv" title='argv' data-ref="149argv">argv</a>)</td></tr>
<tr><th id="645">645</th><td>            <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="646">646</th><td>    }</td></tr>
<tr><th id="647">647</th><td></td></tr>
<tr><th id="648">648</th><td>    <b>if</b> (<a class="local col6 ref" href="#126env_list" title='env_list' data-ref="126env_list">env_list</a> != <a class="macro" href="../Include/object.h.html#910" title="(&amp;_Py_NoneStruct)" data-ref="_M/Py_None">Py_None</a>) {</td></tr>
<tr><th id="649">649</th><td>        <a class="local col0 ref" href="#150envp" title='envp' data-ref="150envp">envp</a> = <a class="ref" href="../Include/abstract.h.html#_PySequence_BytesToCharpArray" title='_PySequence_BytesToCharpArray' data-ref="_PySequence_BytesToCharpArray">_PySequence_BytesToCharpArray</a>(<a class="local col6 ref" href="#126env_list" title='env_list' data-ref="126env_list">env_list</a>);</td></tr>
<tr><th id="650">650</th><td>        <b>if</b> (!<a class="local col0 ref" href="#150envp" title='envp' data-ref="150envp">envp</a>)</td></tr>
<tr><th id="651">651</th><td>            <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="652">652</th><td>    }</td></tr>
<tr><th id="653">653</th><td></td></tr>
<tr><th id="654">654</th><td>    <b>if</b> (<a class="local col3 ref" href="#143cwd_obj" title='cwd_obj' data-ref="143cwd_obj">cwd_obj</a> != <a class="macro" href="../Include/object.h.html#910" title="(&amp;_Py_NoneStruct)" data-ref="_M/Py_None">Py_None</a>) {</td></tr>
<tr><th id="655">655</th><td>        <b>if</b> (<a class="ref" href="../Include/unicodeobject.h.html#PyUnicode_FSConverter" title='PyUnicode_FSConverter' data-ref="PyUnicode_FSConverter">PyUnicode_FSConverter</a>(<a class="local col3 ref" href="#143cwd_obj" title='cwd_obj' data-ref="143cwd_obj">cwd_obj</a>, &amp;<a class="local col4 ref" href="#144cwd_obj2" title='cwd_obj2' data-ref="144cwd_obj2">cwd_obj2</a>) == <var>0</var>)</td></tr>
<tr><th id="656">656</th><td>            <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="657">657</th><td>        <a class="local col5 ref" href="#145cwd" title='cwd' data-ref="145cwd">cwd</a> = <a class="ref" href="../Include/bytesobject.h.html#PyBytes_AsString" title='PyBytes_AsString' data-ref="PyBytes_AsString">PyBytes_AsString</a>(<a class="local col4 ref" href="#144cwd_obj2" title='cwd_obj2' data-ref="144cwd_obj2">cwd_obj2</a>);</td></tr>
<tr><th id="658">658</th><td>    } <b>else</b> {</td></tr>
<tr><th id="659">659</th><td>        <a class="local col5 ref" href="#145cwd" title='cwd' data-ref="145cwd">cwd</a> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="660">660</th><td>        <a class="local col4 ref" href="#144cwd_obj2" title='cwd_obj2' data-ref="144cwd_obj2">cwd_obj2</a> = <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="661">661</th><td>    }</td></tr>
<tr><th id="662">662</th><td></td></tr>
<tr><th id="663">663</th><td>    <i>/* This must be the last thing done before fork() because we do not</i></td></tr>
<tr><th id="664">664</th><td><i>     * want to call PyOS_BeforeFork() if there is any chance of another</i></td></tr>
<tr><th id="665">665</th><td><i>     * error leading to the cleanup: code without calling fork(). */</i></td></tr>
<tr><th id="666">666</th><td>    <b>if</b> (<a class="local col7 ref" href="#127preexec_fn" title='preexec_fn' data-ref="127preexec_fn">preexec_fn</a> != <a class="macro" href="../Include/object.h.html#910" title="(&amp;_Py_NoneStruct)" data-ref="_M/Py_None">Py_None</a>) {</td></tr>
<tr><th id="667">667</th><td>        <a class="local col1 ref" href="#131preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-ref="131preexec_fn_args_tuple">preexec_fn_args_tuple</a> = <a class="ref" href="../Include/tupleobject.h.html#PyTuple_New" title='PyTuple_New' data-ref="PyTuple_New">PyTuple_New</a>(<var>0</var>);</td></tr>
<tr><th id="668">668</th><td>        <b>if</b> (!<a class="local col1 ref" href="#131preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-ref="131preexec_fn_args_tuple">preexec_fn_args_tuple</a>)</td></tr>
<tr><th id="669">669</th><td>            <b>goto</b> <a class="lbl" href="#156cleanup" data-ref="156cleanup">cleanup</a>;</td></tr>
<tr><th id="670">670</th><td>        <a class="ref" href="../Include/intrcheck.h.html#PyOS_BeforeFork" title='PyOS_BeforeFork' data-ref="PyOS_BeforeFork">PyOS_BeforeFork</a>();</td></tr>
<tr><th id="671">671</th><td>        <a class="local col2 ref" href="#152need_after_fork" title='need_after_fork' data-ref="152need_after_fork">need_after_fork</a> = <var>1</var>;</td></tr>
<tr><th id="672">672</th><td>    }</td></tr>
<tr><th id="673">673</th><td></td></tr>
<tr><th id="674">674</th><td>    <a class="local col6 ref" href="#146pid" title='pid' data-ref="146pid">pid</a> = <a class="ref" href="../../include/unistd.h.html#fork" title='fork' data-ref="fork">fork</a>();</td></tr>
<tr><th id="675">675</th><td>    <b>if</b> (<a class="local col6 ref" href="#146pid" title='pid' data-ref="146pid">pid</a> == <var>0</var>) {</td></tr>
<tr><th id="676">676</th><td>        <i>/* Child process */</i></td></tr>
<tr><th id="677">677</th><td>        <i>/*</i></td></tr>
<tr><th id="678">678</th><td><i>         * Code from here to _exit() must only use async-signal-safe functions,</i></td></tr>
<tr><th id="679">679</th><td><i>         * listed at `man 7 signal` or</i></td></tr>
<tr><th id="680">680</th><td><i>         * <a href="http://www.opengroup.org/onlinepubs/009695399/functions/xsh_chap02_04.html">http://www.opengroup.org/onlinepubs/009695399/functions/xsh_chap02_04.html</a>.</i></td></tr>
<tr><th id="681">681</th><td><i>         */</i></td></tr>
<tr><th id="682">682</th><td></td></tr>
<tr><th id="683">683</th><td>        <b>if</b> (<a class="local col7 ref" href="#127preexec_fn" title='preexec_fn' data-ref="127preexec_fn">preexec_fn</a> != <a class="macro" href="../Include/object.h.html#910" title="(&amp;_Py_NoneStruct)" data-ref="_M/Py_None">Py_None</a>) {</td></tr>
<tr><th id="684">684</th><td>            <i>/* We'll be calling back into Python later so we need to do this.</i></td></tr>
<tr><th id="685">685</th><td><i>             * This call may not be async-signal-safe but neither is calling</i></td></tr>
<tr><th id="686">686</th><td><i>             * back into Python.  The user asked us to use hope as a strategy</i></td></tr>
<tr><th id="687">687</th><td><i>             * to avoid deadlock... */</i></td></tr>
<tr><th id="688">688</th><td>            <a class="ref" href="../Include/intrcheck.h.html#PyOS_AfterFork_Child" title='PyOS_AfterFork_Child' data-ref="PyOS_AfterFork_Child">PyOS_AfterFork_Child</a>();</td></tr>
<tr><th id="689">689</th><td>        }</td></tr>
<tr><th id="690">690</th><td></td></tr>
<tr><th id="691">691</th><td>        <a class="tu ref" href="#child_exec" title='child_exec' data-use='c' data-ref="child_exec">child_exec</a>(<a class="local col8 ref" href="#148exec_array" title='exec_array' data-ref="148exec_array">exec_array</a>, <a class="local col9 ref" href="#149argv" title='argv' data-ref="149argv">argv</a>, <a class="local col0 ref" href="#150envp" title='envp' data-ref="150envp">envp</a>, <a class="local col5 ref" href="#145cwd" title='cwd' data-ref="145cwd">cwd</a>,</td></tr>
<tr><th id="692">692</th><td>                   <a class="local col2 ref" href="#132p2cread" title='p2cread' data-ref="132p2cread">p2cread</a>, <a class="local col3 ref" href="#133p2cwrite" title='p2cwrite' data-ref="133p2cwrite">p2cwrite</a>, <a class="local col4 ref" href="#134c2pread" title='c2pread' data-ref="134c2pread">c2pread</a>, <a class="local col5 ref" href="#135c2pwrite" title='c2pwrite' data-ref="135c2pwrite">c2pwrite</a>,</td></tr>
<tr><th id="693">693</th><td>                   <a class="local col6 ref" href="#136errread" title='errread' data-ref="136errread">errread</a>, <a class="local col7 ref" href="#137errwrite" title='errwrite' data-ref="137errwrite">errwrite</a>, <a class="local col8 ref" href="#138errpipe_read" title='errpipe_read' data-ref="138errpipe_read">errpipe_read</a>, <a class="local col9 ref" href="#139errpipe_write" title='errpipe_write' data-ref="139errpipe_write">errpipe_write</a>,</td></tr>
<tr><th id="694">694</th><td>                   <a class="local col0 ref" href="#140close_fds" title='close_fds' data-ref="140close_fds">close_fds</a>, <a class="local col1 ref" href="#141restore_signals" title='restore_signals' data-ref="141restore_signals">restore_signals</a>, <a class="local col2 ref" href="#142call_setsid" title='call_setsid' data-ref="142call_setsid">call_setsid</a>,</td></tr>
<tr><th id="695">695</th><td>                   <a class="local col5 ref" href="#125py_fds_to_keep" title='py_fds_to_keep' data-ref="125py_fds_to_keep">py_fds_to_keep</a>, <a class="local col7 ref" href="#127preexec_fn" title='preexec_fn' data-ref="127preexec_fn">preexec_fn</a>, <a class="local col1 ref" href="#131preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-ref="131preexec_fn_args_tuple">preexec_fn_args_tuple</a>);</td></tr>
<tr><th id="696">696</th><td>        <a class="ref" href="../../include/unistd.h.html#_exit" title='_exit' data-ref="_exit">_exit</a>(<var>255</var>);</td></tr>
<tr><th id="697">697</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;  <i>/* Dead code to avoid a potential compiler warning. */</i></td></tr>
<tr><th id="698">698</th><td>    }</td></tr>
<tr><th id="699">699</th><td>    <a class="macro" href="../Include/object.h.html#848" title="do { PyObject *_py_xdecref_tmp = (PyObject *)(cwd_obj2); if (_py_xdecref_tmp != ((void*)0)) do { PyObject *_py_decref_tmp = (PyObject *)(_py_xdecref_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 699, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } while (0)" data-ref="_M/Py_XDECREF">Py_XDECREF</a>(<a class="local col4 ref" href="#144cwd_obj2" title='cwd_obj2' data-ref="144cwd_obj2">cwd_obj2</a>);</td></tr>
<tr><th id="700">700</th><td></td></tr>
<tr><th id="701">701</th><td>    <b>if</b> (<a class="local col6 ref" href="#146pid" title='pid' data-ref="146pid">pid</a> == -<var>1</var>) {</td></tr>
<tr><th id="702">702</th><td>        <i>/* Capture the errno exception before errno can be clobbered. */</i></td></tr>
<tr><th id="703">703</th><td>        <a class="ref" href="../Include/pyerrors.h.html#PyErr_SetFromErrno" title='PyErr_SetFromErrno' data-ref="PyErr_SetFromErrno">PyErr_SetFromErrno</a>(<a class="ref" href="../Include/pyerrors.h.html#PyExc_OSError" title='PyExc_OSError' data-ref="PyExc_OSError">PyExc_OSError</a>);</td></tr>
<tr><th id="704">704</th><td>    }</td></tr>
<tr><th id="705">705</th><td></td></tr>
<tr><th id="706">706</th><td>    <i>/* Parent process */</i></td></tr>
<tr><th id="707">707</th><td>    <b>if</b> (<a class="local col2 ref" href="#152need_after_fork" title='need_after_fork' data-ref="152need_after_fork">need_after_fork</a>)</td></tr>
<tr><th id="708">708</th><td>        <a class="ref" href="../Include/intrcheck.h.html#PyOS_AfterFork_Parent" title='PyOS_AfterFork_Parent' data-ref="PyOS_AfterFork_Parent">PyOS_AfterFork_Parent</a>();</td></tr>
<tr><th id="709">709</th><td>    <b>if</b> (<a class="local col0 ref" href="#150envp" title='envp' data-ref="150envp">envp</a>)</td></tr>
<tr><th id="710">710</th><td>        <a class="ref" href="../Include/abstract.h.html#_Py_FreeCharPArray" title='_Py_FreeCharPArray' data-ref="_Py_FreeCharPArray">_Py_FreeCharPArray</a>(<a class="local col0 ref" href="#150envp" title='envp' data-ref="150envp">envp</a>);</td></tr>
<tr><th id="711">711</th><td>    <b>if</b> (<a class="local col9 ref" href="#149argv" title='argv' data-ref="149argv">argv</a>)</td></tr>
<tr><th id="712">712</th><td>        <a class="ref" href="../Include/abstract.h.html#_Py_FreeCharPArray" title='_Py_FreeCharPArray' data-ref="_Py_FreeCharPArray">_Py_FreeCharPArray</a>(<a class="local col9 ref" href="#149argv" title='argv' data-ref="149argv">argv</a>);</td></tr>
<tr><th id="713">713</th><td>    <a class="ref" href="../Include/abstract.h.html#_Py_FreeCharPArray" title='_Py_FreeCharPArray' data-ref="_Py_FreeCharPArray">_Py_FreeCharPArray</a>(<a class="local col8 ref" href="#148exec_array" title='exec_array' data-ref="148exec_array">exec_array</a>);</td></tr>
<tr><th id="714">714</th><td></td></tr>
<tr><th id="715">715</th><td>    <i>/* Reenable gc in the parent process (or if fork failed). */</i></td></tr>
<tr><th id="716">716</th><td>    <b>if</b> (<a class="tu ref" href="#_enable_gc" title='_enable_gc' data-use='c' data-ref="_enable_gc">_enable_gc</a>(<a class="local col7 ref" href="#147need_to_reenable_gc" title='need_to_reenable_gc' data-ref="147need_to_reenable_gc">need_to_reenable_gc</a>, <a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>)) {</td></tr>
<tr><th id="717">717</th><td>        <a class="local col6 ref" href="#146pid" title='pid' data-ref="146pid">pid</a> = -<var>1</var>;</td></tr>
<tr><th id="718">718</th><td>    }</td></tr>
<tr><th id="719">719</th><td>    <a class="macro" href="../Include/object.h.html#848" title="do { PyObject *_py_xdecref_tmp = (PyObject *)(preexec_fn_args_tuple); if (_py_xdecref_tmp != ((void*)0)) do { PyObject *_py_decref_tmp = (PyObject *)(_py_xdecref_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 719, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } while (0)" data-ref="_M/Py_XDECREF">Py_XDECREF</a>(<a class="local col1 ref" href="#131preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-ref="131preexec_fn_args_tuple">preexec_fn_args_tuple</a>);</td></tr>
<tr><th id="720">720</th><td>    <a class="macro" href="../Include/object.h.html#848" title="do { PyObject *_py_xdecref_tmp = (PyObject *)(gc_module); if (_py_xdecref_tmp != ((void*)0)) do { PyObject *_py_decref_tmp = (PyObject *)(_py_xdecref_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 720, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } while (0)" data-ref="_M/Py_XDECREF">Py_XDECREF</a>(<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>);</td></tr>
<tr><th id="721">721</th><td></td></tr>
<tr><th id="722">722</th><td>    <b>if</b> (<a class="local col6 ref" href="#146pid" title='pid' data-ref="146pid">pid</a> == -<var>1</var>)</td></tr>
<tr><th id="723">723</th><td>        <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;  <i>/* fork() failed.  Exception set earlier. */</i></td></tr>
<tr><th id="724">724</th><td></td></tr>
<tr><th id="725">725</th><td>    <b>return</b> <a class="macro" href="../Include/longobject.h.html#41" title="PyLong_FromLong" data-ref="_M/PyLong_FromPid">PyLong_FromPid</a>(<a class="local col6 ref" href="#146pid" title='pid' data-ref="146pid">pid</a>);</td></tr>
<tr><th id="726">726</th><td></td></tr>
<tr><th id="727">727</th><td><dfn class="lbl" id="156cleanup" data-ref="156cleanup">cleanup</dfn>:</td></tr>
<tr><th id="728">728</th><td>    <b>if</b> (<a class="local col0 ref" href="#150envp" title='envp' data-ref="150envp">envp</a>)</td></tr>
<tr><th id="729">729</th><td>        <a class="ref" href="../Include/abstract.h.html#_Py_FreeCharPArray" title='_Py_FreeCharPArray' data-ref="_Py_FreeCharPArray">_Py_FreeCharPArray</a>(<a class="local col0 ref" href="#150envp" title='envp' data-ref="150envp">envp</a>);</td></tr>
<tr><th id="730">730</th><td>    <b>if</b> (<a class="local col9 ref" href="#149argv" title='argv' data-ref="149argv">argv</a>)</td></tr>
<tr><th id="731">731</th><td>        <a class="ref" href="../Include/abstract.h.html#_Py_FreeCharPArray" title='_Py_FreeCharPArray' data-ref="_Py_FreeCharPArray">_Py_FreeCharPArray</a>(<a class="local col9 ref" href="#149argv" title='argv' data-ref="149argv">argv</a>);</td></tr>
<tr><th id="732">732</th><td>    <b>if</b> (<a class="local col8 ref" href="#148exec_array" title='exec_array' data-ref="148exec_array">exec_array</a>)</td></tr>
<tr><th id="733">733</th><td>        <a class="ref" href="../Include/abstract.h.html#_Py_FreeCharPArray" title='_Py_FreeCharPArray' data-ref="_Py_FreeCharPArray">_Py_FreeCharPArray</a>(<a class="local col8 ref" href="#148exec_array" title='exec_array' data-ref="148exec_array">exec_array</a>);</td></tr>
<tr><th id="734">734</th><td>    <a class="macro" href="../Include/object.h.html#848" title="do { PyObject *_py_xdecref_tmp = (PyObject *)(converted_args); if (_py_xdecref_tmp != ((void*)0)) do { PyObject *_py_decref_tmp = (PyObject *)(_py_xdecref_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 734, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } while (0)" data-ref="_M/Py_XDECREF">Py_XDECREF</a>(<a class="local col9 ref" href="#129converted_args" title='converted_args' data-ref="129converted_args">converted_args</a>);</td></tr>
<tr><th id="735">735</th><td>    <a class="macro" href="../Include/object.h.html#848" title="do { PyObject *_py_xdecref_tmp = (PyObject *)(fast_args); if (_py_xdecref_tmp != ((void*)0)) do { PyObject *_py_decref_tmp = (PyObject *)(_py_xdecref_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 735, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } while (0)" data-ref="_M/Py_XDECREF">Py_XDECREF</a>(<a class="local col0 ref" href="#130fast_args" title='fast_args' data-ref="130fast_args">fast_args</a>);</td></tr>
<tr><th id="736">736</th><td>    <a class="macro" href="../Include/object.h.html#848" title="do { PyObject *_py_xdecref_tmp = (PyObject *)(preexec_fn_args_tuple); if (_py_xdecref_tmp != ((void*)0)) do { PyObject *_py_decref_tmp = (PyObject *)(_py_xdecref_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 736, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } while (0)" data-ref="_M/Py_XDECREF">Py_XDECREF</a>(<a class="local col1 ref" href="#131preexec_fn_args_tuple" title='preexec_fn_args_tuple' data-ref="131preexec_fn_args_tuple">preexec_fn_args_tuple</a>);</td></tr>
<tr><th id="737">737</th><td>    <a class="tu ref" href="#_enable_gc" title='_enable_gc' data-use='c' data-ref="_enable_gc">_enable_gc</a>(<a class="local col7 ref" href="#147need_to_reenable_gc" title='need_to_reenable_gc' data-ref="147need_to_reenable_gc">need_to_reenable_gc</a>, <a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>);</td></tr>
<tr><th id="738">738</th><td>    <a class="macro" href="../Include/object.h.html#848" title="do { PyObject *_py_xdecref_tmp = (PyObject *)(gc_module); if (_py_xdecref_tmp != ((void*)0)) do { PyObject *_py_decref_tmp = (PyObject *)(_py_xdecref_tmp); if (_Py_RefTotal-- , --(_py_decref_tmp)-&gt;ob_refcnt != 0) { if (((PyObject*)_py_decref_tmp)-&gt;ob_refcnt &lt; 0) _Py_NegativeRefcount(&quot;/home/jon/workspace/cpython/Modules/_posixsubprocess.c&quot;, 738, (PyObject *)(_py_decref_tmp)); } else _Py_Dealloc(_py_decref_tmp); } while (0); } while (0)" data-ref="_M/Py_XDECREF">Py_XDECREF</a>(<a class="local col3 ref" href="#123gc_module" title='gc_module' data-ref="123gc_module">gc_module</a>);</td></tr>
<tr><th id="739">739</th><td>    <b>return</b> <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>;</td></tr>
<tr><th id="740">740</th><td>}</td></tr>
<tr><th id="741">741</th><td></td></tr>
<tr><th id="742">742</th><td></td></tr>
<tr><th id="743">743</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char subprocess_fork_exec_doc[] = &quot;fork_exec(args, executable_list, close_fds, cwd, env,\n          p2cread, p2cwrite, c2pread, c2pwrite,\n          errread, errwrite, errpipe_read, errpipe_write,\n          restore_signals, call_setsid, preexec_fn)\n\nForks a child process, closes parent file descriptors as appropriate in the\nchild and dups the few that are needed before calling exec() in the child\nprocess.\n\nThe preexec_fn, if supplied, will be called immediately before exec.\nWARNING: preexec_fn is NOT SAFE if your application uses threads.\n         It may trigger infrequent, difficult to debug deadlocks.\n\nIf an error occurs in the child process before the exec, it is\nserialized and written to the errpipe_write fd per subprocess.py.\n\nReturns: the child process&apos;s PID.\n\nRaises: Only on an error in the parent process.\n&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="subprocess_fork_exec_doc" title='subprocess_fork_exec_doc' data-ref="subprocess_fork_exec_doc">subprocess_fork_exec_doc</dfn>,</td></tr>
<tr><th id="744">744</th><td><q>"fork_exec(args, executable_list, close_fds, cwd, env,\n\</q></td></tr>
<tr><th id="745">745</th><td><q>          p2cread, p2cwrite, c2pread, c2pwrite,\n\</q></td></tr>
<tr><th id="746">746</th><td><q>          errread, errwrite, errpipe_read, errpipe_write,\n\</q></td></tr>
<tr><th id="747">747</th><td><q>          restore_signals, call_setsid, preexec_fn)\n\</q></td></tr>
<tr><th id="748">748</th><td><q>\n\</q></td></tr>
<tr><th id="749">749</th><td><q>Forks a child process, closes parent file descriptors as appropriate in the\n\</q></td></tr>
<tr><th id="750">750</th><td><q>child and dups the few that are needed before calling exec() in the child\n\</q></td></tr>
<tr><th id="751">751</th><td><q>process.\n\</q></td></tr>
<tr><th id="752">752</th><td><q>\n\</q></td></tr>
<tr><th id="753">753</th><td><q>The preexec_fn, if supplied, will be called immediately before exec.\n\</q></td></tr>
<tr><th id="754">754</th><td><q>WARNING: preexec_fn is NOT SAFE if your application uses threads.\n\</q></td></tr>
<tr><th id="755">755</th><td><q>         It may trigger infrequent, difficult to debug deadlocks.\n\</q></td></tr>
<tr><th id="756">756</th><td><q>\n\</q></td></tr>
<tr><th id="757">757</th><td><q>If an error occurs in the child process before the exec, it is\n\</q></td></tr>
<tr><th id="758">758</th><td><q>serialized and written to the errpipe_write fd per subprocess.py.\n\</q></td></tr>
<tr><th id="759">759</th><td><q>\n\</q></td></tr>
<tr><th id="760">760</th><td><q>Returns: the child process's PID.\n\</q></td></tr>
<tr><th id="761">761</th><td><q>\n\</q></td></tr>
<tr><th id="762">762</th><td><q>Raises: Only on an error in the parent process.\n\</q></td></tr>
<tr><th id="763">763</th><td><q>"</q>);</td></tr>
<tr><th id="764">764</th><td></td></tr>
<tr><th id="765">765</th><td><i>/* module level code ********************************************************/</i></td></tr>
<tr><th id="766">766</th><td></td></tr>
<tr><th id="767">767</th><td><a class="macro" href="../Include/pymacro.h.html#71" title="static char module_doc[] = &quot;A POSIX helper for the subprocess module.&quot;" data-ref="_M/PyDoc_STRVAR">PyDoc_STRVAR</a>(<dfn class="decl def" id="module_doc" title='module_doc' data-ref="module_doc">module_doc</dfn>,</td></tr>
<tr><th id="768">768</th><td><q>"A POSIX helper for the subprocess module."</q>);</td></tr>
<tr><th id="769">769</th><td></td></tr>
<tr><th id="770">770</th><td></td></tr>
<tr><th id="771">771</th><td><em>static</em> <a class="typedef" href="../Include/methodobject.h.html#PyMethodDef" title='PyMethodDef' data-type='struct PyMethodDef' data-ref="PyMethodDef">PyMethodDef</a> <dfn class="tu decl def" id="module_methods" title='module_methods' data-type='PyMethodDef [2]' data-ref="module_methods">module_methods</dfn>[] = {</td></tr>
<tr><th id="772">772</th><td>    {<q>"fork_exec"</q>, <a class="tu ref" href="#subprocess_fork_exec" title='subprocess_fork_exec' data-ref="subprocess_fork_exec">subprocess_fork_exec</a>, <a class="macro" href="../Include/methodobject.h.html#71" title="0x0001" data-ref="_M/METH_VARARGS">METH_VARARGS</a>, <a class="ref" href="#743" title='subprocess_fork_exec_doc' data-ref="subprocess_fork_exec_doc">subprocess_fork_exec_doc</a>},</td></tr>
<tr><th id="773">773</th><td>    {<span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>, <span class="macro" title="((void*)0)" data-ref="_M/NULL">NULL</span>}  <i>/* sentinel */</i></td></tr>
<tr><th id="774">774</th><td>};</td></tr>
<tr><th id="775">775</th><td></td></tr>
<tr><th id="776">776</th><td></td></tr>
<tr><th id="777">777</th><td><em>static</em> <b>struct</b> <a class="type" href="../Include/moduleobject.h.html#PyModuleDef" title='PyModuleDef' data-ref="PyModuleDef">PyModuleDef</a> <dfn class="tu decl def" id="_posixsubprocessmodule" title='_posixsubprocessmodule' data-type='struct PyModuleDef' data-ref="_posixsubprocessmodule">_posixsubprocessmodule</dfn> = {</td></tr>
<tr><th id="778">778</th><td>	<a class="macro" href="../Include/moduleobject.h.html#50" title="{ { 0, 0, 1, ((void*)0) }, ((void*)0), 0, ((void*)0), }" data-ref="_M/PyModuleDef_HEAD_INIT">PyModuleDef_HEAD_INIT</a>,</td></tr>
<tr><th id="779">779</th><td>	<q>"_posixsubprocess"</q>,</td></tr>
<tr><th id="780">780</th><td>	<a class="ref" href="#767" title='module_doc' data-ref="module_doc">module_doc</a>,</td></tr>
<tr><th id="781">781</th><td>	-<var>1</var>,  <i>/* No memory is needed. */</i></td></tr>
<tr><th id="782">782</th><td>	<a class="tu ref" href="#module_methods" title='module_methods' data-ref="module_methods">module_methods</a>,</td></tr>
<tr><th id="783">783</th><td>};</td></tr>
<tr><th id="784">784</th><td></td></tr>
<tr><th id="785">785</th><td><a class="macro" href="../Include/pyport.h.html#685" title="PyObject*" data-ref="_M/PyMODINIT_FUNC">PyMODINIT_FUNC</a></td></tr>
<tr><th id="786">786</th><td><dfn class="decl def" id="PyInit__posixsubprocess" title='PyInit__posixsubprocess' data-ref="PyInit__posixsubprocess">PyInit__posixsubprocess</dfn>(<em>void</em>)</td></tr>
<tr><th id="787">787</th><td>{</td></tr>
<tr><th id="788">788</th><td>    <b>return</b> <a class="macro" href="../Include/modsupport.h.html#199" title="PyModule_Create2TraceRefs(&amp;_posixsubprocessmodule, 1013)" data-ref="_M/PyModule_Create">PyModule_Create</a>(&amp;<a class="tu ref" href="#_posixsubprocessmodule" title='_posixsubprocessmodule' data-use='a' data-ref="_posixsubprocessmodule">_posixsubprocessmodule</a>);</td></tr>
<tr><th id="789">789</th><td>}</td></tr>
<tr><th id="790">790</th><td></td></tr>
</table><hr/><p id='footer'>
Generated on <em>2017-Aug-29</em> from project codebrowser revision <em>v3.6.0b2-99580-g07f1658</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
